<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Versión actualizada a 12.4 -->
    <title>Adán Gómez | Fotógrafo Profesional (v12.4)</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/1a1a1a/FDFDFD?text=AG">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (ACTUALIZADO) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg-main: #FDFDFD;
            --text-dark: #1a1a1a;
            --text-light: #f8f9fa;
            --accent: #3a3a3a;
        }
        html { 
            scroll-behavior: smooth; 
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-dark);
            overflow-x: hidden;
        }
        /* TIPOGRAFÍA DE TÍTULOS ACTUALIZADA */
        h1, h2, h3, h4, .font-display { 
            font-family: 'Cormorant Garamond', serif; 
            line-height: 1.4; 
        }
        
        /* --- Arquitectura de Transición (Crossfade) --- */
        .page-container { 
            display: none; 
            opacity: 0; 
            transition: opacity 0.5s ease-in-out;
        }
        .page-active { 
            display: block; 
            opacity: 1;
        }
        .page-exiting {
            display: block;
            opacity: 0;
        }
        
        /* --- Animación de carga de imágenes (Fade-in) --- */
        .reveal {
            opacity: 0;
            transition: opacity 1.2s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .reveal.visible {
            opacity: 1;
        }
        
        /* --- Indicador de carga --- */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-main);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .loader-circle {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* --- Header Dinámico Mejorado --- */
        #header {
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            padding-top: 1.5rem; 
            padding-bottom: 1.5rem;
            background-color: transparent;
        }
        #header.header-scrolled, #header.header-dark {
            padding-top: 0.5rem; 
            padding-bottom: 0.5rem;
        }
        #header.header-scrolled {
            background-color: rgba(253, 253, 253, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        #header.header-dark {
            background-color: #52525b; /* bg-zinc-700 */
            box-shadow: none;
        }
        #header.header-dark .nav-link-text, #header.header-dark #mobile-menu-button .icon-bar, #header.header-dark .social-icon, #header.header-dark #cart-button {
            color: white;
        }
         #header.header-dark .nav-link-underline {
            background-color: white;
        }
         #header.header-dark .logo-dark {
            display: none;
        }
        #header.header-dark .logo-light {
            display: block;
        }
        #header:not(.header-dark) .logo-light {
            display: none;
        }
        #header:not(.header-dark) .logo-dark {
            display: block;
        }
        
        /* --- Menú Móvil Mejorado --- */
        #mobile-menu {
            background-color: rgba(253, 253, 253, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transform: translateX(100%);
            transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1);
        }
        #mobile-menu.open {
            transform: translateX(0);
        }
        .mobile-nav-link {
            font-family: 'Cormorant Garamond', serif;
            color: var(--text-dark);
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            position: relative;
        }
        .mobile-nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent);
            transition: width 0.4s ease;
        }
        .mobile-nav-link:hover::after, .mobile-nav-link.nav-active::after {
            width: 100%;
        }
        #mobile-menu-button .icon-bar {
            transition: all 0.3s ease-in-out;
        }
        #mobile-menu-button.open .icon-bar:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        #mobile-menu-button.open .icon-bar:nth-child(2) { opacity: 0; }
        #mobile-menu-button.open .icon-bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
        
        /* --- Estilo para el enlace de navegación activo --- */
        .nav-link.nav-active > .nav-link-underline {
            width: 100%;
        }

        /* --- Galería Mejorada --- */
        .gallery-item { 
            cursor: pointer; 
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: relative;
            overflow: hidden;
        }
        .gallery-item:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        .gallery-item img {
            transition: transform 0.8s ease;
        }
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        .gallery-item .overlay { 
            opacity: 0; 
            transition: opacity 0.5s ease; 
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 80%);
        }
        .gallery-item:hover .overlay { 
            opacity: 1; 
        }
        .gallery-item .overlay p {
            transform: translateY(20px);
            transition: transform 0.5s ease;
        }
        .gallery-item:hover .overlay p {
            transform: translateY(0);
        }
        
        /* --- Lightbox Mejorado --- */
        #lightbox { 
            background-color: rgba(10, 10, 10, 0.95); 
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: opacity 0.4s ease-in-out;
        }
        #lightbox-image { 
            transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1); 
            transform: scale(0.9);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
        }
        #lightbox.visible #lightbox-image { 
            transform: scale(1); 
        }
        #lightbox-close {
            transition: all 0.3s ease;
        }
        #lightbox-close:hover {
            transform: rotate(90deg);
            color: #ff5252;
        }
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 101;
        }
        .lightbox-nav:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-50%) scale(1.1);
        }
        #lightbox-prev { left: 20px; }
        #lightbox-next { right: 20px; }
        
        /* --- Contacto y Mapa --- */
        .contact-icon-link { 
            background-color: #f3f4f6; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        .contact-icon-link::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background-color: var(--accent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            z-index: -1;
        }
        .contact-icon-link:hover::before {
            width: 300px;
            height: 300px;
        }
        .contact-icon-link:hover { 
            color: white; 
            transform: scale(1.1);
        }
        #google-map { 
            filter: grayscale(100%) contrast(90%) brightness(110%); 
            transition: filter 0.5s ease;
        }
        #google-map:hover { 
            filter: grayscale(0%);
        }
        
        /* --- Logos de Marcas --- */
        .client-logo {
            filter: grayscale(100%);
            opacity: 0.6;
            transition: all 0.4s ease;
        }
        .client-logo:hover {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.05);
        }
        
        /* --- Botones y Enlaces Mejorados --- */
        .btn-primary {
            position: relative;
            overflow: hidden;
            z-index: 1;
            transition: all 0.3s ease;
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
            z-index: -1;
        }
        .btn-primary:hover::before {
            left: 100%;
        }
        
        /* --- Animación de aparición de texto --- */
        .text-reveal {
            position: relative;
            overflow: hidden;
        }
        .text-reveal::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-main);
            transform: translateX(0);
            transition: transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .text-reveal.revealed::after {
            transform: translateX(101%);
        }
        
        /* --- Efecto parallax suave --- */
        .parallax {
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* --- Mejoras de accesibilidad --- */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* --- Animación de carga de imágenes con placeholder --- */
        .img-container {
            position: relative;
            overflow: hidden;
            background-color: #f3f4f6;
        }
        .img-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            animation: shimmer 1.5s infinite;
            z-index: 1;
        }
        @keyframes shimmer {
            100% { left: 100%; }
        }
        .img-container.loaded::before {
            animation: none;
            opacity: 0;
        }

        /* --- Estilos para la sección de Alquiler (Rediseño) --- */
        .rental-category-btn {
            padding: 0.5rem 1.5rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0; /* Cambio a esquinas cuadradas */
            transition: all 0.3s ease;
            font-weight: 500;
            white-space: nowrap; /* Evita que el texto se parta */
            flex-shrink: 0; 
        }
        .rental-category-btn.active, .rental-category-btn:hover {
            background-color: var(--text-dark);
            color: white;
            border-color: var(--text-dark);
        }
        .rental-card {
            background-color: white;
            border: 1px solid #e5e7eb; /* gray-200 */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            transform: translateY(20px);
            display: flex;
            flex-direction: column;
        }
         .rental-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .rental-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .carousel-container {
            overflow: hidden;
            position: relative;
        }
        .carousel-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .carousel-item {
            min-width: 100%;
        }
        .carousel-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0,0,0,0.4);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .carousel-container:hover .carousel-button {
            opacity: 1;
        }
        .carousel-button:hover {
            background-color: rgba(0,0,0,0.7);
        }
        .carousel-button.prev { left: 10px; }
        .carousel-button.next { right: 10px; }
        
        /* --- Estilos para la nueva sección de Servicios (Reemplazo) --- */
        .service-grid-item {
            background-color: white;
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0; /* Cambio de rounded-lg a esquinas cuadradas */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }
        .service-grid-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            border-color: var(--accent);
        }
        .service-icon-wrapper {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f3f4f6; /* gray-100 */
            margin-bottom: 1.5rem;
            transition: all 0.4s ease;
        }
        .service-grid-item:hover .service-icon-wrapper {
            background-color: var(--accent);
            transform: rotate(15deg) scale(1.1);
        }
        .service-icon {
            font-size: 2rem;
            color: var(--accent);
            transition: color 0.4s ease;
        }
        .service-grid-item:hover .service-icon {
            color: white;
        }
        .service-grid-item h3 {
            margin-bottom: 0.5rem;
            transition: color 0.4s ease;
        }

        /* --- NUEVOS ESTILOS PARA EL MODAL DEL CALENDARIO --- */
        .calendar-modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            pointer-events: none;
        }
        .calendar-modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .calendar-modal-content {
            background-color: white;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .calendar-modal-overlay.visible .calendar-modal-content {
            transform: scale(1);
            opacity: 1;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .calendar-nav-btn {
            background: none;
            border: 1px solid #d1d5db;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .calendar-nav-btn:hover {
            background-color: var(--text-dark);
            color: white;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }
        .calendar-day, .calendar-day-name {
            display: flex;
            justify-content: center;
            align-items: center;
            aspect-ratio: 1 / 1;
            text-align: center;
        }
        .calendar-day-name {
            font-weight: bold;
            font-size: 0.75rem;
            color: #6b7280;
        }
        .calendar-day {
            border: none;
            background-color: transparent;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .calendar-day:not(.disabled):hover {
            background-color: #f3f4f6;
        }
        .calendar-day.disabled {
            color: #d1d5db;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        .calendar-day.selected, .calendar-day.in-range {
            background-color: var(--text-dark);
            color: white;
        }
        .booking-summary {
            background-color: #f9fafb;
            padding: 1rem;
            margin-top: 1rem;
        }

        /* --- NUEVOS ESTILOS PARA EL CARRITO DE COMPRAS --- */
        #cart-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 60;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        #cart-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #cart-drawer {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 450px;
            height: 100%;
            background-color: white;
            z-index: 70;
            transform: translateX(100%);
            transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1);
            display: flex;
            flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.1);
        }
        #cart-drawer.visible {
            transform: translateX(0);
        }
        .cart-button { /* Clase común para ambos botones de carrito */
            position: relative;
        }
        .cart-item-count { /* Clase común para ambos contadores */
            position: absolute;
            top: -5px;
            right: -10px;
            background-color: var(--text-dark);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            transform: scale(0);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #cart-item-count { /* Escritorio */
            width: 20px;
            height: 20px;
            font-size: 12px;
        }
        #mobile-cart-item-count { /* Móvil */
            width: 24px;
            height: 24px;
            font-size: 14px;
            top: -8px;
            right: -12px;
        }
        .cart-item-count.visible {
            transform: scale(1);
        }
        .cart-item-remove-btn {
            color: #9ca3af;
            transition: color 0.2s;
        }
        .cart-item-remove-btn:hover {
            color: #ef4444;
        }
        #cart-empty-state {
            display: none; /* Oculto por defecto */
        }
        
        /* --- NUEVOS ESTILOS PARA EL MODAL DE CHECKOUT --- */
        #checkout-modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            z-index: 110;
            opacity: 0;
            transition: opacity 0.4s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            pointer-events: none;
        }
        #checkout-modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #checkout-modal-content {
            background-color: white;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s ease;
        }
        #checkout-modal-overlay.visible #checkout-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .checkout-step {
            display: none;
        }
        .checkout-step.active {
            display: block;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--text-dark);
            box-shadow: 0 0 0 2px rgba(26,26,26,0.2);
        }
        .checkout-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

    </style>
</head>
<body class="antialiased">
    <!-- Indicador de carga -->
    <div class="loader" id="page-loader">
        <div class="flex flex-col items-center w-3/4 max-w-xs md:max-w-md">
            <img src="https://placehold.co/200x64/ffffff/ffffff?text=..." alt="" class="w-full h-auto mb-8 logo-dark transition-opacity duration-300">
            <img src="https://placehold.co/200x64/ffffff/ffffff?text=..." alt="" class="w-full h-auto mb-8 logo-light" style="display: none;">
            <div class="loader-circle"></div>
        </div>
    </div>
    
    <!-- ===== HEADER ===== -->
    <header id="header" class="fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="#" data-target="portfolio" class="nav-link relative group">
                <img src="https://placehold.co/350x144/ffffff/ffffff?text=AG" alt="" class="w-40 lg:w-[250px] h-auto transition-all duration-300 group-hover:scale-105 logo-dark">
                <img src="https://placehold.co/350x144/ffffff/ffffff?text=AG" alt="" class="w-40 lg:w-[250px] h-auto transition-all duration-300 group-hover:scale-105 logo-light" style="display: none;">
            </a>

            <div class="flex items-center">
                <nav class="hidden lg:flex items-center space-x-8 text-sm uppercase tracking-widest">
                    <a href="#" data-target="portfolio" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Portafolio</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="projects" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Proyectos</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="services" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Servicios</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="rental" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Alquiler</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="about" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Quién Soy</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="contact" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Contacto</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </nav>

                <div class="hidden lg:flex items-center space-x-4 ml-8">
                    <a href="#" aria-label="WhatsApp" class="social-icon text-gray-700 hover:text-black transition-colors"><i class="fab fa-whatsapp fa-lg"></i></a>
                    <a href="#" aria-label="Instagram" class="social-icon text-gray-700 hover:text-black transition-colors"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="#" aria-label="YouTube" class="social-icon text-gray-700 hover:text-black transition-colors"><i class="fab fa-youtube fa-lg"></i></a>
                    <button id="cart-button" aria-label="Ver carrito de compras" class="cart-button social-icon text-gray-700 hover:text-black transition-colors ml-2">
                        <i class="fas fa-shopping-bag fa-lg"></i>
                        <span id="cart-item-count" class="cart-item-count">0</span>
                    </button>
                </div>

                <button id="mobile-menu-button" class="lg:hidden z-50 w-8 h-6 flex flex-col justify-between ml-6" aria-label="Menú móvil" aria-expanded="false">
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                </button>
            </div>
        </div>
    </header>
    <!-- Menú Móvil Overlay (Rediseñado) -->
    <div id="mobile-menu" class="fixed top-0 right-0 w-full h-full z-40 lg:hidden flex flex-col" aria-hidden="true">
        <nav class="flex flex-col justify-center items-center h-full space-y-8 text-3xl flex-grow">
            <a href="#" data-target="portfolio" class="nav-link mobile-nav-link uppercase">Portafolio</a>
            <a href="#" data-target="projects" class="nav-link mobile-nav-link uppercase">Proyectos</a>
            <a href="#" data-target="services" class="nav-link mobile-nav-link uppercase">Servicios</a>
            <a href="#" data-target="rental" class="nav-link mobile-nav-link uppercase">Alquiler</a>
            <a href="#" data-target="about" class="nav-link mobile-nav-link uppercase">Quién Soy</a>
            <a href="#" data-target="contact" class="nav-link mobile-nav-link uppercase">Contacto</a>
        </nav>
        <div class="flex justify-center items-center space-x-8 pb-12">
            <a href="#" aria-label="WhatsApp" class="text-gray-700 hover:text-black transition-colors"><i class="fab fa-whatsapp fa-2x"></i></a>
            <a href="#" aria-label="Instagram" class="text-gray-700 hover:text-black transition-colors"><i class="fab fa-instagram fa-2x"></i></a>
            <a href="#" aria-label="YouTube" class="text-gray-700 hover:text-black transition-colors"><i class="fab fa-youtube fa-2x"></i></a>
            <button id="mobile-cart-button" aria-label="Ver carrito de compras" class="cart-button text-gray-700 hover:text-black transition-colors">
                <i class="fas fa-shopping-bag fa-2x"></i>
                <span id="mobile-cart-item-count" class="cart-item-count">0</span>
            </button>
        </div>
    </div>
    <main id="main-content">
        <!-- ===== PORTFOLIO PAGE ===== -->
        <section id="portfolio" class="page-container pt-28 md:pt-36 pb-0" aria-label="Portafolio">
            <div class="container mx-auto px-4 sm:px-6">
                <!-- El contenedor de la galería ahora es el elemento principal -->
                <div class="reveal">
                    <div id="portfolio-gallery" class="columns-2 sm:columns-3 lg:columns-4 gap-6 space-y-6">
                        <!-- Las ~200 imágenes se insertan aquí desde JS -->
                    </div>
                </div>
            </div>

            <div class="bg-zinc-700 text-white py-20 mt-24 reveal">
                <div class="container mx-auto px-6">
                    <div id="videos-container" class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                        </div>
                </div>
            </div>

            <div class="bg-gray-100 py-20 reveal">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                         <h2 class="text-4xl font-display text-gray-800 text-reveal">Confianza y Colaboración</h2>
                    </div>
                    <div id="client-logos-container" class="flex justify-center items-center flex-wrap gap-x-12 gap-y-8 max-w-4xl mx-auto min-h-[100px]">
                        </div>
                </div>
            </div>
            
            <div class="bg-gray-100 pt-12 pb-24 reveal">
                <div class="container mx-auto px-6 text-center">
                     <div class="text-center mb-12">
                        <h2 class="text-4xl font-display text-gray-800 text-reveal py-2">¿Listo para el Siguiente Paso?</h2>
                        <p class="text-lg text-gray-600 mt-2 text-reveal">Explora mis proyectos o contáctame para empezar a crear.</p>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                        <a href="#" data-target="projects" class="nav-link btn-primary inline-block bg-black text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-gray-800 transition-transform hover:scale-105 w-full sm:w-auto">Explorar Proyectos</a>
                        <a href="#" data-target="contact" class="nav-link btn-primary inline-block bg-zinc-700 text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-zinc-800 transition-transform hover:scale-105 w-full sm:w-auto">Contactar Ahora</a>
                    </div>
                </div>
            </div>
        </section>
        <!-- ===== PROJECTS PAGE ===== -->
        <section id="projects" class="page-container pt-28 md:pt-36 pb-20 md:pb-24 bg-gray-50" aria-label="Proyectos">
            <div class="container mx-auto px-4 md:px-12">
                <div id="projects-container" class="space-y-20">
                    <!-- Los 7 proyectos se insertan aquí desde JS -->
                </div>
                <div class="text-center mt-24 reveal">
                     <h3 class="text-3xl font-display text-gray-800 text-reveal">¿Listo para crear tu propia historia?</h3>
                    <a href="#" data-target="services" class="nav-link btn-primary mt-8 inline-block bg-black text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-gray-800 transition-transform hover:scale-105">Descubre mis Servicios</a>
                </div>
            </div>
        </section>
        <!-- ===== SERVICES PAGE (REDESIGNED) ===== -->
        <section id="services" class="page-container pt-28 md:pt-36 pb-20 md:pb-24" aria-label="Servicios">
            <div class="container mx-auto px-6">
                <div id="services-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto reveal">
                    <!-- Los servicios se insertan aquí desde JS -->
                </div>
            </div>
        </section>
        <!-- ===== RENTAL PAGE (REDESIGNED) ===== -->
        <section id="rental" class="page-container pt-28 md:pt-36 pb-20 md:pb-24 bg-white" aria-label="Alquiler de Equipo">
            <div class="container mx-auto px-6">
                <div id="rental-filters-wrapper" class="reveal mb-12">
                    <div id="rental-filters" class="flex justify-center flex-wrap gap-4">
                        <!-- Filtros de categoría se insertan aquí -->
                    </div>
                </div>
                <div id="rental-grid-categorized" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Las tarjetas de alquiler se insertan aquí -->
                </div>
            </div>
        </section>
        <!-- ===== ABOUT ME PAGE (REDESIGNED) ===== -->
        <section id="about" class="page-container pt-24 md:pt-32 pb-20 md:pb-24 bg-gray-50" aria-label="Sobre mí">
            <div class="container mx-auto px-6">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center reveal">
                        <div class="relative inline-block">
                            <img src="https://placehold.co/288x288/cccccc/999999?text=Cargando..." alt="" class="shadow-xl w-72 h-72 mx-auto mb-8 object-cover transition-opacity duration-500">
                            <div class="absolute inset-0 border-4 border-white border-opacity-30 animate-ping"></div>
                        </div>
                        <p id="about-intro-phrase" class="text-xl text-gray-700 leading-relaxed max-w-2xl mx-auto italic text-reveal mt-8">"No hago fotos para vivir, vivo para hacer fotos. Mi cámara no es una herramienta, es una extensión de mi curiosidad por el mundo y las historias que la gente tiene que contar."</p>
                    </div>
                    <div class="prose max-w-none lg:prose-lg mx-auto mt-16 text-gray-600 leading-relaxed space-y-8 reveal text-justify">
                        <h3 class="text-3xl font-display text-black !mb-4 text-reveal">Mi Filosofía</h3>
                        <div id="about-bio" class="text-reveal space-y-4">
                            <p>Hola, soy Adán Gómez. Desde que tomé...</p>
                        </div>
                        
                        <h3 class="text-3xl font-display text-black !mt-16 !mb-4 text-reveal">Mi Proceso Creativo</h3>
                        <div id="about-process" class="text-reveal space-y-4">
                            <p>Cada proyecto es un viaje colaborativo...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ===== CONTACT PAGE (REDESIGNED) ===== -->
        <section id="contact" class="page-container pt-28 md:pt-36" aria-label="Contacto">
             <div class="container mx-auto px-6 pb-20 md:pb-24">
                <div class="max-w-3xl mx-auto grid grid-cols-2 md:grid-cols-3 gap-6 text-center reveal">
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-instagram fa-3x mb-3"></i>
                        <span class="font-bold">Instagram</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-whatsapp fa-3x mb-3"></i>
                        <span class="font-bold">WhatsApp</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fas fa-envelope fa-3x mb-3"></i>
                        <span class="font-bold">Email</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-facebook-f fa-3x mb-3"></i>
                        <span class="font-bold">Facebook</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-youtube fa-3x mb-3"></i>
                        <span class="font-bold">Youtube</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fas fa-phone fa-3x mb-3"></i>
                        <span class="font-bold">Teléfono</span>
                    </a>
                </div>
            </div>
            <div class="container mx-auto px-6 text-center mb-12 reveal">
                <h2 class="text-4xl font-display text-gray-800 text-reveal">Mi Estudio</h2>
                <p class="text-lg text-gray-600 mt-2 text-reveal">Ubicado en el corazón de Coronado, listo para dar vida a tu proyecto.</p>
             </div>
            <div class="reveal">
                <iframe id="google-map" src="https://www.google.com/maps/embed?pb=!1m18!m12!1m3!1d31431.83101261831!2d-84.0101680513672!3d10.023880900000004!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8fa0f3c43dd70743%3A0x18258b381d58552a!2sV%C3%A1squez%20de%20Coronado!5e0!3m2!1ses-419!2scr!4v1722547858413!5m2!1ses-419!2scr" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </section>
        <!-- PROJECT DETAIL PAGES CONTAINER -->
        <div id="project-detail-pages"></div>
        <!-- RENTAL DETAIL PAGES CONTAINER -->
        <div id="rental-detail-pages"></div>
        <!-- SERVICE DETAIL PAGES CONTAINER -->
        <div id="service-detail-pages"></div>
    </main>
    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 z-[100] flex items-center justify-center hidden opacity-0" role="dialog" aria-modal="true" aria-label="Vista ampliada de imagen">
        <button id="lightbox-close" class="absolute top-6 right-6 text-white text-5xl font-light hover:opacity-75 transition-opacity" aria-label="Cerrar vista ampliada">×</button>
        <button id="lightbox-prev" class="lightbox-nav" aria-label="Imagen anterior">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button id="lightbox-next" class="lightbox-nav" aria-label="Imagen siguiente">
            <i class="fas fa-chevron-right"></i>
        </button>
        <div class="text-white text-center absolute bottom-6 left-0 right-0">
            <p id="lightbox-caption" class="text-lg"></p>
        </div>
        <img id="lightbox-image" src="" alt="Vista ampliada" class="max-w-[90vw] max-h-[85vh] shadow-2xl">
    </div>

    <!-- Contenedor del Modal del Calendario (se añade al final del body) -->
    <div id="calendar-modal-container"></div>
    
    <!-- NUEVA ESTRUCTURA DEL CARRITO -->
    <div id="cart-overlay"></div>
    <aside id="cart-drawer" aria-labelledby="cart-heading">
        <div class="p-6 border-b flex justify-between items-center">
            <h2 id="cart-heading" class="text-2xl font-display">Tu Carrito de Alquiler</h2>
            <button id="cart-close-btn" class="text-2xl text-gray-500 hover:text-black">&times;</button>
        </div>
        <div id="cart-items-container" class="flex-grow overflow-y-auto p-6">
            <!-- Los artículos del carrito se renderizarán aquí -->
            <div id="cart-empty-state" class="text-center p-8 flex flex-col items-center justify-center h-full">
                <i class="fas fa-camera-retro text-5xl text-gray-300 mb-6"></i>
                <h3 class="font-display text-2xl mb-2">Tu carrito está vacío</h3>
                <p class="text-gray-500 mb-8 max-w-xs">Parece que aún no has añadido equipo. ¡Explora nuestro catálogo!</p>
                <a href="#" data-target="rental" class="nav-link btn-primary inline-block bg-black text-white font-bold py-3 px-8 rounded-full hover:bg-gray-800">
                    Explorar Equipo
                </a>
            </div>
        </div>
        <div class="p-6 border-t bg-gray-50">
            <div class="flex justify-between items-center font-bold text-lg mb-4">
                <span>Subtotal:</span>
                <span id="cart-subtotal">$0.00</span>
            </div>
            <button id="checkout-btn" class="w-full bg-black text-white py-4 font-bold hover:bg-gray-800 transition-colors disabled:bg-gray-300">Finalizar Reserva</button>
        </div>
    </aside>
    
    <!-- NUEVA ESTRUCTURA PARA EL MODAL DE CHECKOUT -->
    <div id="checkout-modal-container"></div>


    <script>
    
    document.addEventListener('DOMContentLoaded', function () {
        
        // --- VARIABLES GLOBALES (Se llenarán desde el Backend) ---
        let rentalDataGlobal = {}; 
        let portfolioData = [];
        let projectsData = [];
        let projectDetails = {};
        let servicesData = [];
        let serviceDetails = {};
        let bookedDatesGlobal = []; 

        // --- SELECTORES (Asegúrate de tener este bloque completo) ---
        const mainContent = document.getElementById('main-content');
        const header = document.getElementById('header');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const allNavLinks = document.querySelectorAll('.nav-link');
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.getElementById('lightbox-image');
        const lightboxClose = document.getElementById('lightbox-close');
        const lightboxPrev = document.getElementById('lightbox-prev');
        const lightboxNext = document.getElementById('lightbox-next');
        const lightboxCaption = document.getElementById('lightbox-caption');
        const pageLoader = document.getElementById('page-loader');
        
        // --- Selectores del Carrito (CRUCIALES PARA EL ERROR ACTUAL) ---
        const cartButton = document.getElementById('cart-button');
        const mobileCartButton = document.getElementById('mobile-cart-button');
        const cartItemCount = document.getElementById('cart-item-count');
        const mobileCartItemCount = document.getElementById('mobile-cart-item-count');
        const cartOverlay = document.getElementById('cart-overlay');
        const cartDrawer = document.getElementById('cart-drawer');
        const cartCloseBtn = document.getElementById('cart-close-btn');
        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartEmptyState = document.getElementById('cart-empty-state');
        const cartSubtotalEl = document.getElementById('cart-subtotal');
        const checkoutBtn = document.getElementById('checkout-btn');
        
        // --- ESTADO DEL CARRITO ---
        let cart = [];
        
        
        // --- FUNCIÓN DE CONEXIÓN (API) ---
        const fetchWebsiteData = async () => {
            try {
                console.log("Conectando con el sistema...");
                // 1. Llamada a tu función de Netlify
                const res = await fetch('/.netlify/functions/get-website-data');
                if (!res.ok) throw new Error('Error de red');
                const data = await res.json();
                return data;
            } catch (e) {
                console.error("Error cargando datos:", e);
                return null;
            }
        };


        // --- FUNCIONES DEL CARRITO ---
        const toggleCart = (show) => {
            if (show) {
                cartOverlay.classList.add('visible');
                cartDrawer.classList.add('visible');
            } else {
                cartOverlay.classList.remove('visible');
                cartDrawer.classList.remove('visible');
            }
        };

        const updateCartIcon = () => {
            const count = cart.length;
            // Escritorio
            cartItemCount.textContent = count;
            cartItemCount.classList.toggle('visible', count > 0);
            // Móvil
            mobileCartItemCount.textContent = count;
            mobileCartItemCount.classList.toggle('visible', count > 0);
        };

        const renderCart = () => {
            // Limpia el contenedor de items, pero mantiene el 'empty state'
            const items = cartItemsContainer.querySelectorAll('.cart-item');
            items.forEach(item => item.remove());

            if (cart.length === 0) {
                cartEmptyState.style.display = 'flex';
                checkoutBtn.disabled = true;
            } else {
                cartEmptyState.style.display = 'none';
                checkoutBtn.disabled = false;
                cart.forEach(item => {
                    const cartItemEl = document.createElement('div');
                    cartItemEl.className = 'cart-item flex items-start space-x-4 py-4 border-b';
                    cartItemEl.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover">
                        <div class="flex-grow">
                            <h4 class="font-bold">${item.name}</h4>
                            <p class="text-sm text-gray-500">
                                ${new Date(item.startDate + 'T00:00:00').toLocaleDateString('es-ES')} - ${new Date(item.endDate + 'T00:00:00').toLocaleDateString('es-ES')}
                            </p>
                            <p class="text-sm text-gray-500">${item.totalDays} día(s)</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold">$${(item.price * item.totalDays).toFixed(2)}</p>
                            <button class="cart-item-remove-btn text-sm mt-2" data-cart-id="${item.cartId}">
                                <i class="fas fa-trash-alt mr-1"></i>Eliminar
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItemEl);
                });
            }

            const subtotal = cart.reduce((total, item) => total + (item.price * item.totalDays), 0);
            cartSubtotalEl.textContent = `$${subtotal.toFixed(2)}`;
        };

        const addToCart = (item, startDate, endDate) => {
            const totalDays = Math.ceil(Math.abs(new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;
            const cartId = `${item.id}-${startDate}`; // ID único para el artículo y fecha

            // Evitar duplicados
            if (cart.some(cartItem => cartItem.cartId === cartId)) {
                alert('Este artículo ya está en tu carrito para estas fechas.');
                return;
            }
            
            cart.push({
                ...item,
                cartId: cartId,
                startDate: startDate,
                endDate: endDate,
                totalDays: totalDays,
                image: item.images[0] // Usar la primera imagen para el carrito
            });

            renderCart();
            updateCartIcon();
            toggleCart(true);
        };
        
        cartItemsContainer.addEventListener('click', (e) => {
            if (e.target.closest('.cart-item-remove-btn')) {
                const cartIdToRemove = e.target.closest('.cart-item-remove-btn').dataset.cartId;
                cart = cart.filter(item => item.cartId !== cartIdToRemove);
                renderCart();
                updateCartIcon();
            }
        });
        
        // --- FUNCIONES DE CHECKOUT ---
        const showCheckoutModal = () => {
            const checkoutModalContainer = document.getElementById('checkout-modal-container');
            const subtotal = cart.reduce((total, item) => total + (item.price * item.totalDays), 0);

            const summaryItemsHTML = cart.map(item => `
                <div class="checkout-summary-item">
                    <div class="flex items-start space-x-4">
                        <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover">
                        <div>
                            <p class="font-bold">${item.name}</p>
                            <p class="text-sm text-gray-500">${new Date(item.startDate + 'T00:00:00').toLocaleDateString('es-ES')} - ${new Date(item.endDate + 'T00:00:00').toLocaleDateString('es-ES')}</p>
                        </div>
                    </div>
                    <p class="font-bold">$${(item.price * item.totalDays).toFixed(2)}</p>
                </div>
            `).join('');

            checkoutModalContainer.innerHTML = `
                <div id="checkout-modal-overlay" class="checkout-modal-overlay">
                    <div id="checkout-modal-content" class="checkout-modal-content">
                        <div class="p-6 border-b flex justify-between items-center">
                            <h2 class="text-2xl font-display">Finalizar Reserva</h2>
                            <button id="checkout-close-btn" class="text-2xl text-gray-500 hover:text-black">&times;</button>
                        </div>
                        
                        <!-- Step 1: Contact Details -->
                        <div id="checkout-step-1" class="checkout-step active">
                            <div class="p-6">
                                <h3 class="font-bold mb-4">1. Detalles de Contacto</h3>
                                <form id="contact-form" class="space-y-4">
                                    <div>
                                        <label for="name" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                        <input type="text" id="name" name="name" required class="form-input mt-1">
                                    </div>
                                    <div>
                                        <label for="email" class="block text-sm font-medium text-gray-700">Correo Electrónico</label>
                                        <input type="email" id="email" name="email" required class="form-input mt-1">
                                    </div>
                                    <div>
                                        <label for="phone" class="block text-sm font-medium text-gray-700">Teléfono</label>
                                        <input type="tel" id="phone" name="phone" required class="form-input mt-1">
                                    </div>
                                </form>
                            </div>
                            <div class="p-6 bg-gray-50 border-t flex justify-end">
                                <button id="to-step-2-btn" class="bg-black text-white py-3 px-6 font-bold">Siguiente</button>
                            </div>
                        </div>

                        <!-- Step 2: Summary -->
                        <div id="checkout-step-2" class="checkout-step">
                            <div class="p-6 overflow-y-auto">
                                <h3 class="font-bold mb-4">2. Resumen y Confirmación</h3>
                                <div id="checkout-summary-container">
                                    ${summaryItemsHTML}
                                </div>
                                <div class="flex justify-between font-bold text-xl pt-4 mt-4 border-t">
                                    <span>Total:</span>
                                    <span>$${subtotal.toFixed(2)}</span>
                                </div>
                            </div>
                            <div class="p-6 bg-gray-50 border-t flex justify-between">
                                <button id="back-to-step-1-btn" class="bg-gray-200 text-black py-3 px-6 font-bold">Atrás</button>
                                <button id="to-step-3-btn" class="bg-black text-white py-3 px-6 font-bold">Continuar al Pago</button>
                            </div>
                        </div>

                        <!-- Step 3: Payment Simulation -->
                        <div id="checkout-step-3" class="checkout-step">
                             <div class="p-6">
                                <h3 class="font-bold mb-4">3. Ingreso de Pago Seguro</h3>
                                <form id="payment-form" class="space-y-4">
                                    <div>
                                        <label for="card-number" class="block text-sm font-medium text-gray-700">Número de Tarjeta</label>
                                        <input type="text" id="card-number" name="card-number" placeholder="0000 0000 0000 0000" required class="form-input mt-1" pattern="[0-9]{13,16}" title="Ingrese un número de tarjeta válido.">
                                    </div>
                                    <div>
                                        <label for="card-name" class="block text-sm font-medium text-gray-700">Nombre en la Tarjeta</label>
                                        <input type="text" id="card-name" name="card-name" placeholder="Nombre Apellido" required class="form-input mt-1">
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="card-expiry" class="block text-sm font-medium text-gray-700">Vencimiento (MM/AA)</label>
                                            <input type="text" id="card-expiry" name="card-expiry" placeholder="MM/AA" required class="form-input mt-1" pattern="(0[1-9]|1[0-2])\/([0-9]{2})" title="Use el formato MM/AA.">
                                        </div>
                                        <div>
                                            <label for="card-cvc" class="block text-sm font-medium text-gray-700">CVC</label>
                                            <input type="text" id="card-cvc" name="card-cvc" placeholder="123" required class="form-input mt-1" pattern="[0-9]{3,4}" title="Ingrese 3 o 4 dígitos.">
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="p-6 bg-gray-50 border-t flex justify-between">
                                <button id="back-to-step-2-btn" class="bg-gray-200 text-black py-3 px-6 font-bold">Atrás</button>
                                <button id="pay-now-btn" class="bg-black text-white py-3 px-6 font-bold">Pagar $${subtotal.toFixed(2)}</button>
                            </div>
                        </div>


                        <!-- Step 4: Confirmation -->
                        <div id="checkout-step-4" class="checkout-step">
                            <div class="p-8 text-center flex flex-col items-center justify-center">
                                <div id="payment-processing" class="flex flex-col items-center justify-center p-8">
                                    <div class="loader-circle mb-4"></div>
                                    <p class="text-lg">Procesando tu reserva...</p>
                                </div>
                                <div id="payment-success" class="hidden">
                                     <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6">
                                        <i class="fas fa-check text-4xl text-green-600"></i>
                                    </div>
                                    <h3 class="font-display text-3xl mb-2">¡Reserva Confirmada!</h3>
                                    <p class="text-gray-600">Hemos recibido tu solicitud. Recibirás un correo electrónico de confirmación en breve.</p>
                                    <p class="mt-4 font-bold">Número de Reserva: <span id="reservation-id"></span></p>
                                    <button id="finish-checkout-btn" class="mt-8 bg-black text-white py-3 px-8 font-bold">Aceptar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const overlay = document.getElementById('checkout-modal-overlay');
            const closeBtn = document.getElementById('checkout-close-btn');
            
            const toStep2Btn = document.getElementById('to-step-2-btn');
            const backToStep1Btn = document.getElementById('back-to-step-1-btn');
            const toStep3Btn = document.getElementById('to-step-3-btn');
            const backToStep2Btn = document.getElementById('back-to-step-2-btn');
            const payNowBtn = document.getElementById('pay-now-btn');
            
            const finishCheckoutBtn = document.getElementById('finish-checkout-btn');

            const steps = document.querySelectorAll('.checkout-step');
            const goToStep = (stepNumber) => {
                steps.forEach(step => step.classList.remove('active'));
                document.getElementById(`checkout-step-${stepNumber}`).classList.add('active');
            };

            const close = () => {
                overlay.classList.remove('visible');
                setTimeout(() => checkoutModalContainer.innerHTML = '', 400);
            };

            overlay.addEventListener('click', e => { if (e.target === overlay) close(); });
            closeBtn.addEventListener('click', close);
            
            toStep2Btn.addEventListener('click', () => {
                const form = document.getElementById('contact-form');
                if (form.checkValidity()) {
                    goToStep(2);
                } else {
                    form.reportValidity();
                }
            });
            
            backToStep1Btn.addEventListener('click', () => goToStep(1));
            toStep3Btn.addEventListener('click', () => goToStep(3));
            backToStep2Btn.addEventListener('click', () => goToStep(2));
            
            payNowBtn.addEventListener('click', () => {
                 const form = document.getElementById('payment-form');
                if (form.checkValidity()) {
                    goToStep(4);
                    const processing = document.getElementById('payment-processing');
                    const success = document.getElementById('payment-success');
                    setTimeout(() => {
                        processing.style.display = 'none';
                        success.classList.remove('hidden');
                        document.getElementById('reservation-id').textContent = `ADG-${Math.floor(Math.random() * 90000) + 10000}`;
                        
                        cart.forEach(cartItem => {
                             for (const category in rentalDataGlobal) {
                                const item = rentalDataGlobal[category].find(r => r.id === cartItem.id);
                                if (item) {
                                    let currentDate = new Date(cartItem.startDate + 'T00:00:00');
                                    const endDate = new Date(cartItem.endDate + 'T00:00:00');
                                    while(currentDate <= endDate) {
                                        const dateString = currentDate.toISOString().split('T')[0];
                                        if (!item.bookedDates.includes(dateString)) {
                                            item.bookedDates.push(dateString);
                                        }
                                        currentDate.setDate(currentDate.getDate() + 1);
                                    }
                                    break;
                                }
                            }
                        });

                        cart = [];
                        renderCart();
                        updateCartIcon();
                    }, 2000);
                } else {
                    form.reportValidity();
                }
            });

            finishCheckoutBtn.addEventListener('click', close);

            setTimeout(() => overlay.classList.add('visible'), 10);
        };


        // --- FUNCIONES DE RENDERIZADO Y NAVEGACIÓN ---
        const navigateTo = (targetId) => {
            const currentPage = document.querySelector('.page-active');
            const targetPage = document.getElementById(targetId);
            
            if (!targetPage || currentPage === targetPage) return;

            if (currentPage) {
                currentPage.classList.add('page-exiting');
                currentPage.classList.remove('page-active');
            }

            targetPage.style.display = 'block';
            setTimeout(() => {
                targetPage.classList.add('page-active');
                handleScrollHeader(); // Única llamada, en el momento correcto.
            }, 10);
            
            if (currentPage) {
                setTimeout(() => {
                    currentPage.classList.remove('page-exiting');
                    currentPage.style.display = 'none';
                }, 500);
            }

            let activeTarget = targetId;
             if (targetId.startsWith('project-detail-')) {
                activeTarget = 'projects';
            } else if (targetId.startsWith('rental-detail-')) {
                activeTarget = 'rental';
            } else if (targetId.startsWith('service-detail-')) {
                activeTarget = 'services';
            }
            allNavLinks.forEach(link => {
                link.classList.remove('nav-active');
                if (link.dataset.target === activeTarget) {
                    link.classList.add('nav-active');
                }
            });

            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            observeElements(targetPage);
        };
        
        const renderProjectDetail = (targetId) => {
            // targetId viene como "project-detail-ID_REAL"
            // Extraemos el ID real cortando "project-detail-" (15 caracteres)
            const realId = targetId.substring(15);
            
            // Buscamos en los datos reales
            const project = projectsData.find(p => String(p.id) === String(realId));
            
            if (!project) {
                console.error("Proyecto no encontrado:", realId);
                return;
            }
            
            const detailContainer = document.getElementById('project-detail-pages');
            
            // Usamos las imágenes del proyecto (project.images viene del backend)
            const images = project.images || [];
            
            const imagesHTML = images.length > 0 ? images.map(img => `
                <div class="gallery-item break-inside-avoid overflow-hidden relative img-container mb-6 group">
                    <img src="${img.imageUrl}" alt="${project.title}" loading="lazy" class="w-full h-auto object-cover shadow-sm transition-transform duration-500 group-hover:scale-105">
                    ${img.caption ? `<div class="absolute bottom-0 left-0 w-full p-2 bg-black/50 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">${img.caption}</div>` : ''}
                </div>
            `).join('') : '<p class="text-center col-span-full text-gray-400">Sin imágenes adicionales.</p>';
            
            detailContainer.innerHTML = `
                <section id="${targetId}" class="page-container pt-32 md:pt-40 pb-20 md:pb-24 bg-white">
                    <div class="container mx-auto px-6">
                        <div class="max-w-6xl mx-auto">
                            <a href="#" data-target="projects" class="nav-link text-gray-500 hover:text-black transition-colors mb-8 inline-flex items-center gap-2">
                                <i class="fas fa-arrow-left"></i> Volver a Proyectos
                            </a>
                            <div class="text-center mb-16 reveal">
                                <h2 class="text-4xl md:text-6xl font-display text-reveal mb-4">${project.title}</h2>
                                <p class="text-lg text-gray-600 mt-4 max-w-3xl mx-auto text-reveal text-center leading-relaxed">${project.description}</p>
                            </div>
                            <div class="columns-1 sm:columns-2 lg:columns-3 gap-6 space-y-6 reveal">
                                ${imagesHTML}
                            </div>
                        </div>
                    </div>
                </section>`;
            
            navigateTo(targetId);
        };

        const renderServiceDetail = (serviceId) => {
            const detailContainer = document.getElementById('service-detail-pages');
            const service = serviceDetails[serviceId];
            if (!service) return;

            const sectionsHTML = service.sections.map(section => `
                <div class="reveal">
                    <h3 class="text-3xl font-display text-black mb-4 text-reveal">${section.title}</h3>
                    <div class="prose max-w-none lg:prose-lg text-gray-600 leading-relaxed text-reveal text-justify">${section.content}</div>
                </div>
            `).join('');

            const galleryHTML = service.gallery.map(src => `
                <div class="gallery-item break-inside-avoid overflow-hidden relative img-container">
                    <img src="${src}" alt="${service.title}" loading="lazy" class="w-full h-auto object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x600/ff0000/ffffff?text=Error';">
                </div>
            `).join('');

            detailContainer.innerHTML = `
                <section id="${serviceId}" class="page-container">
                     <div class="h-auto md:h-[60vh] bg-zinc-700 flex items-center justify-center text-white pt-28 md:pt-36 pb-16">
                        <div class="text-center reveal">
                            <h1 class="text-5xl md:text-7xl font-display text-reveal py-2">${service.title}</h1>
                        </div>
                    </div>
                    <div class="container mx-auto px-6 py-20 md:py-24">
                        <div class="max-w-4xl mx-auto">
                             <a href="#" data-target="services" class="nav-link text-gray-500 hover:text-black transition-colors mb-12 inline-block">
                                <i class="fas fa-arrow-left mr-2"></i> Volver a Servicios
                            </a>
                            <div class="reveal">
                                <p class="text-xl text-gray-700 leading-relaxed italic text-center mb-16 text-reveal">${service.intro}</p>
                            </div>
                            <div class="space-y-16">
                                ${sectionsHTML}
                            </div>
                             <div class="mt-20 reveal">
                                <h3 class="text-3xl font-display text-black mb-8 text-center text-reveal">Galería de Muestra</h3>
                                <div class="columns-2 md:columns-3 gap-6 space-y-6">${galleryHTML}</div>
                            </div>
                            <div class="text-center mt-20 reveal">
                                <h3 class="text-3xl font-display text-gray-800 text-reveal">¿Interesado en este servicio?</h3>
                                <a href="#" data-target="contact" class="nav-link btn-primary mt-6 inline-block bg-black text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-gray-800 transition-transform hover:scale-105">Hablemos de tu Proyecto</a>
                            </div>
                        </div>
                    </div>
                </section>
            `;
            navigateTo(serviceId);
        };

        const renderRentalDetail = (rentalId) => {
            const detailContainer = document.getElementById('rental-detail-pages');
            let item;
            let itemCategory;
            for (const category in rentalDataGlobal) {
                const found = rentalDataGlobal[category].find(r => r.id == rentalId.split('-')[2]);
                if (found) {
                    item = found;
                    itemCategory = category;
                    break;
                }
            }
            if (!item) return;

            const carouselItemsHTML = item.images.map(src => `<div class="carousel-item"><img src="${src}" alt="${item.name}" class="w-full h-full object-cover"></div>`).join('');

            detailContainer.innerHTML = `
                <section id="${rentalId}" class="page-container pt-32 md:pt-40 pb-20 md:pb-24 bg-white">
                    <div class="container mx-auto px-6">
                        <div class="max-w-6xl mx-auto">
                            <a href="#" data-target="rental" class="nav-link text-gray-500 hover:text-black transition-colors mb-8 inline-block">
                                <i class="fas fa-arrow-left mr-2"></i> Volver al Catálogo
                            </a>
                            <div class="grid grid-cols-1 lg:grid-cols-5 gap-12">
                                <div class="lg:col-span-3">
                                    <div class="carousel-container sticky top-28">
                                        <div class="carousel-track">${carouselItemsHTML}</div>
                                        <button class="carousel-button prev"><i class="fas fa-chevron-left"></i></button>
                                        <button class="carousel-button next"><i class="fas fa-chevron-right"></i></button>
                                    </div>
                                </div>
                                <div class="lg:col-span-2 reveal">
                                    <h2 class="text-4xl md:text-5xl font-display mb-2 text-reveal">${item.name}</h2>
                                    <p class="text-3xl font-bold text-gray-800 mb-6 text-reveal">$${item.price}<span class="text-lg font-normal text-gray-500"> / día</span></p>
                                    <p class="text-gray-600 leading-relaxed text-justify text-reveal mb-8">${item.long_desc}</p>
                                    
                                    <button id="open-calendar-modal-btn" class="btn-primary w-full text-center inline-block bg-black text-white font-bold py-4 px-8 rounded-full text-lg hover:bg-gray-800 border border-gray-300">
                                        <i class="fas fa-calendar-alt mr-2"></i> Consultar Disponibilidad
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
            
            navigateTo(rentalId);

            document.getElementById('open-calendar-modal-btn').addEventListener('click', () => {
                showCalendarModal(item, item.bookedDates);
            });

            const track = detailContainer.querySelector('.carousel-track');
            const slides = Array.from(track.children);
            const nextButton = detailContainer.querySelector('.next');
            const prevButton = detailContainer.querySelector('.prev');
            let currentIndex = 0;
            const updateSlidePosition = () => {
                if (track) track.style.transform = `translateX(${-100 * currentIndex}%)`;
            };
            if(nextButton) nextButton.addEventListener('click', () => { currentIndex = (currentIndex + 1) % slides.length; updateSlidePosition(); });
            if(prevButton) prevButton.addEventListener('click', () => { currentIndex = (currentIndex - 1 + slides.length) % slides.length; updateSlidePosition(); });
        };
        
        
        const renderVideos = (videosList) => {
            const container = document.getElementById('videos-container');
            if(!container) return;

            if (!videosList || videosList.length === 0) {
                container.parentElement.parentElement.style.display = 'none'; 
                return;
            }

            container.innerHTML = videosList.map(video => {
                let embedSrc = video.embedUrl || "";
                if (embedSrc.includes('watch?v=')) {
                    embedSrc = embedSrc.replace('watch?v=', 'embed/');
                } else if (embedSrc.includes('youtu.be/')) {
                    embedSrc = embedSrc.replace('youtu.be/', 'www.youtube.com/embed/');
                }

                // AJUSTES: h-[450px] (Altura fija alta), w-full, rounded-none (cuadrado)
                return `
                <div class="w-full h-64 md:h-[350px] overflow-hidden shadow-lg gallery-item group bg-black rounded-none border border-gray-800 relative">
                    <iframe src="${embedSrc}" title="${video.title || 'Video'}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full object-cover"></iframe>
                </div>
                `;
            }).join('');
        };
        
        const renderClientLogos = (logosList) => {
            const container = document.getElementById('client-logos-container');
            if(!container) return;

            if (!logosList || logosList.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-400 w-full">Nuestros clientes.</p>';
                return;
            }

            container.innerHTML = logosList.map(logo => `
                <img src="${logo.logoUrl}" alt="${logo.clientName}" class="client-logo h-24 md:h-32 w-auto object-contain transition-all duration-300 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 hover:scale-110">
            `).join('');
        };
        
        
        const renderPortfolio = () => {
            const portfolioGallery = document.getElementById('portfolio-gallery');
            if(!portfolioGallery) return;
            
            if (portfolioData.length === 0) {
                portfolioGallery.innerHTML = '<p class="text-center col-span-full text-gray-400 py-10">Cargando portafolio...</p>';
                return;
            }

            portfolioGallery.innerHTML = portfolioData.map(item => `
                <div class="gallery-item break-inside-avoid overflow-hidden relative img-container mb-6">
                    <img src="${item.imageUrl}" alt="${item.caption || 'Foto Portafolio'}" loading="lazy" class="w-full h-auto object-cover hover:scale-105 transition-transform duration-700">
                    <div class="overlay absolute inset-0 flex items-end p-4 bg-gradient-to-t from-black/60 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300">
                        <p class="text-white text-lg font-bold translate-y-4 transition-transform duration-300">${item.caption || ''}</p>
                    </div>
                </div>
            `).join('');
        };

        const renderServicesGrid = () => {
            const servicesGrid = document.getElementById('services-grid');
            if(servicesGrid) {
                servicesGrid.innerHTML = servicesData.map(service => `
                    <a href="#" data-target="service-detail-${service.id}" class="nav-link service-grid-item items-center justify-center text-center py-12">
                        <div class="service-icon-wrapper">
                            <i class="${service.icon} service-icon"></i>
                        </div>
                        <h3 class="text-2xl font-display text-gray-900">${service.title}</h3>
                    </a>
                `).join('');
            }
        };

        const renderRentalPage = () => {
            const filtersContainer = document.getElementById('rental-filters');
            const gridContainer = document.getElementById('rental-grid-categorized');
            if (!filtersContainer || !gridContainer) return;

            const categories = ['Todo', ...Object.keys(rentalDataGlobal)];
            filtersContainer.innerHTML = categories.map(cat => `<button class="rental-category-btn ${cat === 'Todo' ? 'active' : ''}" data-category="${cat}">${cat}</button>`).join('');

            const renderItems = (category) => {
                let itemsToRender = (category === 'Todo') ? Object.values(rentalDataGlobal).flat() : rentalDataGlobal[category];
                gridContainer.innerHTML = itemsToRender.map(item => `
                    <div class="rental-card reveal">
                         <div class="carousel-container aspect-w-4 aspect-h-3">
                            <div class="carousel-track flex" data-current-index="0">
                                ${item.images.map(src => `<div class="carousel-item flex-shrink-0 w-full"><img src="${src}" alt="${item.name}" class="w-full h-full object-cover"></div>`).join('')}
                            </div>
                            <button class="carousel-button prev rental-carousel-button" data-direction="-1"><i class="fas fa-chevron-left"></i></button>
                            <button class="carousel-button next rental-carousel-button" data-direction="1"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="p-6 flex flex-col flex-grow">
                            <div class="flex justify-between items-baseline">
                                <h3 class="font-display text-2xl">${item.name}</h3>
                                <p class="font-bold text-xl text-gray-800">$${item.price}<span class="text-sm font-normal text-gray-500">/día</span></p>
                            </div>
                            <p class="text-gray-600 text-sm my-4 flex-grow">${item.description}</p>
                            <a href="#" data-target="rental-detail-${item.id}" class="nav-link text-sm font-bold text-black uppercase tracking-wider group inline-block mt-auto">
                                Ver Detalles <span class="block max-w-0 group-hover:max-w-full transition-all duration-500 h-0.5 bg-black"></span>
                            </a>
                        </div>
                    </div>
                `).join('');
                
                const cardObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach((entry, index) => {
                        if (entry.isIntersecting) {
                            setTimeout(() => entry.target.classList.add('visible'), index * 75);
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.1 });
                gridContainer.querySelectorAll('.rental-card').forEach(card => cardObserver.observe(card));
            };

            filtersContainer.addEventListener('click', (e) => {
                if (e.target.matches('.rental-category-btn')) {
                    filtersContainer.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                    renderItems(e.target.dataset.category);
                }
            });
            gridContainer.addEventListener('click', function(e) {
                const button = e.target.closest('.rental-carousel-button');
                if (button) {
                    e.preventDefault(); e.stopPropagation();
                    const track = button.closest('.carousel-container').querySelector('.carousel-track');
                    const slides = Array.from(track.children);
                    const direction = parseInt(button.dataset.direction);
                    let currentIndex = parseInt(track.dataset.currentIndex);
                    currentIndex = (currentIndex + direction + slides.length) % slides.length;
                    track.style.transform = `translateX(-${currentIndex * 100}%)`;
                    track.dataset.currentIndex = currentIndex;
                }
            });
            renderItems('Todo');
        };
        
        const renderProjects = () => {
            const projectsContainer = document.getElementById('projects-container');
            if(!projectsContainer) return;

            if (projectsData.length === 0) {
                projectsContainer.innerHTML = '<p class="text-center text-gray-400 py-10">Pronto publicaremos nuevos proyectos.</p>';
                return;
            }

            projectsContainer.innerHTML = projectsData.map((project, index) => `
                <div class="grid grid-cols-1 md:grid-cols-2 items-center reveal gap-8 md:gap-12">
                    <div class="p-4 md:p-8 ${index % 2 === 0 ? 'md:text-right' : 'md:order-last md:text-left'}">
                        <h3 class="text-3xl md:text-4xl font-display mb-4 text-reveal">${project.title}</h3>
                        <p class="text-gray-600 leading-relaxed mb-6 text-reveal line-clamp-3">${project.description}</p>
                        <a href="#" data-target="project-detail-${project.id}" class="nav-link text-black font-bold uppercase tracking-widest text-sm group inline-block border-b-2 border-black pb-1 hover:text-gray-600 hover:border-gray-600 transition-all">
                            Ver Galería Completa
                        </a>
                    </div>
                    <div class="overflow-hidden gallery-item img-container h-64 md:h-96 shadow-lg">
                        <img src="${project.coverImageUrl}" alt="${project.title}" class="w-full h-full object-cover">
                    </div>
                </div>
            `).join('');
        };

        // --- LÓGICA DEL MODAL DEL CALENDARIO ---
        const showCalendarModal = (item, bookedDates) => {
            const modalContainer = document.getElementById('calendar-modal-container');
            modalContainer.innerHTML = `
                <div id="calendar-modal-overlay" class="calendar-modal-overlay">
                    <div class="calendar-modal-content">
                        <div class="calendar-header">
                            <button id="calendar-prev" class="calendar-nav-btn"><i class="fas fa-chevron-left"></i></button>
                            <h3 id="calendar-month-year" class="font-display text-2xl"></h3>
                            <button id="calendar-next" class="calendar-nav-btn"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="calendar-grid">
                            <div class="calendar-day-name">D</div><div class="calendar-day-name">L</div><div class="calendar-day-name">M</div>
                            <div class="calendar-day-name">M</div><div class="calendar-day-name">J</div><div class="calendar-day-name">V</div>
                            <div class="calendar-day-name">S</div>
                        </div>
                        <div id="calendar-days" class="calendar-grid"></div>
                        <div class="booking-summary">
                            <div class="flex justify-between items-center text-sm"><span>Desde:</span><span id="summary-start-date">--/--/----</span></div>
                            <div class="flex justify-between items-center text-sm"><span>Hasta:</span><span id="summary-end-date">--/--/----</span></div>
                            <div class="flex justify-between items-center text-sm border-t mt-2 pt-2"><span>Total Días:</span><span id="summary-total-days">0</span></div>
                            <div class="flex justify-between items-center text-xl font-bold mt-2"><span>Total a Pagar:</span><span id="summary-total-price">$0</span></div>
                        </div>
                        <button id="add-to-cart-btn" class="w-full mt-4 bg-black text-white py-3 disabled:bg-gray-400" disabled>Agregar al Carrito</button>
                    </div>
                </div>
            `;
            
            const overlay = document.getElementById('calendar-modal-overlay');
            const prevBtn = document.getElementById('calendar-prev');
            const nextBtn = document.getElementById('calendar-next');
            const monthYearEl = document.getElementById('calendar-month-year');
            const daysContainer = document.getElementById('calendar-days');
            const summaryStartDate = document.getElementById('summary-start-date');
            const summaryEndDate = document.getElementById('summary-end-date');
            const summaryTotalDays = document.getElementById('summary-total-days');
            const summaryTotalPrice = document.getElementById('summary-total-price');
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            
            const close = () => {
                overlay.classList.remove('visible');
                setTimeout(() => modalContainer.innerHTML = '', 300);
            };

            setTimeout(() => overlay.classList.add('visible'), 10);

            let currentDate = new Date();
            currentDate.setDate(1);
            let selectedStartDate = null;
            let selectedEndDate = null;

            const renderMonth = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const today = new Date(); today.setHours(0,0,0,0);
                monthYearEl.textContent = new Intl.DateTimeFormat('es-ES', { month: 'long', year: 'numeric' }).format(currentDate);
                daysContainer.innerHTML = '';
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                for (let i = 0; i < firstDayOfMonth; i++) daysContainer.innerHTML += `<div></div>`;
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('button');
                    dayEl.textContent = day;
                    dayEl.classList.add('calendar-day');
                    const dayDate = new Date(year, month, day);
                    const dateString = dayDate.toISOString().split('T')[0];
                    if (dayDate < today || bookedDates.includes(dateString)) dayEl.classList.add('disabled');
                    else dayEl.dataset.date = dateString;
                    
                    if (selectedStartDate && dateString === selectedStartDate.toISOString().split('T')[0]) dayEl.classList.add('selected');
                    if (selectedEndDate && dateString === selectedEndDate.toISOString().split('T')[0]) dayEl.classList.add('selected');
                    if (selectedStartDate && selectedEndDate && dayDate > selectedStartDate && dayDate < selectedEndDate) dayEl.classList.add('in-range');
                    daysContainer.appendChild(dayEl);
                }
            };
            
            const updateSummary = () => {
                addToCartBtn.disabled = !(selectedStartDate && selectedEndDate);
                if (selectedStartDate && selectedEndDate) {
                    summaryStartDate.textContent = selectedStartDate.toLocaleDateString('es-ES');
                    summaryEndDate.textContent = selectedEndDate.toLocaleDateString('es-ES');
                    const diffDays = Math.ceil(Math.abs(selectedEndDate - selectedStartDate) / (1000 * 60 * 60 * 24)) + 1;
                    summaryTotalDays.textContent = diffDays;
                    summaryTotalPrice.textContent = `$${(diffDays * item.price).toFixed(2)}`;
                } else if (selectedStartDate) {
                    summaryStartDate.textContent = selectedStartDate.toLocaleDateString('es-ES');
                    summaryEndDate.textContent = '--/--/----';
                    summaryTotalDays.textContent = '1';
                    summaryTotalPrice.textContent = `$${item.price.toFixed(2)}`;
                } else {
                     summaryStartDate.textContent = '--/--/----'; summaryEndDate.textContent = '--/--/----';
                     summaryTotalDays.textContent = '0'; summaryTotalPrice.textContent = '$0';
                }
            };
            
            daysContainer.addEventListener('click', (e) => {
                if (e.target.matches('.calendar-day') && !e.target.classList.contains('disabled')) {
                    const clickedDate = new Date(e.target.dataset.date + 'T00:00:00');
                    if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                        selectedStartDate = clickedDate; selectedEndDate = null;
                    } else if (clickedDate < selectedStartDate) {
                        selectedStartDate = clickedDate;
                    } else {
                        selectedEndDate = clickedDate;
                        let validRange = true;
                        const tempDate = new Date(selectedStartDate);
                        while(tempDate <= selectedEndDate) {
                            if(bookedDates.includes(tempDate.toISOString().split('T')[0])) {
                                validRange = false; break;
                            }
                            tempDate.setDate(tempDate.getDate() + 1);
                        }
                        if(!validRange) {
                            alert("El rango seleccionado incluye días no disponibles. Por favor, elige otro rango.");
                            selectedStartDate = null; selectedEndDate = null;
                        }
                    }
                    renderMonth(); updateSummary();
                }
            });
            
            addToCartBtn.addEventListener('click', () => {
                if (selectedStartDate && selectedEndDate) {
                    addToCart(item, selectedStartDate.toISOString().split('T')[0], selectedEndDate.toISOString().split('T')[0]);
                    close();
                }
            });

            prevBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderMonth(); });
            nextBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderMonth(); });
            overlay.addEventListener('click', e => { if(e.target === overlay) close(); });
            renderMonth();
        };

        const observeElements = (container) => {
            if(!container) return;
            
            const revealElements = container.querySelectorAll('.reveal:not(.visible)');
            const revealObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                        
                        const textElements = entry.target.querySelectorAll('.text-reveal:not(.revealed)');
                        textElements.forEach(textEl => {
                            setTimeout(() => textEl.classList.add('revealed'), 200);
                        });
                    }
                });
            }, { threshold: 0.1, rootMargin: "0px 0px -50px 0px" });
            revealElements.forEach(el => revealObserver.observe(el));
            
            const imgContainers = container.querySelectorAll('.img-container:not(.loaded)');
            const imgObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target.querySelector('img');
                        if (img && img.complete) {
                            entry.target.classList.add('loaded'); observer.unobserve(entry.target);
                        } else if (img) {
                            img.addEventListener('load', () => {
                                entry.target.classList.add('loaded'); observer.unobserve(entry.target);
                            });
                        }
                    }
                });
            }, { threshold: 0.1 });
            imgContainers.forEach(container => imgObserver.observe(container));
        };
        
        // Lightbox mejorado con navegación entre imágenes
        let currentLightboxIndex = 0;
        let lightboxImages = [];
        
        const openLightbox = (src, caption = '', imagesArray = [], index = 0) => {
            lightboxImages = imagesArray; currentLightboxIndex = index;
            lightboxImage.src = src; lightboxCaption.textContent = caption;
            lightboxPrev.style.display = imagesArray.length > 1 ? 'flex' : 'none';
            lightboxNext.style.display = imagesArray.length > 1 ? 'flex' : 'none';
            lightbox.classList.remove('hidden');
            setTimeout(() => { lightbox.classList.add('visible'); lightbox.classList.remove('opacity-0'); }, 10);
        };
        
        const closeLightbox = () => { 
            lightbox.classList.add('opacity-0'); 
            setTimeout(() => { lightbox.classList.add('hidden'); lightbox.classList.remove('visible'); lightboxImage.src = ''; }, 300); 
        };
        
        const navigateLightbox = (direction) => {
            if (lightboxImages.length === 0) return;
            currentLightboxIndex = (direction === 'next') ? (currentLightboxIndex + 1) % lightboxImages.length : (currentLightboxIndex - 1 + lightboxImages.length) % lightboxImages.length;
            const newImage = lightboxImages[currentLightboxIndex];
            lightboxImage.style.opacity = '0';
            setTimeout(() => {
                lightboxImage.src = newImage.src;
                lightboxCaption.textContent = newImage.title || '';
                lightboxImage.style.opacity = '1';
            }, 200);
        };
        
        // --- MANEJADORES DE EVENTOS ---
        document.addEventListener('click', function(e) {
            const navLink = e.target.closest('.nav-link');
            if (navLink) {
                e.preventDefault();
                const targetId = navLink.dataset.target;

                if (cartDrawer.classList.contains('visible')) {
                    toggleCart(false);
                }
                
                if (targetId.startsWith('project-detail-')) renderProjectDetail(targetId);
                else if (targetId.startsWith('rental-detail-')) renderRentalDetail(targetId);
                else if (targetId.startsWith('service-detail-')) renderServiceDetail(targetId);
                else navigateTo(targetId);

                if (mobileMenu.classList.contains('open')) toggleMobileMenu(false);
            }
            
            const galleryItem = e.target.closest('.gallery-item');
            if(galleryItem) {
                const clickedImg = galleryItem.querySelector('img');
                const allVisibleItems = Array.from(document.querySelectorAll('.page-active .gallery-item'));
                const imagesArray = allVisibleItems.map(item => ({
                    src: item.querySelector('img').src,
                    title: item.querySelector('.overlay p')?.textContent || item.querySelector('img').alt
                }));
                const currentIndex = allVisibleItems.indexOf(galleryItem);
                openLightbox(clickedImg.src, imagesArray[currentIndex].title, imagesArray, currentIndex);
            }
        });
        
        const handleScrollHeader = () => {
            const isServicePage = !!document.querySelector('.page-active[id^="service-detail-"]');
            
            if (window.scrollY > 50) {
                header.classList.add('header-scrolled');
                header.classList.remove('header-dark'); 
            } else { // At top of page
                header.classList.remove('header-scrolled');
                if (isServicePage) {
                    header.classList.add('header-dark');
                } else {
                    header.classList.remove('header-dark');
                }
            }
        };

        window.addEventListener('scroll', handleScrollHeader, { passive: true });
        
        const toggleMobileMenu = (open) => {
            mobileMenu.classList.toggle('open', open);
            mobileMenuButton.classList.toggle('open', open);
            mobileMenuButton.setAttribute('aria-expanded', open);
            mobileMenu.setAttribute('aria-hidden', !open);
            mobileMenu.querySelectorAll('.mobile-nav-link').forEach((link, index) => {
                setTimeout(() => {
                    link.style.opacity = open ? '1' : '0';
                    link.style.transform = open ? 'translateY(0)' : 'translateY(30px)';
                }, 150 + index * 50);
            });
        };
        
        mobileMenuButton.addEventListener('click', () => toggleMobileMenu(!mobileMenu.classList.contains('open')));
        lightboxClose.addEventListener('click', closeLightbox);
        lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
        lightboxPrev.addEventListener('click', () => navigateLightbox('prev'));
        lightboxNext.addEventListener('click', () => navigateLightbox('next'));
        document.addEventListener('keydown', (e) => {
            if (!lightbox.classList.contains('hidden')) {
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') navigateLightbox('prev');
                if (e.key === 'ArrowRight') navigateLightbox('next');
            }
        });

        // Eventos del Carrito (Actualizados)
        cartButton.addEventListener('click', () => toggleCart(true));
        mobileCartButton.addEventListener('click', () => {
            toggleCart(true);
            toggleMobileMenu(false);
        });
        checkoutBtn.addEventListener('click', () => {
            if (cart.length > 0) {
                toggleCart(false);
                // Espera a que el carrito se cierre para abrir el checkout
                setTimeout(showCheckoutModal, 500);
            }
        });
        cartCloseBtn.addEventListener('click', () => toggleCart(false));
        cartOverlay.addEventListener('click', () => toggleCart(false));

        // --- INICIALIZACIÓN MAESTRA ---
        const initialize = async () => {
            const apiData = await fetchWebsiteData();
            
            // Variables locales para videos y logos (o puedes hacerlas globales arriba si prefieres)
            let videosData = [];
            let clientLogosData = [];

            if (apiData) {
                console.log("Datos recibidos:", apiData);

                // --- MÓDULO 1: IDENTIDAD ---
                const imgs = apiData.sysImages || {};
                const ident = apiData.identity || {};
                const about = apiData.about || {};

                // (A. Logos del sistema, B. Quién Soy, C. Redes - CÓDIGO EXISTENTE SE MANTIENE IGUAL)
                if (imgs.logo_black) document.querySelectorAll('.logo-dark').forEach(el => el.src = imgs.logo_black);
                if (imgs.logo_white) document.querySelectorAll('.logo-light').forEach(el => el.src = imgs.logo_white);
                if (imgs.favicon) { const fav = document.querySelector("link[rel*='icon']"); if(fav) fav.href = imgs.favicon; }
                
                if (about.intro_phrase) { const el = document.getElementById('about-intro-phrase'); if(el) el.textContent = `"${about.intro_phrase}"`; }
                if (about.bio) { const el = document.getElementById('about-bio'); if(el) el.innerHTML = about.bio; }
                if (about.process) { const el = document.getElementById('about-process'); if(el) el.innerHTML = about.process; }
                if (about.profile_image) { const img = document.querySelector('#about img'); if(img) img.src = about.profile_image; }

                const updateLink = (aria, url) => { if(!url) return; document.querySelectorAll(`a[aria-label="${aria}"]`).forEach(a => { a.href = url; a.target = "_blank"; }); };
                updateLink('Instagram', ident.social_instagram);
                updateLink('Facebook', ident.social_facebook);
                updateLink('YouTube', ident.social_youtube);
                updateLink('WhatsApp', ident.social_whatsapp ? `https://wa.me/${ident.social_whatsapp.replace(/[^0-9]/g, '')}` : null);
                if (ident.social_maps) { const map = document.getElementById('google-map'); if(map && ident.social_maps.includes('http')) map.src = ident.social_maps.match(/src="([^"]+)"/)?.[1] || ident.social_maps; }

                // --- MÓDULO 2: DATOS ---
                portfolioData = apiData.portfolioGallery || [];
                projectsData = apiData.projects || [];
                
                // NUEVO: Extraer Videos y Logos
                videosData = apiData.videos || [];
                clientLogosData = apiData.clientLogos || [];
            }

            // Renderizado
            renderPortfolio(); 
            renderProjects(); 
            
            // NUEVO: Renderizar Videos y Logos
            renderVideos(videosData);
            renderClientLogos(clientLogosData);

            renderServicesGrid(); 
            renderRentalPage();
            renderCart(); 
            updateCartIcon();

            setTimeout(() => pageLoader.classList.add('hidden'), 1500);
            
            if(window.location.hash) {
                const target = window.location.hash.substring(1);
                const el = document.getElementById(target);
                if(el) navigateTo(target);
            } else {
                const initialPage = document.getElementById('portfolio');
                if(initialPage) {
                    initialPage.classList.add('page-active');
                    observeElements(initialPage);
                    document.querySelectorAll('.nav-link[data-target="portfolio"]').forEach(l => l.classList.add('nav-active'));
                }
            }
        };

        // Arrancamos
        initialize();

    });
    </script>
</body>
</html>









