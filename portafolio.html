<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adán Gómez | Fotógrafo Profesional</title>
    <link rel="icon" id="dynamic-favicon" type="image/png" href="https://placehold.co/32x32/1a1a1a/ffffff?text=AG">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root { --bg-main: #FDFDFD; --text-dark: #1a1a1a; --text-light: #f8f9fa; --accent: #3a3a3a; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg-main); color: var(--text-dark); overflow-x: hidden; }
        h1, h2, h3, h4, .font-display { font-family: 'Cormorant Garamond', serif; line-height: 1.4; }
        
        /* Loader & Transitions */
        .page-container { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .page-active { display: block; opacity: 1; }
        .page-exiting { display: block; opacity: 0; }
        .reveal { opacity: 0; transition: opacity 1.2s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .reveal.visible { opacity: 1; }
        .loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-main); z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s ease, visibility 0.5s ease; }
        .loader.hidden { opacity: 0; visibility: hidden; }
        .loader-circle { width: 50px; height: 50px; border: 3px solid rgba(0, 0, 0, 0.1); border-radius: 50%; border-top-color: var(--accent); animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Header & Nav */
        #header { transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); padding: 1.5rem 0; background: transparent; }
        #header.header-scrolled { padding: 0.5rem 0; background-color: rgba(253, 253, 253, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
        .nav-link-underline { position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background-color: black; transition: width 0.3s ease; }
        .nav-link:hover .nav-link-underline, .nav-link.nav-active .nav-link-underline { width: 100%; }

        /* Gallery & Images */
        .gallery-item { cursor: pointer; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.5s; position: relative; overflow: hidden; break-inside: avoid; margin-bottom: 1.5rem; }
        .gallery-item:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); }
        .gallery-item img { transition: transform 0.8s ease; width: 100%; display: block; }
        .gallery-item:hover img { transform: scale(1.05); }
        .gallery-item .overlay { opacity: 0; transition: opacity 0.5s ease; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 80%); }
        .gallery-item:hover .overlay { opacity: 1; }

        /* Lightbox */
        #lightbox { background-color: rgba(10, 10, 10, 0.95); backdrop-filter: blur(8px); transition: opacity 0.4s; }
        #lightbox.visible #lightbox-image { transform: scale(1); }
        #lightbox-image { transform: scale(0.9); transition: transform 0.4s; max-height: 90vh; max-width: 90vw; object-fit: contain; }

        /* Mobile Menu */
        #mobile-menu { background-color: rgba(253, 253, 253, 0.98); backdrop-filter: blur(20px); transform: translateX(100%); transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1); }
        #mobile-menu.open { transform: translateX(0); }

        /* Cart */
        #cart-drawer { transform: translateX(100%); transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1); }
        #cart-drawer.visible { transform: translateX(0); }
        .cart-item-count { transform: scale(0); transition: transform 0.3s; }
        .cart-item-count.visible { transform: scale(1); }
        
        /* Utils */
        .img-placeholder { background-color: #f3f4f6; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* --- Estilos para la sección de Alquiler --- */
        .rental-category-btn { padding: 0.5rem 1.5rem; border: 1px solid #d1d5db; border-radius: 0; transition: all 0.3s ease; font-weight: 500; white-space: nowrap; flex-shrink: 0; }
        .rental-category-btn.active, .rental-category-btn:hover { background-color: var(--text-dark); color: white; border-color: var(--text-dark); }
        .rental-card { background-color: white; border: 1px solid #e5e7eb; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); opacity: 0; transform: translateY(20px); display: flex; flex-direction: column; }
        .rental-card.visible { opacity: 1; transform: translateY(0); }
        .rental-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        
        /* Carousel Rental */
        .carousel-container { overflow: hidden; position: relative; }
        .carousel-track { display: flex; transition: transform 0.5s ease-in-out; }
        .carousel-item { min-width: 100%; }
        .carousel-button { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.4); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; z-index: 10; opacity: 0; transition: opacity 0.3s ease; }
        .carousel-container:hover .carousel-button { opacity: 1; }
        .carousel-button:hover { background-color: rgba(0,0,0,0.7); }
        .carousel-button.prev { left: 10px; }
        .carousel-button.next { right: 10px; }
        
        /* Servicios */
        .service-grid-item { background-color: white; border: 1px solid #e5e7eb; border-radius: 0; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; display: flex; flex-direction: column; padding: 2rem; }
        .service-grid-item:hover { transform: translateY(-10px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); border-color: var(--accent); }
        .service-icon-wrapper { width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: #f3f4f6; margin-bottom: 1.5rem; transition: all 0.4s ease; }
        .service-grid-item:hover .service-icon-wrapper { background-color: var(--accent); transform: rotate(15deg) scale(1.1); }
        .service-icon { font-size: 2rem; color: var(--accent); transition: color 0.4s ease; }
        .service-grid-item:hover .service-icon { color: white; }
        
        /* Header Dinámico (Estilos Extra para Logo) */
        #header.header-dark .logo-dark { display: none; }
        #header.header-dark .logo-light { display: block; }
        #header:not(.header-dark) .logo-light { display: none; }
        #header:not(.header-dark) .logo-dark { display: block; }
        #header.header-dark .nav-link-text, #header.header-dark #mobile-menu-button .icon-bar, #header.header-dark .social-icon, #header.header-dark #cart-button { color: white; }
        #header.header-dark .nav-link-underline { background-color: white; }

        /* Text Reveal */
        .text-reveal { position: relative; overflow: hidden; }
        .text-reveal::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-main); transform: translateX(0); transition: transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .text-reveal.revealed::after { transform: translateX(101%); }
    </style>
</head>
<body class="antialiased">

    <div class="loader" id="page-loader">
        <div class="flex flex-col items-center w-3/4 max-w-xs md:max-w-md">
            <img src="https://placehold.co/400x150/ffffff/1a1a1a?text=ADAN+GOMEZ" alt="Logo Adán Gómez" class="w-full h-auto mb-8 logo-dark" id="loader-logo">
            <div class="loader-circle"></div>
        </div>
    </div>
    
    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="#" data-target="portfolio" class="nav-link relative group">
                <img src="https://placehold.co/350x120/ffffff/1a1a1a?text=ADAN+GOMEZ" alt="Logo Adán Gómez" class="w-40 lg:w-[250px] h-auto transition-all duration-300 group-hover:scale-105 logo-dark" id="header-logo-dark">
                <img src="https://placehold.co/350x120/1a1a1a/ffffff?text=ADAN+GOMEZ" alt="Logo Adán Gómez Blanco" class="w-40 lg:w-[250px] h-auto transition-all duration-300 group-hover:scale-105 logo-light" id="header-logo-light" style="display: none;">
            </a>

            <div class="flex items-center">
                <nav class="hidden lg:flex items-center space-x-8 text-xs uppercase tracking-widest font-bold text-gray-800">
                    <a href="#" data-target="portfolio" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Portafolio</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="projects" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Proyectos</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="services" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Servicios</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="rental" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Alquiler</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="about" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Quién Soy</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="contact" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Contacto</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </nav>

                <div class="hidden lg:flex items-center space-x-4 ml-8">
                    <a href="#" aria-label="WhatsApp" class="social-icon text-gray-700 hover:text-black transition-colors link-whatsapp"><i class="fab fa-whatsapp fa-lg"></i></a>
                    <a href="#" aria-label="Instagram" class="social-icon text-gray-700 hover:text-black transition-colors link-instagram"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="#" aria-label="YouTube" class="social-icon text-gray-700 hover:text-black transition-colors link-youtube"><i class="fab fa-youtube fa-lg"></i></a>
                    <button id="cart-button" aria-label="Ver carrito de compras" class="cart-button social-icon text-gray-700 hover:text-black transition-colors ml-2">
                        <i class="fas fa-shopping-bag fa-lg"></i>
                        <span id="cart-item-count" class="cart-item-count absolute -top-2 -right-2 bg-black text-white text-[10px] w-4 h-4 flex items-center justify-center rounded-full font-bold" style="transform: scale(0);">0</span>
                    </button>
                </div>

                <button id="mobile-menu-button" class="lg:hidden z-50 w-8 h-6 flex flex-col justify-between ml-6" aria-label="Menú móvil" aria-expanded="false">
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                </button>
            </div>
        </div>
    </header>

    <div id="mobile-menu" class="fixed top-0 right-0 w-full h-full z-40 lg:hidden flex flex-col" aria-hidden="true">
        <nav class="flex flex-col justify-center items-center h-full space-y-8 text-3xl flex-grow">
            <a href="#" data-target="portfolio" class="nav-link mobile-nav-link uppercase">Portafolio</a>
            <a href="#" data-target="projects" class="nav-link mobile-nav-link uppercase">Proyectos</a>
            <a href="#" data-target="services" class="nav-link mobile-nav-link uppercase">Servicios</a>
            <a href="#" data-target="rental" class="nav-link mobile-nav-link uppercase">Alquiler</a>
            <a href="#" data-target="about" class="nav-link mobile-nav-link uppercase">Quién Soy</a>
            <a href="#" data-target="contact" class="nav-link mobile-nav-link uppercase">Contacto</a>
        </nav>
        <div class="flex justify-center items-center space-x-8 pb-12">
            <a href="#" aria-label="WhatsApp" class="text-gray-700 hover:text-black transition-colors link-whatsapp"><i class="fab fa-whatsapp fa-2x"></i></a>
            <a href="#" aria-label="Instagram" class="text-gray-700 hover:text-black transition-colors link-instagram"><i class="fab fa-instagram fa-2x"></i></a>
            <a href="#" aria-label="YouTube" class="text-gray-700 hover:text-black transition-colors link-youtube"><i class="fab fa-youtube fa-2x"></i></a>
            <button id="mobile-cart-button" aria-label="Ver carrito de compras" class="cart-button text-gray-700 hover:text-black transition-colors">
                <i class="fas fa-shopping-bag fa-2x"></i>
                <span id="mobile-cart-item-count" class="cart-item-count absolute -top-2 -right-2 bg-black text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold" style="transform: scale(0);">0</span>
            </button>
        </div>
    </div>

    <main id="main-content">
        
        <section id="portfolio" class="page-container pt-32 pb-20 page-active">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="text-center mb-12 reveal visible">
                    <h2 class="text-4xl md:text-6xl font-display mb-4" id="hero-title">Cargando...</h2>
                    <p class="text-gray-500 max-w-xl mx-auto" id="hero-subtitle">...</p>
                </div>
                <div id="portfolio-gallery" class="columns-2 sm:columns-3 lg:columns-4 gap-6 space-y-6 reveal visible min-h-[50vh]">
                    </div>
            </div>

            <div class="bg-gray-100 py-20 reveal">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                         <h2 class="text-4xl font-display text-gray-800 text-reveal">Confianza y Colaboración</h2>
                    </div>
                    <div class="flex justify-center items-center flex-wrap gap-x-12 gap-y-8 max-w-4xl mx-auto" id="client-logos-container">
                        </div>
                </div>
            </div>
            
            <div class="bg-gray-100 pt-12 pb-24 reveal">
                <div class="container mx-auto px-6 text-center">
                     <div class="text-center mb-12">
                        <h2 class="text-4xl font-display text-gray-800 text-reveal py-2">¿Listo para el Siguiente Paso?</h2>
                        <p class="text-lg text-gray-600 mt-2 text-reveal">Explora mis proyectos o contáctame para empezar a crear.</p>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                        <a href="#" data-target="projects" class="nav-link inline-block bg-black text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-gray-800 transition-transform hover:scale-105 w-full sm:w-auto">Explorar Proyectos</a>
                        <a href="#" data-target="contact" class="nav-link inline-block bg-zinc-700 text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-zinc-800 transition-transform hover:scale-105 w-full sm:w-auto">Contactar Ahora</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="projects" class="page-container pt-32 pb-20 bg-gray-50">
            <div class="container mx-auto px-4 md:px-12">
                <div id="projects-container" class="space-y-24">
                    </div>
                <div class="text-center mt-24 reveal">
                     <h3 class="text-3xl font-display text-gray-800 text-reveal">¿Listo para crear tu propia historia?</h3>
                    <a href="#" data-target="services" class="nav-link mt-8 inline-block bg-black text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-gray-800 transition-transform hover:scale-105">Descubre mis Servicios</a>
                </div>
            </div>
        </section>

        <section id="services" class="page-container pt-32 pb-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-display">Servicios</h2>
                    <div class="w-20 h-1 bg-black mx-auto mt-4"></div>
                </div>
                <div id="services-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 max-w-6xl mx-auto">
                    </div>
            </div>
        </section>

        <section id="rental" class="page-container pt-32 pb-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-display">Rental de Equipo</h2>
                    <p class="text-gray-500 mt-2">Herramientas profesionales para tu visión.</p>
                </div>
                
                <div id="rental-filters" class="flex justify-center flex-wrap gap-4 mb-12">
                    </div>
                
                <div id="rental-grid-categorized" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    </div>
            </div>
        </section>

        <section id="about" class="page-container pt-32 pb-20 bg-gray-50">
            <div class="container mx-auto px-6 max-w-4xl">
                <div class="text-center mb-12">
                    <div class="relative w-64 h-64 mx-auto mb-8 overflow-hidden rounded-full shadow-xl">
                        <img id="about-profile-img" src="https://placehold.co/400" class="w-full h-full object-cover">
                    </div>
                    <h2 class="text-4xl font-display mb-4">Adán Gómez</h2>
                    <p class="text-xl text-gray-600 italic" id="about-intro">"Cargando biografía..."</p>
                </div>
                <div class="prose max-w-none lg:prose-lg mx-auto mt-16 text-gray-600 leading-relaxed space-y-8 text-justify">
                    <div id="about-bio"></div>
                </div>
            </div>
        </section>

        <section id="contact" class="page-container pt-32 pb-20">
            <div class="container mx-auto px-6 max-w-4xl text-center">
                <h2 class="text-4xl font-display mb-8">Hablemos</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16" id="contact-info">
                    </div>
                <div class="w-full h-96 bg-gray-200 rounded-lg overflow-hidden shadow-inner">
                     <iframe id="google-map" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
        </section>

        <div id="detail-pages-container"></div>
        <div id="project-detail-pages"></div>
        <div id="rental-detail-pages"></div>
        <div id="service-detail-pages"></div>

    </main>

    <div id="lightbox" class="fixed inset-0 z-[100] flex items-center justify-center hidden opacity-0">
        <button id="lightbox-close" class="absolute top-6 right-6 text-white text-5xl hover:text-gray-300">&times;</button>
        <button id="lightbox-prev" class="absolute left-4 text-white text-4xl p-4 hover:bg-white/10 rounded-full"><i class="fas fa-chevron-left"></i></button>
        <button id="lightbox-next" class="absolute right-4 text-white text-4xl p-4 hover:bg-white/10 rounded-full"><i class="fas fa-chevron-right"></i></button>
        <img id="lightbox-image" src="" class="max-w-[95vw] max-h-[95vh] shadow-2xl rounded-sm">
        <div class="absolute bottom-6 left-0 right-0 text-center text-white text-lg font-light tracking-wide" id="lightbox-caption"></div>
    </div>

    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden transition-opacity"></div>
    <aside id="cart-drawer" class="fixed top-0 right-0 w-full max-w-md h-full bg-white z-[70] shadow-2xl flex flex-col">
        <div class="p-6 border-b flex justify-between items-center bg-gray-50">
            <h2 class="text-2xl font-display font-bold">Tu Carrito de Alquiler</h2>
            <button id="cart-close-btn" class="text-2xl text-gray-400 hover:text-black">&times;</button>
        </div>
        <div id="cart-items-container" class="flex-1 overflow-y-auto p-6 space-y-4">
             <div id="cart-empty-state" class="text-center p-8 flex flex-col items-center justify-center h-full">
                <i class="fas fa-camera-retro text-5xl text-gray-300 mb-6"></i>
                <h3 class="font-display text-2xl mb-2">Tu carrito está vacío</h3>
                <p class="text-gray-500 mb-8 max-w-xs">Parece que aún no has añadido equipo.</p>
            </div>
        </div>
        <div class="p-6 border-t bg-gray-50">
            <div class="flex justify-between items-center text-xl font-bold mb-4">
                <span>Total Estimado:</span>
                <span id="cart-subtotal">$0.00</span>
            </div>
            <button id="checkout-btn" class="w-full bg-black text-white py-4 font-bold tracking-widest hover:bg-gray-800 transition-colors uppercase text-sm">Solicitar Reserva</button>
        </div>
    </aside>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        
        // --- 1. CONFIGURACIÓN Y ESTADO ---
        // Este es el único punto de entrada de datos. Cero datos falsos.
        const API_URL = '/.netlify/functions/get-website-data'; 
        
        // Variables globales para almacenar la info descargada
        let appData = {
            projects: [],
            services: [],
            rentalItems: [],
            rentalCategories: [],
            portfolioGallery: [],
            clientLogos: [],
            settings: {},
            about: {}
        };
        
        // Estado del carrito y diccionarios para búsqueda rápida
        let cart = [];
        let rentalDataGlobal = {}; // Se llenará dinámicamente
        let projectDetails = {};   // Se llenará dinámicamente
        let serviceDetails = {};   // Se llenará dinámicamente

        // --- 2. MOTOR DE DATOS (HIDRATACIÓN) ---
        async function initApp() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Error de conexión con la base de datos.');
                
                const data = await response.json();
                appData = data; // Guardamos todo

                // 2.1 TRANSFORMACIÓN DE DATOS (Adaptadores)
                
                // A. Adaptador de Alquileres (Array plano -> Objeto por Categorías)
                const items = appData.rentalItems || [];
                const cats = appData.rentalCategories || [];
                
                // Crear estructura { "Nombre Categoria": [items...] }
                cats.forEach(c => {
                    rentalDataGlobal[c.name] = items.filter(i => i.categoryId === c.id && i.status !== 'hidden');
                });
                // Añadir items sin categoría o categoría perdida
                const uncategorized = items.filter(i => !cats.find(c => c.id === i.categoryId) && i.status !== 'hidden');
                if (uncategorized.length > 0) {
                     rentalDataGlobal["Otros"] = uncategorized;
                }

                // B. Adaptador de Proyectos (Para detalles) - CORREGIDO
                const projectsList = appData.projects || [];
                projectsList.forEach(p => {
                    projectDetails[p.id] = {
                        title: p.title,
                        description: p.description,
                        // Mapeamos array de objetos {imageUrl, caption} a array de strings URL para el detalle simple
                        images: (p.images || []).map(img => img.imageUrl) 
                    };
                });

                // C. Adaptador de Servicios (Para detalles) - CORREGIDO
                const servicesList = appData.services || [];
                servicesList.forEach(s => {
                    serviceDetails[s.id] = {
                        title: s.title,
                        intro: s.introText || s.description || '',
                        // Mapeamos bloques de contenido a secciones
                        sections: (s.contentBlocks || []).map(b => ({
                            title: b.blockTitle,
                            content: b.blockContentHtml
                        })),
                        gallery: (s.images || []).map(img => img.imageUrl)
                    };
                });

                // 2.2 RENDERIZADO UI
                renderUI();
                
                // Ocultar loader
                document.getElementById('page-loader').classList.add('hidden');
                
            } catch (error) {
                console.error("Fallo crítico:", error);
                document.querySelector('.loader-circle').style.borderColor = 'red';
                // Fallback silencioso: dejar que el loader se quite para no bloquear, aunque esté vacío
                setTimeout(() => document.getElementById('page-loader').classList.add('hidden'), 2000);
            }
        }

        function renderUI() {
            applySettings();
            renderPortfolio(appData.portfolioGallery);
            renderProjects(appData.projects);
            renderServices(appData.services);
            renderRentalPage(); // Usa rentalDataGlobal ya hidratada
            renderAbout(appData.about, appData.settings);
            renderContact(appData.settings);
            renderClientLogos(appData.clientLogos);
        }

        // --- 3. RENDERIZADORES ---

        function applySettings() {
            // 1. Textos Hero (Desde la hoja Settings)
            if(appData.settings.hero_title) document.getElementById('hero-title').innerHTML = appData.settings.hero_title;
            if(appData.settings.hero_subtitle) document.getElementById('hero-subtitle').innerText = appData.settings.hero_subtitle;
            
            // 2. LOGOS DINÁMICOS (Desde la hoja ImagenesIdentidad o Settings)
            // Intentamos encontrar los logos en el objeto de logos de clientes o en identityImages si existen
            const sysImages = {};
            // Si el backend devolvió 'identityImages' o 'ImagenesIdentidad' como array separado, úsalo aquí.
            // Asumimos que pueden venir mezclados en clientLogos o en una propiedad específica si actualizas el backend
            // Por ahora, buscamos en clientLogos por 'key'
            if (appData.clientLogos) {
                appData.clientLogos.forEach(l => {
                    if (l.key) sysImages[l.key] = l.logoUrl;
                });
            }
            // Si tienes una propiedad dedicada 'identityImages' en el JSON del backend, descomenta esto:
            // if (appData.identityImages) { ... }

            // Referencias al DOM
            const logoDark = document.getElementById('header-logo-dark');
            const logoLight = document.getElementById('header-logo-light');
            const loaderLogo = document.getElementById('loader-logo');
            const favicon = document.getElementById('dynamic-favicon');

            // Reemplazo de Logo Negro
            if (sysImages['logo_black']) {
                if(logoDark) logoDark.src = sysImages['logo_black'];
                if(loaderLogo) loaderLogo.src = sysImages['logo_black']; // Logo del loader
            }
            
            // Reemplazo de Logo Blanco
            if (sysImages['logo_white']) {
                if(logoLight) logoLight.src = sysImages['logo_white'];
            }

            // Reemplazo de Favicon
            if (sysImages['favicon'] && favicon) {
                favicon.href = sysImages['favicon'];
            }
        }

        function renderPortfolio(images) {
            const container = document.getElementById('portfolio-gallery');
            if(!images || images.length === 0) {
                container.innerHTML = '<p class="text-center w-full text-gray-400 col-span-full">Pronto nuevas imágenes.</p>';
                return;
            }
            
            container.innerHTML = images.map(img => `
                <div class="gallery-item break-inside-avoid relative group" onclick="openLightbox('${img.imageUrl}', '${img.caption||''}')">
                    <img src="${img.imageUrl}" alt="${img.caption||'Portafolio'}" loading="lazy" class="w-full h-auto object-cover rounded-sm bg-gray-100">
                    <div class="overlay absolute inset-0 flex items-end p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-t from-black/80 to-transparent">
                        <p class="text-white text-sm font-light tracking-wide transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">${img.caption || ''}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderProjects(projects) {
            const container = document.getElementById('projects-container');
            if(!projects || projects.length === 0) return;

            container.innerHTML = projects.filter(p => p.status !== 'hidden').map((p, idx) => {
                const isEven = idx % 2 === 0;
                const imgUrl = p.coverImageUrl || 'https://placehold.co/800x600?text=Proyecto';
                
                return `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center reveal">
                    <div class="order-2 ${isEven ? 'md:order-1 md:text-right' : 'md:order-2 md:text-left'}">
                        <h3 class="text-4xl font-display mb-4 text-gray-900">${p.title}</h3>
                        <div class="w-16 h-1 bg-gray-200 mb-6 ${isEven ? 'ml-auto' : 'mr-auto'}"></div>
                        <p class="text-gray-600 leading-relaxed mb-8 font-light">${p.description || ''}</p>
                        <button onclick="openDetail('project', '${p.id}')" class="text-black text-xs font-bold uppercase tracking-[0.2em] border-b-2 border-black pb-1 hover:text-gray-600 hover:border-gray-400 transition-all">
                            Ver Proyecto
                        </button>
                    </div>
                    <div class="order-1 ${isEven ? 'md:order-2' : 'md:order-1'} overflow-hidden shadow-xl rounded-sm cursor-pointer group" onclick="openDetail('project', '${p.id}')">
                        <img src="${imgUrl}" alt="${p.title}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700 ease-out">
                    </div>
                </div>`;
            }).join('');
        }

        function renderServices(services) {
            const container = document.getElementById('services-grid');
            if(!services) return;

            container.innerHTML = services.filter(s => s.status !== 'hidden').map(s => `
                <div class="service-grid-item group cursor-pointer" onclick="openDetail('service', '${s.id}')">
                    <div class="service-icon-wrapper">
                        <i class="${s.iconClass || 'fas fa-star'} service-icon"></i>
                    </div>
                    <h3 class="text-2xl font-display text-gray-900 group-hover:text-black transition-colors">${s.title}</h3>
                    <div class="w-8 h-px bg-gray-300 my-4 group-hover:w-16 transition-all duration-300 bg-gray-400"></div>
                    <p class="text-xs font-bold uppercase tracking-widest text-gray-400 group-hover:text-black mt-auto transition-colors">Descubrir</p>
                </div>
            `).join('');
        }

        function renderRentalPage() {
            const filtersContainer = document.getElementById('rental-filters');
            const gridContainer = document.getElementById('rental-grid-categorized');
            if (!filtersContainer || !gridContainer) return;

            // Obtener categorías dinámicas
            const categories = ['Todo', ...Object.keys(rentalDataGlobal)];
            
            filtersContainer.innerHTML = categories.map(cat => 
                `<button class="rental-category-btn ${cat === 'Todo' ? 'active' : ''}" data-category="${cat}">${cat}</button>`
            ).join('');

            const renderItems = (category) => {
                let itemsToRender = (category === 'Todo') ? Object.values(rentalDataGlobal).flat() : rentalDataGlobal[category];
                
                gridContainer.innerHTML = itemsToRender.map(item => {
                    // Precios e imagen
                    const basePrice = parseFloat(item.pricePerDay) || 0;
                    const hasTax = String(item.hasTax).toUpperCase() === 'TRUE';
                    const finalPrice = hasTax ? (basePrice * 1.13) : basePrice;
                    const taxLabel = hasTax ? '<span class="text-[10px] text-gray-400 ml-1">+IVI</span>' : '';
                    
                    // Imágenes para el carrusel
                    const images = (item.images && item.images.length > 0) 
                        ? item.images.map(i => i.imageUrl) 
                        : ['https://placehold.co/400x300?text=Sin+Imagen'];

                    return `
                    <div class="rental-card reveal">
                         <div class="carousel-container aspect-w-4 aspect-h-3">
                            <div class="carousel-track flex" data-current-index="0">
                                ${images.map(src => `<div class="carousel-item flex-shrink-0 w-full"><img src="${src}" alt="${item.name}" class="w-full h-full object-cover"></div>`).join('')}
                            </div>
                            ${images.length > 1 ? `
                            <button class="carousel-button prev rental-carousel-button" data-direction="-1"><i class="fas fa-chevron-left"></i></button>
                            <button class="carousel-button next rental-carousel-button" data-direction="1"><i class="fas fa-chevron-right"></i></button>
                            ` : ''}
                        </div>
                        <div class="p-6 flex flex-col flex-grow">
                            <div class="flex justify-between items-baseline">
                                <h3 class="font-display text-2xl leading-tight">${item.name}</h3>
                                <p class="font-bold text-xl text-gray-800 ml-2 whitespace-nowrap">$${finalPrice.toFixed(0)}<span class="text-sm font-normal text-gray-500">/día</span></p>
                            </div>
                            <p class="text-gray-600 text-sm my-4 flex-grow line-clamp-3">${item.description || ''}</p>
                            <div class="mt-auto flex justify-between items-center">
                                <a href="#" onclick="openDetail('rental', '${item.id}')" class="nav-link text-xs font-bold text-black uppercase tracking-wider border-b border-black hover:text-gray-600 hover:border-gray-400 transition-all pb-0.5">
                                    Ver Detalles
                                </a>
                                <button onclick="addToCart('${item.id}')" class="w-8 h-8 rounded-full bg-black text-white flex items-center justify-center hover:bg-gray-800 transition-colors"><i class="fas fa-plus text-xs"></i></button>
                            </div>
                        </div>
                    </div>`;
                }).join('');
                
                // Observador para animaciones al filtrar
                setTimeout(() => {
                    gridContainer.querySelectorAll('.rental-card').forEach((card, i) => {
                        setTimeout(() => card.classList.add('visible'), i * 50);
                    });
                }, 50);
            };

            // Event listener delegación para filtros
            filtersContainer.addEventListener('click', (e) => {
                if (e.target.matches('.rental-category-btn')) {
                    filtersContainer.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                    renderItems(e.target.dataset.category);
                }
            });
            
            // Event listener delegación para carruseles
            gridContainer.addEventListener('click', function(e) {
                const button = e.target.closest('.rental-carousel-button');
                if (button) {
                    e.preventDefault(); e.stopPropagation();
                    const track = button.closest('.carousel-container').querySelector('.carousel-track');
                    const slides = Array.from(track.children);
                    const direction = parseInt(button.dataset.direction);
                    let currentIndex = parseInt(track.dataset.currentIndex) || 0;
                    currentIndex = (currentIndex + direction + slides.length) % slides.length;
                    track.style.transform = `translateX(-${currentIndex * 100}%)`;
                    track.dataset.currentIndex = currentIndex;
                }
            });

            // Render inicial
            renderItems('Todo');
        }

        function renderAbout(about, settings) {
            // Intro
            const intro = document.getElementById('about-intro');
            if (about.intro_phrase) intro.textContent = `"${about.intro_phrase}"`;
            
            // Bio completa
            const bioContainer = document.getElementById('about-bio');
            let contentHtml = '';
            if (about.bio) contentHtml += `<div class="mb-8">${about.bio.replace(/\n/g, '<br>')}</div>`;
            if (about.process) contentHtml += `
                <h3 class="text-2xl font-display text-black mb-4 mt-8">Mi Proceso</h3>
                <div class="pl-4 border-l-2 border-gray-200">${about.process.replace(/\n/g, '<br>')}</div>
            `;
            bioContainer.innerHTML = contentHtml || '<p>Información no disponible.</p>';

            // Imagen de Perfil
            const imgEl = document.getElementById('about-profile-img');
            // Priorizamos la imagen de perfil específica
            if (about.profile_image) imgEl.src = about.profile_image;
        }

        function renderContact(settings) {
            const container = document.getElementById('contact-info');
            const mapFrame = document.getElementById('google-map');
            
            const email = settings.contact_email || 'info@agvisual.com';
            const phone = settings.contact_phone || '';
            const ig = settings.social_instagram || '#';
            const wa = settings.social_whatsapp || '#';
            const yt = settings.social_youtube || '#';
            const fb = settings.social_facebook || '#';
            const maps = settings.social_maps;

            // Actualizar enlaces en Header y Footer también
            document.querySelectorAll('.link-instagram').forEach(a => a.href = ig);
            document.querySelectorAll('.link-whatsapp').forEach(a => a.href = wa);
            document.querySelectorAll('.link-youtube').forEach(a => a.href = yt);

            // Renderizar Grid de Contacto
            container.innerHTML = `
                <a href="${ig}" target="_blank" class="contact-icon-link p-8 flex flex-col items-center justify-center rounded-lg">
                    <i class="fab fa-instagram fa-3x mb-3 text-gray-700"></i>
                    <span class="font-bold text-gray-800">Instagram</span>
                </a>
                <a href="${wa}" target="_blank" class="contact-icon-link p-8 flex flex-col items-center justify-center rounded-lg">
                    <i class="fab fa-whatsapp fa-3x mb-3 text-gray-700"></i>
                    <span class="font-bold text-gray-800">WhatsApp</span>
                </a>
                <a href="mailto:${email}" class="contact-icon-link p-8 flex flex-col items-center justify-center rounded-lg">
                    <i class="fas fa-envelope fa-3x mb-3 text-gray-700"></i>
                    <span class="font-bold text-gray-800">Email</span>
                </a>
            `;

            if (maps && maps.includes('embed')) {
                mapFrame.src = maps;
            }
        }
        
        function renderClientLogos(logos) {
            const container = document.getElementById('client-logos-container');
            if(!container) return;
            if(!logos || logos.length === 0) return;
            
            container.innerHTML = logos.sort((a,b)=>(parseInt(a.order)||99)-(parseInt(b.order)||99)).map(l => `
                <img src="${l.logoUrl}" alt="${l.clientName}" class="client-logo h-12 md:h-16 w-auto object-contain grayscale opacity-60 hover:grayscale-0 hover:opacity-100 transition-all duration-500">
            `).join('');
        }

        // --- 4. DETALLES (PÁGINAS DINÁMICAS) ---

        window.openDetail = (type, id) => {
            const container = document.getElementById('detail-pages-container');
            let content = '';

            window.scrollTo(0,0);

            if (type === 'project') {
                const p = projectDetails[id];
                if(!p) return;
                
                const imagesHTML = p.images.map(src => `
                    <div class="gallery-item break-inside-avoid overflow-hidden relative img-container">
                        <img src="${src}" loading="lazy" class="w-full h-auto object-cover" onclick="openLightbox('${src}', '')">
                    </div>
                `).join('');
                
                content = `
                <div class="fixed inset-0 z-[60] bg-white overflow-y-auto animate-fade-in">
                    <button onclick="closeDetail()" class="fixed top-6 right-6 z-50 text-black bg-white/80 backdrop-blur p-3 rounded-full hover:bg-black hover:text-white transition-all shadow-lg"><i class="fas fa-times fa-lg"></i></button>
                    
                    <div class="container mx-auto px-6 py-24 max-w-5xl">
                        <div class="text-center mb-16">
                            <p class="text-gray-400 text-xs font-bold uppercase tracking-[0.3em] mb-4">Proyecto</p>
                            <h1 class="text-5xl md:text-6xl font-display mb-6 text-gray-900">${p.title}</h1>
                            <p class="text-xl text-gray-600 max-w-2xl mx-auto font-light">${p.description}</p>
                        </div>
                        
                        <div class="columns-1 md:columns-2 gap-8 space-y-8">
                            ${imagesHTML}
                        </div>
                        
                        <div class="text-center mt-16">
                            <a href="#" onclick="closeDetail()" class="text-sm font-bold uppercase tracking-widest border-b border-black pb-1 hover:text-gray-600 transition-colors">Volver a Proyectos</a>
                        </div>
                    </div>
                </div>`;

            } else if (type === 'service') {
                const s = serviceDetails[id];
                if(!s) return;

                const sectionsHTML = s.sections.map(section => `
                    <div class="mb-12">
                        <h3 class="text-2xl font-display mb-4 border-b border-gray-200 pb-2">${section.title}</h3>
                        <div class="prose text-gray-600 leading-relaxed">${section.content}</div>
                    </div>
                `).join('');

                const galleryHTML = s.gallery.map(src => `
                    <img src="${src}" class="w-full h-48 object-cover rounded cursor-zoom-in hover:opacity-80 transition" onclick="openLightbox('${src}', '')">
                `).join('');

                content = `
                <div class="fixed inset-0 z-[60] bg-white overflow-y-auto animate-fade-in">
                    <button onclick="closeDetail()" class="fixed top-6 right-6 z-50 text-black bg-white/80 backdrop-blur p-3 rounded-full hover:bg-black hover:text-white transition-all shadow-lg"><i class="fas fa-times fa-lg"></i></button>
                    
                    <div class="h-[50vh] bg-gray-900 relative flex items-center justify-center overflow-hidden">
                        <div class="absolute inset-0 opacity-40 bg-[url('${s.gallery[0] || ''}')] bg-cover bg-center"></div>
                        <div class="relative z-10 text-center text-white px-4">
                            <h1 class="text-5xl md:text-7xl font-display">${s.title}</h1>
                        </div>
                    </div>

                    <div class="container mx-auto px-6 py-20 max-w-4xl">
                        <div class="text-lg text-gray-800 font-medium italic mb-16 text-center border-l-4 border-black pl-6 py-2 bg-gray-50">
                            ${s.intro}
                        </div>
                        
                        ${sectionsHTML}

                        ${s.gallery.length > 0 ? `
                        <div class="mt-20">
                            <h3 class="text-2xl font-display mb-8 text-center">Galería de Muestra</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                ${galleryHTML}
                            </div>
                        </div>
                        ` : ''}

                        <div class="mt-24 text-center">
                            <a href="https://wa.me/${appData.settings.contact_phone?.replace(/\D/g,'')}" target="_blank" class="inline-block bg-black text-white font-bold py-4 px-10 rounded-full hover:bg-gray-800 transition-transform hover:scale-105 shadow-lg">
                                Cotizar este Servicio
                            </a>
                        </div>
                    </div>
                </div>`;
            
            } else if (type === 'rental') {
                // Buscar item en todas las categorías
                let item = null;
                for (const cat in rentalDataGlobal) {
                    const found = rentalDataGlobal[cat].find(i => String(i.id) === String(id));
                    if (found) { item = found; break; }
                }
                
                if(!item) return;

                const basePrice = parseFloat(item.pricePerDay);
                const hasTax = String(item.hasTax).toUpperCase() === 'TRUE';
                const finalPrice = hasTax ? (basePrice * 1.13) : basePrice;

                // Imágenes
                const images = (item.images && item.images.length > 0) ? item.images.map(i => i.imageUrl) : ['https://placehold.co/800x600?text=Sin+Imagen'];

                content = `
                <div class="fixed inset-0 z-[60] bg-white overflow-y-auto animate-fade-in">
                    <button onclick="closeDetail()" class="fixed top-6 right-6 z-50 text-black bg-white/80 backdrop-blur p-3 rounded-full hover:bg-black hover:text-white transition-all shadow-lg"><i class="fas fa-times fa-lg"></i></button>
                    
                    <div class="container mx-auto px-6 py-24 max-w-6xl">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                            <div class="space-y-4">
                                <div class="aspect-w-4 aspect-h-3 bg-gray-100 rounded-lg overflow-hidden">
                                    <img id="rental-main-img" src="${images[0]}" class="w-full h-full object-cover">
                                </div>
                                <div class="flex gap-4 overflow-x-auto pb-2">
                                    ${images.map(src => `
                                        <img src="${src}" class="w-20 h-20 object-cover rounded cursor-pointer border-2 border-transparent hover:border-black transition" onclick="document.getElementById('rental-main-img').src='${src}'">
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="flex flex-col justify-center">
                                <p class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Alquiler de Equipo</p>
                                <h1 class="text-4xl md:text-5xl font-display mb-6 text-gray-900">${item.name}</h1>
                                
                                <div class="text-3xl font-mono font-bold text-black mb-8 flex items-baseline gap-2">
                                    $${finalPrice.toFixed(0)} 
                                    <span class="text-base font-normal text-gray-500 text-sans">/ día ${hasTax?'+ IVA incl.':''}</span>
                                </div>
                                
                                <div class="prose text-gray-600 mb-10">
                                    ${item.longDescription || item.description || ''}
                                </div>

                                <button onclick="addToCart('${item.id}')" class="w-full bg-black text-white font-bold py-4 rounded hover:bg-gray-800 transition-all flex items-center justify-center gap-3">
                                    <i class="fas fa-cart-plus"></i> Agregar a la Reserva
                                </button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }

            container.innerHTML = content;
            document.body.style.overflow = 'hidden'; 
        };

        window.closeDetail = () => {
            document.getElementById('detail-pages-container').innerHTML = '';
            document.body.style.overflow = 'auto';
        };

        // --- 5. CARRITO (Lógica Checkout) ---

        window.addToCart = (itemId) => {
            // Buscar item
            let item = null;
            for (const cat in rentalDataGlobal) {
                const found = rentalDataGlobal[cat].find(i => String(i.id) === String(itemId));
                if (found) { item = found; break; }
            }
            if(!item) return;
            
            // Check duplicado
            if(cart.some(c => c.id === item.id)) {
                alert("Este equipo ya está en tu lista de reserva.");
                return;
            }
            
            // Cerrar detalle si está abierto
            closeDetail();

            cart.push(item);
            updateCartUI();
            toggleCart(true);
        };

        window.removeFromCart = (id) => {
            cart = cart.filter(c => String(c.id) !== String(id));
            updateCartUI();
        };

        function updateCartUI() {
            // Badges
            document.getElementById('cart-item-count').innerText = cart.length;
            document.getElementById('mobile-cart-item-count').innerText = cart.length;
            
            document.getElementById('cart-item-count').classList.toggle('visible', cart.length > 0);
            document.getElementById('mobile-cart-item-count').classList.toggle('visible', cart.length > 0);
            
            const container = document.getElementById('cart-items-container');
            
            if(cart.length === 0) {
                container.innerHTML = `
                    <div id="cart-empty-state" class="text-center p-8 flex flex-col items-center justify-center h-full">
                        <i class="fas fa-camera-retro text-5xl text-gray-300 mb-6"></i>
                        <h3 class="font-display text-2xl mb-2">Tu carrito está vacío</h3>
                        <p class="text-gray-500 mb-8 max-w-xs">Parece que aún no has añadido equipo.</p>
                        <button onclick="toggleCart(false)" class="bg-black text-white font-bold py-3 px-8 rounded-full hover:bg-gray-800">
                            Volver al Catálogo
                        </button>
                    </div>`;
                document.getElementById('checkout-btn').disabled = true;
                document.getElementById('cart-subtotal').innerText = "$0.00";
                return;
            }

            let total = 0;
            const itemsHTML = cart.map(item => {
                const basePrice = parseFloat(item.pricePerDay);
                const hasTax = String(item.hasTax).toUpperCase() === 'TRUE';
                const final = hasTax ? basePrice * 1.13 : basePrice;
                total += final;
                
                const img = (item.images && item.images.length > 0) ? item.images[0].imageUrl : '';

                return `
                <div class="flex gap-4 items-center bg-gray-50 p-3 rounded mb-2">
                    <img src="${img}" class="w-16 h-16 object-cover rounded bg-white">
                    <div class="flex-1">
                        <h4 class="font-bold text-sm">${item.name}</h4>
                        <p class="text-xs text-gray-500">$${final.toFixed(0)} / día</p>
                    </div>
                    <button onclick="removeFromCart('${item.id}')" class="text-red-400 hover:text-red-600 px-2"><i class="fas fa-trash"></i></button>
                </div>`;
            }).join('');
            
            container.innerHTML = itemsHTML;
            document.getElementById('cart-subtotal').innerText = `$${total.toFixed(0)}`;
            document.getElementById('checkout-btn').disabled = false;
        }

        const toggleCart = (show) => {
            const overlay = document.getElementById('cart-overlay');
            const drawer = document.getElementById('cart-drawer');
            if (show) {
                overlay.classList.add('visible');
                drawer.classList.add('visible');
            } else {
                overlay.classList.remove('visible');
                drawer.classList.remove('visible');
            }
        };

        // Checkout -> WhatsApp
        document.getElementById('checkout-btn').onclick = () => {
            if(cart.length === 0) return;
            const phone = appData.settings.contact_phone || '50600000000'; // Fallback
            
            let text = `Hola Adán, me interesa alquilar el siguiente equipo:%0A%0A`;
            cart.forEach(i => {
                text += `• ${i.name}%0A`;
            });
            
            const total = document.getElementById('cart-subtotal').innerText;
            text += `%0AValor diario estimado: ${total}%0A%0AQuedo atento a la disponibilidad.`;
            
            window.open(`https://wa.me/${phone.replace(/\D/g,'')}?text=${text}`, '_blank');
        };

        // --- 6. EVENTOS DE NAVEGACIÓN ---
        
        // Mobile Menu
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        mobileMenuButton.onclick = () => {
            mobileMenu.classList.toggle('open');
            mobileMenuButton.classList.toggle('open');
        };
        document.querySelectorAll('.mobile-nav-link').forEach(l => l.onclick = () => {
            mobileMenu.classList.remove('open');
            mobileMenuButton.classList.remove('open');
        });

        // Cart Buttons
        document.getElementById('cart-button').onclick = () => toggleCart(true);
        document.getElementById('mobile-cart-button').onclick = () => toggleCart(true);
        document.getElementById('cart-close-btn').onclick = () => toggleCart(false);
        document.getElementById('cart-overlay').onclick = () => toggleCart(false);

        // Lightbox
        const lightbox = document.getElementById('lightbox');
        window.openLightbox = (src, caption) => {
            document.getElementById('lightbox-image').src = src;
            document.getElementById('lightbox-caption').innerText = caption;
            lightbox.classList.remove('hidden');
            setTimeout(() => lightbox.classList.add('visible'), 10);
        };
        document.getElementById('lightbox-close').onclick = () => {
            lightbox.classList.remove('visible');
            setTimeout(() => lightbox.classList.add('hidden'), 400);
        };
        lightbox.onclick = (e) => { if(e.target === lightbox) document.getElementById('lightbox-close').click(); };

        // Scroll Nav & SPA
        const sections = document.querySelectorAll('.page-container');
        const navLinks = document.querySelectorAll('.nav-link');
        const header = document.getElementById('header');

        function navigateTo(targetId) {
            if(!targetId) return;
            const targetSection = document.getElementById(targetId);
            if(!targetSection) return;

            // Transición CSS
            document.querySelector('.page-active')?.classList.add('page-exiting');
            document.querySelector('.page-active')?.classList.remove('page-active');
            
            targetSection.style.display = 'block';
            setTimeout(() => {
                targetSection.classList.add('page-active');
                document.querySelector('.page-exiting')?.style.display = 'none';
                document.querySelector('.page-exiting')?.classList.remove('page-exiting');
            }, 50);

            // Scroll Top
            window.scrollTo(0,0);
            
            // Header Logic (Dark mode en detalle de servicio/proyecto)
            header.classList.remove('header-scrolled');
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = link.dataset.target;
                if(target) navigateTo(target);
            });
        });

        // Header Scroll Effect
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) header.classList.add('header-scrolled');
            else header.classList.remove('header-scrolled');
        });

        // --- INICIO APP ---
        initApp();
    });
    </script>
</body>
</html>







