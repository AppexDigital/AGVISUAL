<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adán Gómez | Fotógrafo Profesional</title>
    
    <link rel="icon" id="dynamic-favicon" type="image/png" href="https://placehold.co/32x32/1a1a1a/ffffff?text=AG">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* --- SISTEMA DE DISEÑO ORIGINAL --- */
        :root { --bg-main: #FDFDFD; --text-dark: #1a1a1a; --text-light: #f8f9fa; --accent: #3a3a3a; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg-main); color: var(--text-dark); overflow-x: hidden; }
        h1, h2, h3, h4, .font-display { font-family: 'Cormorant Garamond', serif; line-height: 1.2; }
        
        /* TRANSICIONES Y CARGA */
        .page-container { display: none; opacity: 0; transition: opacity 0.6s ease; padding-top: 120px; padding-bottom: 80px; min-height: 100vh; }
        .page-active { display: block; opacity: 1; }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 1s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .reveal.visible { opacity: 1; transform: translateY(0); }
        
        .loader { position: fixed; inset: 0; background-color: var(--bg-main); z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s ease; }
        .loader.hidden { opacity: 0; pointer-events: none; }
        .loader-circle { width: 40px; height: 40px; border: 2px solid rgba(0,0,0,0.1); border-top-color: #000; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* HEADER & NAV */
        #header { transition: all 0.4s ease; padding: 1.5rem 0; }
        #header.header-scrolled { padding: 0.8rem 0; background-color: rgba(253,253,253,0.98); box-shadow: 0 2px 15px rgba(0,0,0,0.03); }
        .nav-link { position: relative; font-size: 0.75rem; letter-spacing: 0.15em; font-weight: 600; }
        .nav-link::after { content: ''; position: absolute; bottom: -4px; left: 0; width: 0; height: 1px; background-color: #000; transition: width 0.3s; }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }

        /* PORTFOLIO MASONRY */
        .masonry-grid { column-count: 1; column-gap: 1.5rem; }
        @media (min-width: 640px) { .masonry-grid { column-count: 2; } }
        @media (min-width: 1024px) { .masonry-grid { column-count: 3; } }
        
        .gallery-item { break-inside: avoid; margin-bottom: 1.5rem; position: relative; overflow: hidden; cursor: zoom-in; }
        .gallery-item img { width: 100%; display: block; transition: transform 0.7s cubic-bezier(0.2, 1, 0.3, 1); }
        .gallery-item:hover img { transform: scale(1.03); }
        .gallery-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s; display: flex; align-items: flex-end; padding: 1.5rem; }
        .gallery-item:hover .gallery-overlay { opacity: 1; }

        /* RENTAL CARDS (Uniformidad Forzada) */
        .rental-card { 
            display: flex; flex-direction: column; height: 100%; 
            border: 1px solid #eee; background: #fff; transition: all 0.3s ease;
        }
        .rental-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .rental-image-container { position: relative; aspect-ratio: 4/3; overflow: hidden; background: #f9f9f9; }
        .rental-image-container img { width: 100%; height: 100%; object-fit: cover; }
        
        /* CALENDAR MODAL */
        .calendar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(4px); }
        .calendar-overlay.visible { opacity: 1; pointer-events: auto; }
        .calendar-content { background: #fff; padding: 2rem; width: 100%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); transform: translateY(20px); transition: transform 0.3s; }
        .calendar-overlay.visible .calendar-content { transform: translateY(0); }
        .calendar-day { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; border-radius: 50%; transition: all 0.2s; }
        .calendar-day:hover:not(.disabled) { background: #f0f0f0; }
        .calendar-day.selected { background: #000; color: #fff; }
        .calendar-day.range { background: #eee; }
        .calendar-day.disabled { color: #ccc; cursor: not-allowed; text-decoration: line-through; }

        /* CHECKOUT STEPS */
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CART DRAWER */
        .cart-drawer { position: fixed; top: 0; right: 0; width: 100%; max-width: 400px; height: 100%; background: #fff; z-index: 60; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.2, 1, 0.3, 1); box-shadow: -10px 0 40px rgba(0,0,0,0.05); }
        .cart-drawer.open { transform: translateX(0); }
        .cart-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 55; opacity: 0; pointer-events: none; transition: opacity 0.4s; }
        .cart-overlay.open { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body class="text-gray-900">

    <div class="loader" id="page-loader">
        <div class="flex flex-col items-center">
            <img src="https://placehold.co/200x80/ffffff/000000?text=ADAN+GOMEZ" id="loader-logo" class="h-12 mb-6" alt="Logo">
            <div class="loader-circle"></div>
        </div>
    </div>

    <header id="header" class="fixed w-full top-0 z-50">
        <div class="container mx-auto px-6 md:px-12 flex justify-between items-center">
            <a href="#" onclick="UI.nav('home')" class="z-50">
                <img src="https://placehold.co/180x60/ffffff/000000?text=ADAN+GOMEZ" id="header-logo" class="h-8 md:h-10 transition-opacity" alt="Logo">
            </a>

            <nav class="hidden md:flex items-center gap-8">
                <a href="#" onclick="UI.nav('home')" class="nav-link">PORTAFOLIO</a>
                <a href="#" onclick="UI.nav('projects')" class="nav-link">PROYECTOS</a>
                <a href="#" onclick="UI.nav('services')" class="nav-link">SERVICIOS</a>
                <a href="#" onclick="UI.nav('rental')" class="nav-link">ALQUILER</a>
                <a href="#" onclick="UI.nav('about')" class="nav-link">QUIÉN SOY</a>
                <a href="#" onclick="UI.nav('contact')" class="nav-link">CONTACTO</a>
            </nav>

            <div class="hidden md:flex items-center gap-6">
                <a href="#" target="_blank" id="link-ig"><i class="fab fa-instagram text-lg"></i></a>
                <button onclick="UI.toggleCart()" class="relative">
                    <i class="fas fa-shopping-bag text-lg"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-black text-white text-[9px] w-4 h-4 flex items-center justify-center rounded-full opacity-0 transition-opacity">0</span>
                </button>
            </div>

            <button class="md:hidden z-50" onclick="UI.toggleMobileMenu()">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </header>

    <div id="mobile-menu" class="fixed inset-0 bg-white z-40 flex flex-col justify-center items-center gap-8 opacity-0 pointer-events-none transition-opacity duration-300">
        <a href="#" onclick="UI.nav('home')" class="font-display text-3xl">Portafolio</a>
        <a href="#" onclick="UI.nav('projects')" class="font-display text-3xl">Proyectos</a>
        <a href="#" onclick="UI.nav('services')" class="font-display text-3xl">Servicios</a>
        <a href="#" onclick="UI.nav('rental')" class="font-display text-3xl">Alquiler</a>
        <a href="#" onclick="UI.nav('about')" class="font-display text-3xl">Quién Soy</a>
        <a href="#" onclick="UI.nav('contact')" class="font-display text-3xl">Contacto</a>
    </div>

    <main>
        
        <section id="page-home" class="page-container page-active">
            <div class="container mx-auto px-6 md:px-12">
                <div class="masonry-grid" id="portfolio-grid">
                    </div>
            </div>
            
            <div class="mt-32 py-20 bg-gray-50 border-t border-gray-100">
                <div class="container mx-auto px-6 text-center">
                    <p class="text-xs font-bold uppercase tracking-[0.2em] text-gray-400 mb-12">Confianza & Colaboración</p>
                    <div id="client-logos-grid" class="flex flex-wrap justify-center gap-12 md:gap-20 opacity-60 grayscale hover:grayscale-0 transition-all duration-500">
                        </div>
                </div>
            </div>
        </section>

        <section id="page-projects" class="page-container">
            <div class="container mx-auto px-6 md:px-12 max-w-6xl space-y-32" id="projects-list">
                </div>
        </section>

        <section id="page-services" class="page-container">
            <div class="container mx-auto px-6 md:px-12 max-w-6xl">
                <div class="text-center mb-20 reveal">
                    <h2 class="font-display text-5xl mb-4">Servicios</h2>
                    <div class="w-12 h-px bg-black mx-auto"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="services-grid">
                    </div>
            </div>
        </section>

        <section id="page-rental" class="page-container">
            <div class="container mx-auto px-6 md:px-12 max-w-7xl">
                <div class="text-center mb-16 reveal">
                    <h2 class="font-display text-5xl mb-4">Rental</h2>
                    <p class="text-gray-500 font-light">Equipo profesional para tu visión.</p>
                </div>

                <div class="flex justify-center flex-wrap gap-4 mb-16 reveal" id="rental-cats">
                    </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" id="rental-grid">
                    </div>
            </div>
        </section>

        <section id="page-about" class="page-container bg-gray-50">
            <div class="container mx-auto px-6 md:px-12 max-w-4xl pt-10">
                <div class="text-center reveal">
                    <div class="w-64 h-64 mx-auto mb-10 overflow-hidden relative">
                        <img id="about-img" src="https://placehold.co/400" class="w-full h-full object-cover grayscale hover:grayscale-0 transition duration-700">
                    </div>
                    <h2 class="font-display text-5xl mb-6">Adán Gómez</h2>
                    <p class="text-xl text-gray-500 font-light italic mb-16" id="about-intro">--</p>
                </div>
                <div class="prose max-w-none text-gray-600 font-light leading-relaxed text-justify reveal" id="about-bio">
                    </div>
            </div>
        </section>

        <section id="page-contact" class="page-container">
            <div class="container mx-auto px-6 md:px-12 max-w-4xl text-center">
                <h2 class="font-display text-5xl mb-12 reveal">Contacto</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-20 reveal" id="contact-grid">
                    </div>
                <div class="aspect-video bg-gray-100 reveal">
                    <iframe id="contact-map" class="w-full h-full grayscale hover:grayscale-0 transition duration-700" frameborder="0"></iframe>
                </div>
            </div>
        </section>

        <div id="dynamic-detail-container"></div>

    </main>

    <div class="cart-overlay" onclick="UI.toggleCart()"></div>
    <div class="cart-drawer flex flex-col">
        <div class="p-6 border-b flex justify-between items-center">
            <h3 class="font-display text-2xl">Reserva</h3>
            <button onclick="UI.toggleCart()" class="text-xl hover:text-red-500">&times;</button>
        </div>
        <div class="flex-1 overflow-y-auto p-6 space-y-6" id="cart-items">
            <p class="text-center text-gray-400 py-10">Carrito vacío.</p>
        </div>
        <div class="p-6 border-t bg-gray-50">
            <div class="flex justify-between text-lg font-bold mb-6">
                <span>Total Estimado:</span>
                <span id="cart-total">$0.00</span>
            </div>
            <button onclick="UI.startCheckout()" id="btn-checkout" class="w-full bg-black text-white py-4 font-bold tracking-widest text-sm hover:bg-gray-800 transition disabled:opacity-50" disabled>SOLICITAR RESERVA</button>
        </div>
    </div>

    <div id="calendar-modal" class="calendar-overlay">
        <div class="calendar-content relative">
            <button onclick="UI.closeCalendar()" class="absolute top-4 right-4 text-gray-400 hover:text-black">&times;</button>
            <h3 class="font-display text-xl mb-6 text-center" id="cal-item-name">Disponibilidad</h3>
            
            <div class="flex justify-between items-center mb-4">
                <button onclick="Calendar.prev()" class="w-8 h-8 rounded-full hover:bg-gray-100"><i class="fas fa-chevron-left"></i></button>
                <span class="font-bold text-sm" id="cal-month-year"></span>
                <button onclick="Calendar.next()" class="w-8 h-8 rounded-full hover:bg-gray-100"><i class="fas fa-chevron-right"></i></button>
            </div>
            
            <div class="calendar-grid mb-6 text-xs font-bold text-gray-400">
                <span>D</span><span>L</span><span>M</span><span>M</span><span>J</span><span>V</span><span>S</span>
            </div>
            <div class="calendar-grid gap-y-2 mb-6" id="cal-grid"></div>

            <div class="bg-gray-50 p-4 text-sm space-y-2 mb-4">
                <div class="flex justify-between"><span>Fechas:</span> <span id="cal-dates" class="font-bold">--</span></div>
                <div class="flex justify-between"><span>Días:</span> <span id="cal-days">0</span></div>
                <div class="flex justify-between text-lg font-bold border-t border-gray-200 pt-2 mt-2"><span>Total:</span> <span id="cal-total">$0</span></div>
            </div>

            <button onclick="Calendar.confirm()" id="cal-confirm-btn" class="w-full bg-black text-white py-3 font-bold text-xs tracking-widest disabled:bg-gray-300" disabled>AGREGAR</button>
        </div>
    </div>

    <div id="checkout-modal" class="calendar-overlay">
        <div class="calendar-content max-w-lg">
            <div class="p-2">
                <div id="step-1" class="step-content active">
                    <h3 class="font-display text-2xl mb-6">Tus Datos</h3>
                    <div class="space-y-4">
                        <input type="text" id="chk-name" class="w-full p-3 border border-gray-200 focus:border-black outline-none transition" placeholder="Nombre Completo">
                        <input type="email" id="chk-email" class="w-full p-3 border border-gray-200 focus:border-black outline-none transition" placeholder="Email">
                        <input type="tel" id="chk-phone" class="w-full p-3 border border-gray-200 focus:border-black outline-none transition" placeholder="Teléfono / WhatsApp">
                    </div>
                    <button onclick="Checkout.next(2)" class="w-full bg-black text-white py-4 mt-6 font-bold tracking-widest text-sm">CONTINUAR</button>
                </div>
                
                <div id="step-2" class="step-content">
                    <h3 class="font-display text-2xl mb-6">Confirmar Reserva</h3>
                    <div id="chk-summary" class="bg-gray-50 p-4 mb-6 max-h-60 overflow-y-auto text-sm"></div>
                    <div class="flex justify-between font-bold text-xl mb-8"><span>Total:</span> <span id="chk-total">$0</span></div>
                    <div class="flex gap-4">
                        <button onclick="Checkout.prev(1)" class="w-1/3 border border-gray-300 py-3 font-bold text-xs">ATRÁS</button>
                        <button onclick="Checkout.submit()" class="w-2/3 bg-black text-white py-3 font-bold text-xs tracking-widest">CONFIRMAR SOLICITUD</button>
                    </div>
                </div>

                <div id="step-3" class="step-content text-center py-10">
                    <i class="fas fa-check-circle text-5xl text-green-500 mb-6"></i>
                    <h3 class="font-display text-3xl mb-4">¡Solicitud Enviada!</h3>
                    <p class="text-gray-500 mb-8">Te contactaré pronto para coordinar el pago y la entrega.</p>
                    <button onclick="location.reload()" class="bg-black text-white px-8 py-3 font-bold text-xs">VOLVER AL INICIO</button>
                </div>
            </div>
        </div>
    </div>

    <div id="lightbox" class="fixed inset-0 bg-black/95 z-[90] hidden flex justify-center items-center opacity-0 transition-opacity duration-300" onclick="if(event.target===this) UI.closeLightbox()">
        <img id="lb-img" class="max-h-[90vh] max-w-[90vw] object-contain shadow-2xl">
        <button onclick="UI.closeLightbox()" class="absolute top-6 right-6 text-white text-4xl hover:text-gray-400">&times;</button>
        <p id="lb-cap" class="absolute bottom-6 text-white/80 font-light tracking-wide text-sm"></p>
    </div>

    <script>
        // --- MOTOR DE DATOS ---
        const API_URL = '/.netlify/functions/get-website-data';
        let Data = { projects:[], rental:[], blocked:[], settings:{} };
        let Cart = [];
        let CurrentItem = null; // Para el modal de calendario

        // --- INICIO ---
        (async function init() {
            try {
                // 1. Fetch Datos Reales
                const res = await fetch(API_URL);
                const json = await res.json();
                
                // 2. Procesar Datos
                Data.settings = json.settings || {};
                Data.about = json.about || {};
                
                // Procesar Portafolio (Masonry)
                Data.portfolio = (json.portfolioGallery || []).map(i => ({ src: i.imageUrl, cap: i.caption }));
                
                // Procesar Proyectos
                Data.projects = (json.projects || []).filter(p => p.status !== 'hidden');
                
                // Procesar Servicios
                Data.services = (json.services || []).filter(s => s.status !== 'hidden');
                
                // Procesar Alquiler (Estructura de Categorías)
                Data.rental = {};
                (json.rentalCategories || []).forEach(c => Data.rental[c.name] = []);
                Data.rental['Otros'] = [];
                
                (json.rentalItems || []).forEach(i => {
                    if(i.status === 'hidden') return;
                    const cat = (json.rentalCategories || []).find(c => c.id === i.categoryId);
                    const catName = cat ? cat.name : 'Otros';
                    Data.rental[catName].push(i);
                });
                
                // Procesar Bloqueos (Para calendario)
                Data.blocked = json.blockedDates || [];

                // 3. Renderizar Todo
                Render.header();
                Render.portfolio();
                Render.projects();
                Render.services();
                Render.rental();
                Render.about();
                Render.contact();
                Render.clients(json.clientLogos);

                // 4. Quitar Loader
                setTimeout(() => document.getElementById('page-loader').classList.add('hidden'), 500);

            } catch (e) {
                console.error(e);
                alert("Error cargando el sitio.");
            }
        })();

        // --- RENDERIZADORES (Diseño Estricto) ---
        const Render = {
            header: () => {
                // Inyectar Logos Dinámicos si existen
                if(Data.settings.logo_url_black) document.getElementById('header-logo').src = Data.settings.logo_url_black;
                if(Data.settings.logo_url_black) document.getElementById('loader-logo').src = Data.settings.logo_url_black;
                // Links sociales
                if(Data.settings.social_instagram) document.getElementById('link-ig').href = Data.settings.social_instagram;
            },
            
            portfolio: () => {
                const grid = document.getElementById('portfolio-grid');
                grid.innerHTML = Data.portfolio.map(i => `
                    <div class="gallery-item mb-6" onclick="UI.lightbox('${i.src}', '${i.cap}')">
                        <img src="${i.src}" class="w-full bg-gray-100">
                        <div class="gallery-overlay"><p class="text-white text-sm font-light tracking-widest">${i.cap||''}</p></div>
                    </div>
                `).join('');
                UI.observe();
            },
            
            projects: () => {
                const list = document.getElementById('projects-list');
                list.innerHTML = Data.projects.map((p, idx) => {
                    const isLeft = idx % 2 === 0;
                    return `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center reveal">
                        <div class="${isLeft ? 'order-1 md:order-1' : 'order-1 md:order-2'} overflow-hidden shadow-xl">
                            <img src="${p.coverImageUrl}" class="w-full h-full object-cover transition duration-700 hover:scale-105 cursor-pointer" onclick="UI.openProject('${p.id}')">
                        </div>
                        <div class="${isLeft ? 'order-2 md:order-2 md:pl-10' : 'order-2 md:order-1 md:pr-10 text-right'}">
                            <h3 class="font-display text-4xl md:text-5xl mb-6">${p.title}</h3>
                            <div class="w-12 h-1 bg-black mb-6 ${isLeft ? '' : 'ml-auto'}"></div>
                            <p class="text-gray-500 font-light leading-relaxed mb-8">${p.description}</p>
                            <button onclick="UI.openProject('${p.id}')" class="text-xs font-bold uppercase tracking-[0.2em] border-b border-black pb-1 hover:text-gray-600 transition">Ver Proyecto</button>
                        </div>
                    </div>`;
                }).join('');
            },

            services: () => {
                const grid = document.getElementById('services-grid');
                grid.innerHTML = Data.services.map(s => `
                    <div class="service-grid-item group cursor-pointer border border-gray-100 p-8 hover:shadow-xl transition duration-500 text-center" onclick="UI.openService('${s.id}')">
                        <div class="w-16 h-16 mx-auto bg-gray-50 rounded-full flex items-center justify-center mb-6 group-hover:bg-black transition duration-500">
                            <i class="${s.iconClass} text-2xl text-gray-800 group-hover:text-white"></i>
                        </div>
                        <h3 class="font-display text-2xl mb-4">${s.title}</h3>
                        <p class="text-xs font-bold uppercase tracking-widest text-gray-400 group-hover:text-black transition">Descubrir</p>
                    </div>
                `).join('');
            },

            rental: () => {
                // 1. Filtros
                const cats = document.getElementById('rental-cats');
                const catKeys = Object.keys(Data.rental).filter(k => Data.rental[k].length > 0);
                cats.innerHTML = `<button class="rental-cat active px-6 py-2 border border-black bg-black text-white text-xs font-bold uppercase tracking-widest" onclick="UI.filterRental('all', this)">Todo</button>` + 
                    catKeys.map(c => `<button class="rental-cat px-6 py-2 border border-gray-200 text-gray-500 text-xs font-bold uppercase tracking-widest hover:border-black hover:text-black transition" onclick="UI.filterRental('${c}', this)">${c}</button>`).join('');

                // 2. Grid (Uniformidad Forzada)
                const grid = document.getElementById('rental-grid');
                const allItems = Object.values(Data.rental).flat();
                
                grid.innerHTML = allItems.map(item => {
                    const price = parseFloat(item.pricePerDay);
                    const hasTax = String(item.hasTax).toUpperCase() === 'TRUE';
                    const finalPrice = hasTax ? price * 1.13 : price;
                    const taxLabel = hasTax ? '<span class="text-[10px] text-gray-400 ml-1">+IVI</span>' : '';
                    const imgs = (item.images && item.images.length) ? item.images.map(i=>i.imageUrl) : ['https://placehold.co/600x400'];

                    return `
                    <div class="rental-card reveal" data-cat="${item.categoryId}">
                        <div class="rental-image-container group">
                            <img src="${imgs[0]}" id="img-${item.id}" class="transition duration-700 group-hover:scale-105">
                            ${imgs.length > 1 ? `
                                <button class="absolute top-1/2 left-2 -translate-y-1/2 bg-black/20 text-white w-8 h-8 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-black/50" onclick="UI.slide('${item.id}', -1, [${imgs.map(i=>`'${i}'`)}])"><i class="fas fa-chevron-left"></i></button>
                                <button class="absolute top-1/2 right-2 -translate-y-1/2 bg-black/20 text-white w-8 h-8 rounded-full opacity-0 group-hover:opacity-100 transition hover:bg-black/50" onclick="UI.slide('${item.id}', 1, [${imgs.map(i=>`'${i}'`)}])"><i class="fas fa-chevron-right"></i></button>
                            ` : ''}
                        </div>
                        <div class="p-6 flex flex-col flex-1">
                            <div class="flex justify-between items-baseline mb-2">
                                <h3 class="font-display text-2xl leading-none">${item.name}</h3>
                                <p class="font-bold font-sans text-lg">$${finalPrice.toFixed(0)}${taxLabel}</p>
                            </div>
                            <p class="text-gray-500 text-sm font-light leading-relaxed mb-6 flex-1 line-clamp-3">${item.description}</p>
                            <div class="flex gap-2 mt-auto">
                                <button onclick="UI.openCalendar('${item.id}')" class="flex-1 border border-black py-3 text-xs font-bold uppercase tracking-widest hover:bg-gray-50 transition">Ver Disponibilidad</button>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            },
            
            about: () => {
                if(Data.about.profile_image) document.getElementById('about-img').src = Data.about.profile_image;
                if(Data.about.intro_phrase) document.getElementById('about-intro').innerText = `"${Data.about.intro_phrase}"`;
                if(Data.about.bio) document.getElementById('about-bio').innerHTML = Data.about.bio.replace(/\n/g, '<br>');
            },

            contact: () => {
                const grid = document.getElementById('contact-grid');
                const s = Data.settings;
                grid.innerHTML = `
                    <a href="mailto:${s.contact_email}" class="group p-8 border border-transparent hover:border-gray-100 hover:shadow-lg transition duration-500">
                        <i class="fas fa-envelope text-3xl mb-4 text-gray-300 group-hover:text-black transition"></i>
                        <h4 class="font-bold uppercase tracking-widest text-sm">Email</h4>
                    </a>
                    <a href="https://wa.me/${s.contact_phone?.replace(/\D/g,'')}" class="group p-8 border border-transparent hover:border-gray-100 hover:shadow-lg transition duration-500">
                        <i class="fab fa-whatsapp text-3xl mb-4 text-gray-300 group-hover:text-green-600 transition"></i>
                        <h4 class="font-bold uppercase tracking-widest text-sm">WhatsApp</h4>
                    </a>
                    <a href="${s.social_instagram}" class="group p-8 border border-transparent hover:border-gray-100 hover:shadow-lg transition duration-500">
                        <i class="fab fa-instagram text-3xl mb-4 text-gray-300 group-hover:text-black transition"></i>
                        <h4 class="font-bold uppercase tracking-widest text-sm">Instagram</h4>
                    </a>
                `;
                if(s.social_maps && s.social_maps.includes('embed')) document.getElementById('contact-map').src = s.social_maps;
            },

            clients: (logos) => {
                if(!logos) return;
                const container = document.getElementById('client-logos-grid');
                container.innerHTML = logos.map(l => `<img src="${l.logoUrl}" class="h-12 w-auto object-contain">`).join('');
            }
        };

        // --- UI ACTIONS & LOGIC ---
        const UI = {
            nav: (id) => {
                const target = document.getElementById('page-' + id);
                document.querySelectorAll('.page-container').forEach(p => {
                    p.style.opacity = 0;
                    setTimeout(() => p.style.display = 'none', 500);
                });
                setTimeout(() => {
                    target.style.display = 'block';
                    setTimeout(() => target.style.opacity = 1, 50);
                }, 500);
                window.scrollTo(0,0);
                document.getElementById('mobile-menu').classList.remove('opacity-100', 'pointer-events-auto');
            },
            
            toggleMobileMenu: () => {
                const m = document.getElementById('mobile-menu');
                m.classList.toggle('opacity-100');
                m.classList.toggle('pointer-events-auto');
            },

            observe: () => {
                const obs = new IntersectionObserver(entries => {
                    entries.forEach(e => { if(e.isIntersecting) { e.target.classList.add('visible'); obs.unobserve(e.target); }});
                }, { threshold: 0.1 });
                document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
            },

            lightbox: (src, cap) => {
                document.getElementById('lb-img').src = src;
                document.getElementById('lb-cap').innerText = cap;
                const lb = document.getElementById('lightbox');
                lb.classList.remove('hidden');
                setTimeout(() => lb.classList.remove('opacity-0'), 10);
            },
            
            closeLightbox: () => {
                const lb = document.getElementById('lightbox');
                lb.classList.add('opacity-0');
                setTimeout(() => lb.classList.add('hidden'), 300);
            },

            filterRental: (cat, btn) => {
                document.querySelectorAll('.rental-cat').forEach(b => {
                    b.classList.remove('bg-black', 'text-white');
                    b.classList.add('bg-white', 'text-gray-500');
                });
                btn.classList.remove('bg-white', 'text-gray-500');
                btn.classList.add('bg-black', 'text-white');
                
                const cards = document.querySelectorAll('.rental-card');
                const catId = (Data.rentalCategories || []).find(c => c.name === cat)?.id;
                
                cards.forEach(c => {
                    if (cat === 'all' || c.dataset.cat === catId) {
                        c.style.display = 'flex';
                        setTimeout(() => c.style.opacity = 1, 50);
                    } else {
                        c.style.opacity = 0;
                        setTimeout(() => c.style.display = 'none', 300);
                    }
                });
            },

            // --- CALENDARIO LÓGICO ---
            openCalendar: (itemId) => {
                // Encontrar item
                const allItems = Object.values(Data.rental).flat();
                CurrentItem = allItems.find(i => i.id === itemId);
                
                document.getElementById('cal-item-name').innerText = CurrentItem.name;
                Calendar.init(itemId);
                
                document.getElementById('calendar-modal').classList.add('visible');
            },
            
            closeCalendar: () => document.getElementById('calendar-modal').classList.remove('visible'),

            // --- CARRITO ---
            toggleCart: () => {
                document.querySelector('.cart-drawer').classList.toggle('open');
                document.querySelector('.cart-overlay').classList.toggle('open');
            },
            
            renderCart: () => {
                const c = document.getElementById('cart-items');
                if(Cart.length === 0) {
                    c.innerHTML = '<p class="text-center text-gray-400 py-10">Tu carrito está vacío.</p>';
                    document.getElementById('btn-checkout').disabled = true;
                    document.getElementById('cart-total').innerText = '$0.00';
                    document.getElementById('cart-count').innerText = 0;
                    document.getElementById('cart-count').style.opacity = 0;
                    return;
                }
                
                let total = 0;
                c.innerHTML = Cart.map((i, idx) => {
                    total += i.totalPrice;
                    return `
                    <div class="flex gap-4 border-b border-gray-100 pb-4">
                        <img src="${i.img}" class="w-16 h-16 object-cover bg-gray-100">
                        <div class="flex-1">
                            <h4 class="font-bold text-sm">${i.name}</h4>
                            <p class="text-xs text-gray-500">${i.start} al ${i.end}</p>
                            <p class="text-sm font-bold mt-1">$${i.totalPrice.toFixed(2)}</p>
                        </div>
                        <button onclick="UI.removeFromCart(${idx})" class="text-gray-400 hover:text-red-500"><i class="fas fa-trash"></i></button>
                    </div>`;
                }).join('');
                
                document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;
                document.getElementById('btn-checkout').disabled = false;
                document.getElementById('cart-count').innerText = Cart.length;
                document.getElementById('cart-count').style.opacity = 1;
            },

            addToCart: (dates) => {
                const basePrice = parseFloat(CurrentItem.pricePerDay);
                const hasTax = String(CurrentItem.hasTax).toUpperCase() === 'TRUE';
                const finalPrice = hasTax ? basePrice * 1.13 : basePrice;
                
                Cart.push({
                    id: CurrentItem.id,
                    name: CurrentItem.name,
                    img: (CurrentItem.images[0] || {}).imageUrl || '',
                    start: dates.startStr,
                    end: dates.endStr,
                    days: dates.days,
                    totalPrice: finalPrice * dates.days
                });
                
                UI.closeCalendar();
                UI.renderCart();
                UI.toggleCart();
            },

            removeFromCart: (idx) => {
                Cart.splice(idx, 1);
                UI.renderCart();
            },
            
            startCheckout: () => {
                UI.toggleCart();
                document.getElementById('checkout-modal').classList.add('visible');
                Checkout.renderSummary();
            },

            // --- DETALLES DINÁMICOS ---
            openProject: (id) => {
                const p = Data.projects.find(x => x.id === id);
                const html = `
                    <div class="fixed inset-0 bg-white z-[60] overflow-y-auto animate-fade-in" id="detail-modal">
                        <button onclick="document.getElementById('detail-modal').remove()" class="fixed top-6 right-6 text-3xl z-50">&times;</button>
                        <div class="container mx-auto px-6 py-20 max-w-5xl">
                            <h1 class="font-display text-5xl md:text-6xl text-center mb-8">${p.title}</h1>
                            <p class="text-gray-600 text-center max-w-2xl mx-auto mb-16">${p.description}</p>
                            <div class="columns-1 md:columns-2 gap-8 space-y-8">
                                ${(p.images||[]).map(i => `<img src="${i.imageUrl}" class="w-full" onclick="UI.lightbox('${i.imageUrl}','')">`).join('')}
                            </div>
                        </div>
                    </div>`;
                document.body.insertAdjacentHTML('beforeend', html);
            },
            
            openService: (id) => {
                const s = Data.services.find(x => x.id === id);
                const blocks = s.contentBlocks || [];
                const html = `
                     <div class="fixed inset-0 bg-white z-[60] overflow-y-auto animate-fade-in" id="detail-modal">
                        <button onclick="document.getElementById('detail-modal').remove()" class="fixed top-6 right-6 text-3xl z-50">&times;</button>
                        <div class="h-[60vh] bg-gray-900 relative flex items-center justify-center">
                            <div class="absolute inset-0 opacity-40 bg-[url('${(s.images[0]||{}).imageUrl}')] bg-cover bg-center"></div>
                            <h1 class="relative font-display text-6xl text-white z-10">${s.title}</h1>
                        </div>
                        <div class="container mx-auto px-6 py-20 max-w-3xl prose">
                            <p class="lead text-xl text-center italic mb-12">${s.introText || ''}</p>
                            ${blocks.map(b => `<h3>${b.blockTitle}</h3><div>${b.blockContentHtml}</div>`).join('')}
                            
                             <div class="mt-16 not-prose grid grid-cols-2 gap-4">
                                ${(s.images||[]).map(i => `<img src="${i.imageUrl}" class="w-full h-48 object-cover cursor-pointer" onclick="UI.lightbox('${i.imageUrl}','')">`).join('')}
                            </div>
                            
                            <div class="text-center mt-16">
                                <a href="https://wa.me/${Data.settings.contact_phone}" target="_blank" class="bg-black text-white px-8 py-4 font-bold tracking-widest text-sm no-underline inline-block">COTIZAR</a>
                            </div>
                        </div>
                    </div>`;
                document.body.insertAdjacentHTML('beforeend', html);
            }
        };

        // --- LÓGICA DE CALENDARIO ---
        const Calendar = {
            currentDate: new Date(),
            selectedStart: null,
            selectedEnd: null,
            
            init: () => {
                Calendar.currentDate.setDate(1);
                Calendar.selectedStart = null;
                Calendar.selectedEnd = null;
                Calendar.render();
            },
            
            next: () => { Calendar.currentDate.setMonth(Calendar.currentDate.getMonth()+1); Calendar.render(); },
            prev: () => { Calendar.currentDate.setMonth(Calendar.currentDate.getMonth()-1); Calendar.render(); },
            
            render: () => {
                const year = Calendar.currentDate.getFullYear();
                const month = Calendar.currentDate.getMonth();
                const today = new Date(); today.setHours(0,0,0,0);
                
                document.getElementById('cal-month-year').innerText = new Intl.DateTimeFormat('es-ES', { month: 'long', year: 'numeric' }).format(Calendar.currentDate);
                
                const grid = document.getElementById('cal-grid');
                grid.innerHTML = '';
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                // Bloqueos
                const blocked = Data.blocked.filter(b => b.itemId === CurrentItem.id).map(b => ({ start: b.startDate, end: b.endDate }));

                for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;
                
                for(let d=1; d<=daysInMonth; d++) {
                    const date = new Date(year, month, d);
                    const dateStr = date.toISOString().split('T')[0];
                    const isPast = date < today;
                    const isBlocked = blocked.some(b => dateStr >= b.start && dateStr <= b.end);
                    
                    const el = document.createElement('div');
                    el.className = `calendar-day ${isPast||isBlocked ? 'disabled' : ''}`;
                    el.innerText = d;
                    
                    if(!isPast && !isBlocked) {
                        el.onclick = () => Calendar.select(date);
                        
                        // Estilos de selección
                        if(Calendar.selectedStart && date.getTime() === Calendar.selectedStart.getTime()) el.classList.add('selected');
                        if(Calendar.selectedEnd && date.getTime() === Calendar.selectedEnd.getTime()) el.classList.add('selected');
                        if(Calendar.selectedStart && Calendar.selectedEnd && date > Calendar.selectedStart && date < Calendar.selectedEnd) el.classList.add('range');
                    }
                    grid.appendChild(el);
                }
                Calendar.updateSummary();
            },
            
            select: (date) => {
                if(!Calendar.selectedStart || (Calendar.selectedStart && Calendar.selectedEnd)) {
                    Calendar.selectedStart = date;
                    Calendar.selectedEnd = null;
                } else if (date < Calendar.selectedStart) {
                    Calendar.selectedStart = date;
                } else {
                    // Validar bloqueo intermedio
                    let valid = true;
                    const temp = new Date(Calendar.selectedStart);
                    const blocked = Data.blocked.filter(b => b.itemId === CurrentItem.id);
                    
                    while(temp <= date) {
                        const s = temp.toISOString().split('T')[0];
                        if(blocked.some(b => s >= b.startDate && s <= b.endDate)) { valid=false; break; }
                        temp.setDate(temp.getDate()+1);
                    }
                    
                    if(valid) Calendar.selectedEnd = date;
                    else alert("El rango incluye días no disponibles.");
                }
                Calendar.render();
            },
            
            updateSummary: () => {
                const btn = document.getElementById('cal-confirm-btn');
                if(!Calendar.selectedStart || !Calendar.selectedEnd) {
                    document.getElementById('cal-dates').innerText = '--';
                    document.getElementById('cal-total').innerText = '$0';
                    btn.disabled = true;
                    return;
                }
                
                const diff = Math.ceil((Calendar.selectedEnd - Calendar.selectedStart) / (1000*60*60*24)) + 1;
                const basePrice = parseFloat(CurrentItem.pricePerDay);
                const hasTax = String(CurrentItem.hasTax).toUpperCase() === 'TRUE';
                const finalPrice = hasTax ? basePrice * 1.13 : basePrice;
                
                document.getElementById('cal-dates').innerText = `${Calendar.selectedStart.getDate()}/${Calendar.selectedStart.getMonth()+1} - ${Calendar.selectedEnd.getDate()}/${Calendar.selectedEnd.getMonth()+1}`;
                document.getElementById('cal-days').innerText = diff;
                document.getElementById('cal-total').innerText = `$${(finalPrice * diff).toFixed(2)}`;
                btn.disabled = false;
            },
            
            confirm: () => {
                const diff = Math.ceil((Calendar.selectedEnd - Calendar.selectedStart) / (1000*60*60*24)) + 1;
                UI.addToCart({
                    startStr: Calendar.selectedStart.toISOString().split('T')[0],
                    endStr: Calendar.selectedEnd.toISOString().split('T')[0],
                    days: diff
                });
            }
        };
        
        // --- LOGICA CHECKOUT ---
        const Checkout = {
            data: {},
            next: (step) => {
                // Validar paso 1
                if(step === 2) {
                    const name = document.getElementById('chk-name').value;
                    const email = document.getElementById('chk-email').value;
                    if(!name || !email) { alert("Completa los campos obligatorios."); return; }
                    Checkout.data.name = name; Checkout.data.email = email; Checkout.data.phone = document.getElementById('chk-phone').value;
                }
                document.querySelectorAll('.step-content').forEach(e => e.classList.remove('active'));
                document.getElementById(`step-${step}`).classList.add('active');
            },
            prev: (step) => Checkout.next(step),
            
            renderSummary: () => {
                let total = 0;
                const html = Cart.map(i => {
                    total += i.totalPrice;
                    return `<div class="flex justify-between border-b border-gray-200 py-2">
                        <div><p class="font-bold">${i.name}</p><p class="text-xs text-gray-500">${i.days} días (${i.start})</p></div>
                        <p class="font-bold">$${i.totalPrice.toFixed(2)}</p>
                    </div>`;
                }).join('');
                document.getElementById('chk-summary').innerHTML = html;
                document.getElementById('chk-total').innerText = `$${total.toFixed(2)}`;
            },
            
            submit: async () => {
                // Aquí enviarías a tu función create-booking.js
                // Por ahora simulamos éxito
                const payload = {
                    customerName: Checkout.data.name,
                    customerEmail: Checkout.data.email,
                    customerPhone: Checkout.data.phone,
                    items: Cart // Array de items
                };
                
                // Simulación API
                setTimeout(() => {
                    Cart = []; UI.renderCart();
                    Checkout.next(3);
                }, 1000);
            }
        };

        // Header Scroll
        window.addEventListener('scroll', () => {
            const h = document.getElementById('header');
            if(window.scrollY > 50) h.classList.add('header-scrolled');
            else h.classList.remove('header-scrolled');
        });
        
        // Image Slideshow Helper
        UI.slide = (id, dir, imgs) => {
            const img = document.getElementById(`img-${id}`);
            let curr = imgs.indexOf(img.getAttribute('src'));
            let next = curr + dir;
            if(next >= imgs.length) next = 0;
            if(next < 0) next = imgs.length - 1;
            img.src = imgs[next];
        };

    </script>
</body>
</html>






