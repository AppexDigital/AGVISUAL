<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adán Gómez | Fotógrafo Profesional</title>
    <link rel="icon" type="image/png" href="imagenes/Icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root { --bg-main: #FDFDFD; --text-dark: #1a1a1a; --text-light: #f8f9fa; --accent: #3a3a3a; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg-main); color: var(--text-dark); overflow-x: hidden; }
        h1, h2, h3, h4, .font-display { font-family: 'Cormorant Garamond', serif; line-height: 1.4; }
        
        /* Loader & Transitions */
        .page-container { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .page-active { display: block; opacity: 1; }
        .reveal { opacity: 0; transition: opacity 1.2s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .reveal.visible { opacity: 1; }
        .loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-main); z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s ease, visibility 0.5s ease; }
        .loader.hidden { opacity: 0; visibility: hidden; }
        .loader-circle { width: 50px; height: 50px; border: 3px solid rgba(0, 0, 0, 0.1); border-radius: 50%; border-top-color: var(--accent); animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Header & Nav */
        #header { transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); padding: 1.5rem 0; background: transparent; }
        #header.header-scrolled { padding: 0.5rem 0; background-color: rgba(253, 253, 253, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
        .nav-link-underline { position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background-color: black; transition: width 0.3s ease; }
        .nav-link:hover .nav-link-underline, .nav-link.nav-active .nav-link-underline { width: 100%; }

        /* Gallery & Images */
        .gallery-item { cursor: pointer; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.5s; position: relative; overflow: hidden; break-inside: avoid; margin-bottom: 1.5rem; }
        .gallery-item:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); }
        .gallery-item img { transition: transform 0.8s ease; width: 100%; display: block; }
        .gallery-item:hover img { transform: scale(1.05); }
        .gallery-item .overlay { opacity: 0; transition: opacity 0.5s ease; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 80%); }
        .gallery-item:hover .overlay { opacity: 1; }

        /* Lightbox */
        #lightbox { background-color: rgba(10, 10, 10, 0.95); backdrop-filter: blur(8px); transition: opacity 0.4s; }
        #lightbox.visible #lightbox-image { transform: scale(1); }
        #lightbox-image { transform: scale(0.9); transition: transform 0.4s; max-height: 90vh; max-width: 90vw; object-fit: contain; }

        /* Mobile Menu */
        #mobile-menu { background-color: rgba(253, 253, 253, 0.98); backdrop-filter: blur(20px); transform: translateX(100%); transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1); }
        #mobile-menu.open { transform: translateX(0); }

        /* Cart */
        #cart-drawer { transform: translateX(100%); transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1); }
        #cart-drawer.visible { transform: translateX(0); }
        .cart-item-count { transform: scale(0); transition: transform 0.3s; }
        .cart-item-count.visible { transform: scale(1); }
        
        /* Utils */
        .img-placeholder { background-color: #f3f4f6; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="antialiased">

    <div class="loader" id="page-loader">
        <div class="flex flex-col items-center w-3/4 max-w-xs md:max-w-md">
            <h1 class="text-3xl font-display font-bold mb-4 tracking-widest">AG VISUAL</h1>
            <div class="loader-circle"></div>
        </div>
    </div>
    
    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="#" data-target="portfolio" class="nav-link text-2xl font-display font-bold tracking-tighter">AG VISUAL</a>

            <div class="flex items-center">
                <nav class="hidden lg:flex items-center space-x-8 text-xs uppercase tracking-widest font-bold text-gray-800">
                    <a href="#" data-target="portfolio" class="nav-link relative group">Portafolio<span class="nav-link-underline"></span></a>
                    <a href="#" data-target="projects" class="nav-link relative group">Proyectos<span class="nav-link-underline"></span></a>
                    <a href="#" data-target="services" class="nav-link relative group">Servicios<span class="nav-link-underline"></span></a>
                    <a href="#" data-target="rental" class="nav-link relative group">Alquiler<span class="nav-link-underline"></span></a>
                    <a href="#" data-target="about" class="nav-link relative group">Quién Soy<span class="nav-link-underline"></span></a>
                    <a href="#" data-target="contact" class="nav-link relative group">Contacto<span class="nav-link-underline"></span></a>
                </nav>

                <div class="hidden lg:flex items-center space-x-4 ml-8">
                    <a href="#" class="text-gray-600 hover:text-black"><i class="fab fa-instagram fa-lg"></i></a>
                    <button id="cart-button" class="relative text-gray-600 hover:text-black ml-2">
                        <i class="fas fa-shopping-bag fa-lg"></i>
                        <span id="cart-item-count" class="cart-item-count absolute -top-2 -right-2 bg-black text-white text-[10px] w-4 h-4 flex items-center justify-center rounded-full font-bold">0</span>
                    </button>
                </div>

                <button id="mobile-menu-button" class="lg:hidden z-50 ml-4 focus:outline-none">
                    <i class="fas fa-bars fa-lg"></i>
                </button>
            </div>
        </div>
    </header>

    <div id="mobile-menu" class="fixed inset-0 z-40 flex flex-col justify-center items-center space-y-8 text-2xl font-display">
        <a href="#" data-target="portfolio" class="mobile-nav-link">Portafolio</a>
        <a href="#" data-target="projects" class="mobile-nav-link">Proyectos</a>
        <a href="#" data-target="services" class="mobile-nav-link">Servicios</a>
        <a href="#" data-target="rental" class="mobile-nav-link">Alquiler</a>
        <a href="#" data-target="about" class="mobile-nav-link">Quién Soy</a>
        <a href="#" data-target="contact" class="mobile-nav-link">Contacto</a>
    </div>

    <main id="main-content">
        
        <section id="portfolio" class="page-container pt-32 pb-20 page-active">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="text-center mb-12 reveal visible">
                    <h2 class="text-4xl md:text-6xl font-display mb-4" id="hero-title">Visual Storytelling</h2>
                    <p class="text-gray-500 max-w-xl mx-auto" id="hero-subtitle">Capturando momentos, creando legados.</p>
                </div>
                <div id="portfolio-gallery" class="columns-1 sm:columns-2 lg:columns-3 gap-6 space-y-6 reveal visible min-h-[50vh]">
                    </div>
            </div>
        </section>

        <section id="projects" class="page-container pt-32 pb-20 bg-gray-50">
            <div class="container mx-auto px-4 md:px-12">
                <div id="projects-container" class="space-y-24">
                    </div>
            </div>
        </section>

        <section id="services" class="page-container pt-32 pb-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-display">Servicios</h2>
                    <div class="w-20 h-1 bg-black mx-auto mt-4"></div>
                </div>
                <div id="services-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 max-w-6xl mx-auto">
                    </div>
            </div>
        </section>

        <section id="rental" class="page-container pt-32 pb-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-display">Rental de Equipo</h2>
                    <p class="text-gray-500 mt-2">Herramientas profesionales para tu visión.</p>
                </div>
                
                <div id="rental-filters" class="flex justify-center flex-wrap gap-4 mb-12">
                    </div>
                
                <div id="rental-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    </div>
            </div>
        </section>

        <section id="about" class="page-container pt-32 pb-20 bg-gray-50">
            <div class="container mx-auto px-6 max-w-4xl">
                <div class="text-center mb-12">
                    <div class="relative w-64 h-64 mx-auto mb-8 overflow-hidden rounded-full shadow-xl">
                        <img id="about-profile-img" src="https://placehold.co/400" class="w-full h-full object-cover">
                    </div>
                    <h2 class="text-4xl font-display mb-4">Adán Gómez</h2>
                    <p class="text-xl text-gray-600 italic" id="about-intro">"Cargando biografía..."</p>
                </div>
                <div class="prose max-w-none text-gray-600 space-y-8 text-justify leading-relaxed">
                    <div id="about-bio"></div>
                </div>
            </div>
        </section>

        <section id="contact" class="page-container pt-32 pb-20">
            <div class="container mx-auto px-6 max-w-4xl text-center">
                <h2 class="text-4xl font-display mb-8">Hablemos</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16" id="contact-info">
                    </div>
                <div class="w-full h-96 bg-gray-200 rounded-lg overflow-hidden shadow-inner">
                     <iframe id="google-map" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
        </section>

        <div id="detail-pages-container"></div>

    </main>

    <div id="lightbox" class="fixed inset-0 z-[100] flex items-center justify-center hidden opacity-0">
        <button id="lightbox-close" class="absolute top-6 right-6 text-white text-5xl hover:text-gray-300">&times;</button>
        <button id="lightbox-prev" class="absolute left-4 text-white text-4xl p-4 hover:bg-white/10 rounded-full"><i class="fas fa-chevron-left"></i></button>
        <button id="lightbox-next" class="absolute right-4 text-white text-4xl p-4 hover:bg-white/10 rounded-full"><i class="fas fa-chevron-right"></i></button>
        <img id="lightbox-image" src="" class="max-w-[95vw] max-h-[95vh] shadow-2xl rounded-sm">
        <div class="absolute bottom-6 left-0 right-0 text-center text-white text-lg font-light tracking-wide" id="lightbox-caption"></div>
    </div>

    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden transition-opacity"></div>
    <aside id="cart-drawer" class="fixed top-0 right-0 w-full max-w-md h-full bg-white z-[70] shadow-2xl flex flex-col">
        <div class="p-6 border-b flex justify-between items-center bg-gray-50">
            <h2 class="text-2xl font-display font-bold">Tu Reserva</h2>
            <button id="cart-close-btn" class="text-2xl text-gray-400 hover:text-black">&times;</button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4">
            <div id="cart-empty" class="text-center text-gray-400 py-10">Tu carrito está vacío.</div>
        </div>
        <div class="p-6 border-t bg-gray-50">
            <div class="flex justify-between items-center text-xl font-bold mb-4">
                <span>Total Estimado:</span>
                <span id="cart-total">$0.00</span>
            </div>
            <button id="checkout-btn" class="w-full bg-black text-white py-4 font-bold tracking-widest hover:bg-gray-800 transition-colors uppercase text-sm">Solicitar Reserva</button>
        </div>
    </aside>

    <script>
        // --- 1. CONFIGURACIÓN Y ESTADO ---
        const API_URL = '/.netlify/functions/get-website-data'; 
        let appData = {
            projects: [],
            services: [],
            rentalItems: [],
            rentalCategories: [],
            portfolioGallery: [],
            clientLogos: [],
            settings: {},
            about: {}
        };
        let cart = [];

        // --- 2. MOTOR DE DATOS (Hidratación) ---
        async function initApp() {
            try {
                // Fetch de datos reales
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Error de conexión');
                const data = await response.json();
                
                // Asignar datos al estado global
                appData = data;
                
                // Renderizar la UI con datos reales
                renderUI();
                
                // Ocultar loader
                document.getElementById('page-loader').classList.add('hidden');
                
            } catch (error) {
                console.error("Fallo crítico:", error);
                document.querySelector('.loader-circle').style.borderColor = 'red';
                alert("Hubo un problema cargando el sitio. Por favor recarga.");
            }
        }

        function renderUI() {
            // A. Configuración Global (Logos, Textos)
            applySettings();
            
            // B. Renderizar Secciones Principales
            renderPortfolio(appData.portfolioGallery);
            renderProjects(appData.projects);
            renderServices(appData.services);
            renderRentals(appData.rentalItems, appData.rentalCategories);
            renderAbout(appData.about, appData.settings); // About usa settings para foto perfil
            renderContact(appData.settings);
        }

        // --- 3. RENDERIZADORES ---

        function applySettings() {
            // Textos Hero
            if(appData.settings.hero_title) document.getElementById('hero-title').innerHTML = appData.settings.hero_title;
            if(appData.settings.hero_subtitle) document.getElementById('hero-subtitle').innerText = appData.settings.hero_subtitle;
            
            // Logos Navbar (Si hay URL en settings, úsala)
            // (Opcional, si quieres dinamizar el logo del header)
        }

        function renderPortfolio(images) {
            const container = document.getElementById('portfolio-gallery');
            if(!images || images.length === 0) {
                container.innerHTML = '<p class="text-center w-full text-gray-400">Pronto nuevas imágenes.</p>';
                return;
            }
            
            container.innerHTML = images.map(img => `
                <div class="gallery-item break-inside-avoid relative group" onclick="openLightbox('${img.imageUrl}', '${img.caption||''}')">
                    <img src="${img.imageUrl}" alt="${img.caption||'Portafolio'}" loading="lazy" class="w-full h-auto object-cover rounded-sm bg-gray-100">
                    <div class="overlay absolute inset-0 flex items-end p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-t from-black/80 to-transparent">
                        <p class="text-white text-sm font-light tracking-wide transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">${img.caption || ''}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderProjects(projects) {
            const container = document.getElementById('projects-container');
            if(!projects || projects.length === 0) return;

            container.innerHTML = projects.filter(p => p.status !== 'hidden').map((p, idx) => {
                const isEven = idx % 2 === 0;
                // Usamos coverImageUrl que ya viene procesada del backend
                const imgUrl = p.coverImageUrl || 'https://placehold.co/800x600?text=Proyecto';
                
                return `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center reveal">
                    <div class="order-2 ${isEven ? 'md:order-1 md:text-right' : 'md:order-2 md:text-left'}">
                        <h3 class="text-4xl font-display mb-4 text-gray-900">${p.title}</h3>
                        <div class="w-16 h-1 bg-gray-200 mb-6 ${isEven ? 'ml-auto' : 'mr-auto'}"></div>
                        <p class="text-gray-600 leading-relaxed mb-8 font-light">${p.description || ''}</p>
                        <button onclick="openDetail('project', '${p.id}')" class="text-black text-xs font-bold uppercase tracking-[0.2em] border-b-2 border-black pb-1 hover:text-gray-600 hover:border-gray-400 transition-all">
                            Ver Proyecto
                        </button>
                    </div>
                    <div class="order-1 ${isEven ? 'md:order-2' : 'md:order-1'} overflow-hidden shadow-xl rounded-sm cursor-pointer group" onclick="openDetail('project', '${p.id}')">
                        <img src="${imgUrl}" alt="${p.title}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700 ease-out">
                    </div>
                </div>`;
            }).join('');
        }

        function renderServices(services) {
            const container = document.getElementById('services-grid');
            if(!services) return;

            container.innerHTML = services.filter(s => s.status !== 'hidden').map(s => `
                <div class="group p-8 border border-gray-100 hover:border-gray-300 transition-all duration-500 hover:shadow-lg bg-white cursor-pointer flex flex-col items-center text-center" onclick="openDetail('service', '${s.id}')">
                    <div class="w-16 h-16 mb-6 rounded-full bg-gray-50 flex items-center justify-center text-2xl text-gray-700 group-hover:bg-black group-hover:text-white transition-colors duration-300">
                        <i class="${s.iconClass || 'fas fa-star'}"></i>
                    </div>
                    <h3 class="text-2xl font-display mb-3 text-gray-900">${s.title}</h3>
                    <div class="w-8 h-px bg-gray-300 my-4 group-hover:w-16 transition-all duration-300"></div>
                    <p class="text-xs font-bold uppercase tracking-widest text-gray-400 group-hover:text-black mt-auto">Descubrir</p>
                </div>
            `).join('');
        }

        function renderRentals(items, categories) {
            // 1. Filtros
            const filterContainer = document.getElementById('rental-filters');
            const cats = categories || [];
            
            filterContainer.innerHTML = `
                <button class="rental-filter-btn active px-6 py-2 rounded-full text-sm font-bold uppercase tracking-wider transition-all bg-black text-white" onclick="filterRentals('all', this)">Todo</button>
                ${cats.map(c => `
                    <button class="rental-filter-btn px-6 py-2 rounded-full text-sm font-bold uppercase tracking-wider transition-all bg-white text-gray-500 border border-gray-200 hover:border-black hover:text-black" onclick="filterRentals('${c.id}', this)">${c.name}</button>
                `).join('')}
            `;

            // 2. Grid de Items
            const grid = document.getElementById('rental-grid');
            grid.innerHTML = items.filter(i => i.status !== 'hidden').map(item => {
                // Buscar imagen portada
                const cover = item.images && item.images.find(img => String(img.isCover).toLowerCase() === 'si');
                const imgUrl = cover ? cover.imageUrl : (item.images && item.images[0] ? item.images[0].imageUrl : 'https://placehold.co/400x300?text=Equipo');
                
                // Calcular precio con IVA si aplica
                const basePrice = parseFloat(item.pricePerDay);
                const hasTax = String(item.hasTax).toUpperCase() === 'TRUE';
                const finalPrice = hasTax ? (basePrice * 1.13) : basePrice;
                const taxLabel = hasTax ? '<span class="text-[10px] text-gray-400 ml-1">+IVI</span>' : '';

                return `
                <div class="rental-card group bg-white border border-gray-100 hover:shadow-xl transition-all duration-300" data-cat="${item.categoryId}">
                    <div class="relative overflow-hidden aspect-[4/3] bg-gray-50 cursor-pointer" onclick="openDetail('rental', '${item.id}')">
                        <img src="${imgUrl}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-display font-bold mb-2 text-gray-900">${item.name}</h3>
                        <p class="text-sm text-gray-500 line-clamp-2 mb-4 h-10">${item.description || ''}</p>
                        <div class="flex justify-between items-end border-t border-gray-100 pt-4">
                            <div class="flex flex-col">
                                <span class="text-xs text-gray-400 uppercase font-bold">Tarifa Diaria</span>
                                <span class="text-xl font-bold text-black font-mono">$${finalPrice.toFixed(2)}${taxLabel}</span>
                            </div>
                            <button onclick="addToCart('${item.id}')" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-black hover:text-white transition-colors">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        window.filterRentals = (catId, btn) => {
            document.querySelectorAll('.rental-filter-btn').forEach(b => {
                b.classList.remove('bg-black', 'text-white');
                b.classList.add('bg-white', 'text-gray-500', 'border');
            });
            btn.classList.remove('bg-white', 'text-gray-500', 'border');
            btn.classList.add('bg-black', 'text-white');

            const cards = document.querySelectorAll('.rental-card');
            cards.forEach(c => {
                if (catId === 'all' || c.dataset.cat === catId) {
                    c.style.display = 'block';
                    setTimeout(() => c.style.opacity = 1, 50);
                } else {
                    c.style.display = 'none';
                    c.style.opacity = 0;
                }
            });
        };

        function renderAbout(about, settings) {
            // Intro
            const intro = document.getElementById('about-intro');
            if (about.intro_phrase) intro.textContent = `"${about.intro_phrase}"`;
            
            // Bio completa (HTML)
            const bioContainer = document.getElementById('about-bio');
            // Combinamos Bio y Process en HTML si existen
            let contentHtml = '';
            if (about.bio) contentHtml += `<div class="mb-8">${about.bio.replace(/\n/g, '<br>')}</div>`;
            if (about.process) contentHtml += `
                <h3 class="text-2xl font-display text-black mb-4 mt-8">Mi Proceso</h3>
                <div class="pl-4 border-l-2 border-gray-200">${about.process.replace(/\n/g, '<br>')}</div>
            `;
            bioContainer.innerHTML = contentHtml || '<p>Información no disponible.</p>';

            // Imagen de Perfil
            const imgEl = document.getElementById('about-profile-img');
            // Buscamos si hay una imagen específica en ImagenesIdentidad
            const profileImg = (appData.clientLogos||[]).find(i => i.key === 'profile_pic'); // Nota: clientLogos no es el lugar, es ImagenesIdentidad.
            // Corrección: appData ya trae ImagenesIdentidad dentro de clientLogos? No, la API devuelve todo.
            // Vamos a buscar en appData.about.profile_image (si se guardó texto) o usar el endpoint de identidad.
            // Mejor estrategia: Usar lo que venga en about.profile_image (URL)
            if (about.profile_image) imgEl.src = about.profile_image;
        }

        function renderContact(settings) {
            const container = document.getElementById('contact-info');
            const mapFrame = document.getElementById('google-map');
            
            // Datos de settings
            const email = settings.contact_email || 'info@agvisual.com';
            const phone = settings.contact_phone || '';
            const ig = settings.social_instagram || '#';
            const wa = settings.social_whatsapp || '#';
            const maps = settings.social_maps;

            container.innerHTML = `
                <a href="${ig}" target="_blank" class="p-8 bg-gray-50 hover:bg-white border border-transparent hover:border-gray-200 hover:shadow-lg transition-all rounded-lg flex flex-col items-center group">
                    <i class="fab fa-instagram text-3xl mb-4 text-gray-400 group-hover:text-black transition-colors"></i>
                    <span class="font-bold text-sm uppercase tracking-widest">Instagram</span>
                </a>
                <a href="https://wa.me/${phone.replace(/\D/g,'')}" target="_blank" class="p-8 bg-gray-50 hover:bg-white border border-transparent hover:border-gray-200 hover:shadow-lg transition-all rounded-lg flex flex-col items-center group">
                    <i class="fab fa-whatsapp text-3xl mb-4 text-gray-400 group-hover:text-green-600 transition-colors"></i>
                    <span class="font-bold text-sm uppercase tracking-widest">WhatsApp</span>
                </a>
                <a href="mailto:${email}" class="p-8 bg-gray-50 hover:bg-white border border-transparent hover:border-gray-200 hover:shadow-lg transition-all rounded-lg flex flex-col items-center group">
                    <i class="fas fa-envelope text-3xl mb-4 text-gray-400 group-hover:text-black transition-colors"></i>
                    <span class="font-bold text-sm uppercase tracking-widest">Email</span>
                </a>
            `;

            if (maps) {
                // Convertir link normal a embed si es necesario (simple check)
                if (maps.includes('embed')) mapFrame.src = maps;
            }
        }

        // --- 4. DETALLES (Dynamic Pages) ---
        
        window.openDetail = (type, id) => {
            const container = document.getElementById('detail-pages-container');
            let content = '';

            // Scroll Top
            window.scrollTo(0,0);

            if (type === 'project') {
                const p = appData.projects.find(x => String(x.id) === String(id));
                if(!p) return;
                
                content = `
                <div class="fixed inset-0 z-[60] bg-white overflow-y-auto animate-fade-in">
                    <button onclick="closeDetail()" class="fixed top-6 right-6 z-50 text-black bg-white/80 backdrop-blur p-3 rounded-full hover:bg-black hover:text-white transition-all shadow-lg"><i class="fas fa-times fa-lg"></i></button>
                    
                    <div class="container mx-auto px-6 py-24 max-w-5xl">
                        <div class="text-center mb-16">
                            <p class="text-gray-400 text-xs font-bold uppercase tracking-[0.3em] mb-4">Proyecto</p>
                            <h1 class="text-5xl md:text-6xl font-display mb-6 text-gray-900">${p.title}</h1>
                            <p class="text-xl text-gray-600 max-w-2xl mx-auto font-light">${p.description}</p>
                        </div>
                        
                        <div class="columns-1 md:columns-2 gap-8 space-y-8">
                            ${(p.images||[]).sort((a,b)=>(parseInt(a.order)||99)-(parseInt(b.order)||99)).map(img => `
                                <img src="${img.imageUrl}" class="w-full h-auto rounded-sm cursor-zoom-in hover:opacity-90 transition" onclick="openLightbox('${img.imageUrl}', '${img.caption||''}')">
                            `).join('')}
                        </div>
                    </div>
                </div>`;

            } else if (type === 'service') {
                const s = appData.services.find(x => String(x.id) === String(id));
                if(!s) return;

                // Contenido HTML de bloques
                const blocksHtml = (s.contentBlocks||[]).map(b => `
                    <div class="mb-12 reveal visible">
                        <h3 class="text-2xl font-display mb-4 border-b border-gray-200 pb-2">${b.blockTitle}</h3>
                        <div class="prose text-gray-600 leading-relaxed">${b.blockContentHtml}</div>
                    </div>
                `).join('');

                content = `
                <div class="fixed inset-0 z-[60] bg-white overflow-y-auto animate-fade-in">
                    <button onclick="closeDetail()" class="fixed top-6 right-6 z-50 text-black bg-white/80 backdrop-blur p-3 rounded-full hover:bg-black hover:text-white transition-all shadow-lg"><i class="fas fa-times fa-lg"></i></button>
                    
                    <div class="h-[50vh] bg-gray-900 relative flex items-center justify-center overflow-hidden">
                        <div class="absolute inset-0 opacity-40 bg-[url('${s.images && s.images[0] ? s.images[0].imageUrl : ''}')] bg-cover bg-center"></div>
                        <div class="relative z-10 text-center text-white px-4">
                            <div class="w-20 h-20 mx-auto mb-6 bg-white/10 backdrop-blur rounded-full flex items-center justify-center text-3xl"><i class="${s.iconClass}"></i></div>
                            <h1 class="text-5xl md:text-7xl font-display">${s.title}</h1>
                        </div>
                    </div>

                    <div class="container mx-auto px-6 py-20 max-w-4xl">
                        <div class="text-lg text-gray-800 font-medium italic mb-16 text-center border-l-4 border-black pl-6 py-2 bg-gray-50">
                            ${s.introText || 'Descripción del servicio...'}
                        </div>
                        
                        ${blocksHtml}

                        <div class="mt-20">
                            <h3 class="text-2xl font-display mb-8 text-center">Galería de Muestra</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                ${(s.images||[]).map(img => `<img src="${img.imageUrl}" class="w-full h-48 object-cover rounded cursor-zoom-in hover:opacity-80 transition" onclick="openLightbox('${img.imageUrl}')">`).join('')}
                            </div>
                        </div>

                        <div class="mt-24 text-center">
                            <a href="https://wa.me/${appData.settings.contact_phone?.replace(/\D/g,'')}" target="_blank" class="inline-block bg-black text-white font-bold py-4 px-10 rounded-full hover:bg-gray-800 transition-transform hover:scale-105 shadow-lg">
                                Cotizar este Servicio
                            </a>
                        </div>
                    </div>
                </div>`;
            
            } else if (type === 'rental') {
                const item = appData.rentalItems.find(x => String(x.id) === String(id));
                if(!item) return;

                const basePrice = parseFloat(item.pricePerDay);
                const hasTax = String(item.hasTax).toUpperCase() === 'TRUE';
                const finalPrice = hasTax ? (basePrice * 1.13) : basePrice;

                content = `
                <div class="fixed inset-0 z-[60] bg-white overflow-y-auto animate-fade-in">
                    <button onclick="closeDetail()" class="fixed top-6 right-6 z-50 text-black bg-white/80 backdrop-blur p-3 rounded-full hover:bg-black hover:text-white transition-all shadow-lg"><i class="fas fa-times fa-lg"></i></button>
                    
                    <div class="container mx-auto px-6 py-24 max-w-6xl">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                            <div class="space-y-4">
                                <div class="aspect-[4/3] bg-gray-100 rounded-lg overflow-hidden relative group">
                                    <img id="rental-main-img" src="${item.images && item.images[0] ? item.images[0].imageUrl : ''}" class="w-full h-full object-contain">
                                </div>
                                <div class="flex gap-4 overflow-x-auto pb-2">
                                    ${(item.images||[]).map(img => `
                                        <img src="${img.imageUrl}" class="w-20 h-20 object-cover rounded cursor-pointer border-2 border-transparent hover:border-black transition" onclick="document.getElementById('rental-main-img').src='${img.imageUrl}'">
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="flex flex-col justify-center">
                                <p class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-2">Alquiler de Equipo</p>
                                <h1 class="text-4xl md:text-5xl font-display mb-6 text-gray-900">${item.name}</h1>
                                
                                <div class="text-3xl font-mono font-bold text-black mb-8 flex items-baseline gap-2">
                                    $${finalPrice.toFixed(2)} 
                                    <span class="text-base font-normal text-gray-500 text-sans">/ día ${hasTax?'+ IVA incl.':''}</span>
                                </div>
                                
                                <div class="prose text-gray-600 mb-10">
                                    ${item.longDescription || item.description || ''}
                                </div>

                                <button onclick="addToCart('${item.id}')" class="w-full bg-black text-white font-bold py-4 rounded hover:bg-gray-800 transition-all flex items-center justify-center gap-3">
                                    <i class="fas fa-cart-plus"></i> Agregar a la Reserva
                                </button>
                                
                                <div class="mt-8 p-4 bg-gray-50 rounded text-xs text-gray-500 flex gap-4">
                                    <div class="flex items-center gap-2"><i class="fas fa-check-circle text-green-500"></i> Verificado</div>
                                    <div class="flex items-center gap-2"><i class="fas fa-bolt text-yellow-500"></i> Entrega Rápida</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            }

            container.innerHTML = content;
            document.body.style.overflow = 'hidden'; // Bloquear scroll base
        };

        window.closeDetail = () => {
            document.getElementById('detail-pages-container').innerHTML = '';
            document.body.style.overflow = 'auto';
        };

        // --- 5. CARRITO Y LIGHTBOX ---

        window.addToCart = (itemId) => {
            const item = appData.rentalItems.find(i => String(i.id) === String(itemId));
            if(!item) return;
            
            // Check duplicado
            if(cart.some(c => c.id === item.id)) {
                alert("Este equipo ya está en tu lista de reserva.");
                return;
            }
            
            cart.push(item);
            updateCartUI();
            
            // Abrir drawer
            document.getElementById('cart-overlay').classList.remove('hidden');
            document.getElementById('cart-drawer').classList.add('visible');
        };

        function updateCartUI() {
            // Badges
            document.getElementById('cart-item-count').innerText = cart.length;
            
            const container = document.getElementById('cart-items');
            if(cart.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-10">Tu carrito está vacío.</div>';
                document.getElementById('cart-total').innerText = "$0.00";
                return;
            }

            let total = 0;
            container.innerHTML = cart.map(item => {
                const price = parseFloat(item.pricePerDay);
                const hasTax = String(item.hasTax).toUpperCase() === 'TRUE';
                const final = hasTax ? price * 1.13 : price;
                total += final;
                
                const img = item.images && item.images[0] ? item.images[0].imageUrl : '';

                return `
                <div class="flex gap-4 items-center bg-gray-50 p-3 rounded mb-2">
                    <img src="${img}" class="w-16 h-16 object-cover rounded bg-white">
                    <div class="flex-1">
                        <h4 class="font-bold text-sm">${item.name}</h4>
                        <p class="text-xs text-gray-500">$${final.toFixed(2)} / día</p>
                    </div>
                    <button onclick="removeFromCart('${item.id}')" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button>
                </div>`;
            }).join('');
            
            document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;
        }

        window.removeFromCart = (id) => {
            cart = cart.filter(c => String(c.id) !== String(id));
            updateCartUI();
        };

        // Lightbox Global
        window.openLightbox = (src, caption) => {
            const lb = document.getElementById('lightbox');
            document.getElementById('lightbox-image').src = src;
            document.getElementById('lightbox-caption').innerText = caption;
            lb.classList.remove('hidden');
            setTimeout(() => lb.classList.remove('opacity-0'), 10);
        };

        // Event Listeners UI
        document.getElementById('lightbox-close').onclick = () => {
            document.getElementById('lightbox').classList.add('opacity-0');
            setTimeout(() => document.getElementById('lightbox').classList.add('hidden'), 400);
        };
        
        // Menú Móvil
        const mobileMenu = document.getElementById('mobile-menu');
        document.getElementById('mobile-menu-button').onclick = () => mobileMenu.classList.toggle('open');
        document.querySelectorAll('.mobile-nav-link').forEach(l => l.onclick = () => mobileMenu.classList.remove('open'));

        // Carrito Drawer
        const cartOverlay = document.getElementById('cart-overlay');
        const cartDrawer = document.getElementById('cart-drawer');
        const toggleCart = () => {
            const isOpen = !cartOverlay.classList.contains('hidden');
            if(isOpen) {
                cartDrawer.classList.remove('visible');
                setTimeout(() => cartOverlay.classList.add('hidden'), 300);
            } else {
                cartOverlay.classList.remove('hidden');
                setTimeout(() => cartDrawer.classList.add('visible'), 10);
            }
        };
        document.getElementById('cart-button').onclick = toggleCart;
        document.getElementById('cart-close-btn').onclick = toggleCart;
        cartOverlay.onclick = toggleCart;

        // Navegación SPA
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = link.dataset.target;
                
                // Ocultar todas las páginas
                document.querySelectorAll('.page-container').forEach(p => p.classList.remove('page-active'));
                
                // Mostrar target
                const page = document.getElementById(target);
                if(page) {
                    page.classList.add('page-active');
                    window.scrollTo(0,0);
                    // Close mobile menu if open
                    mobileMenu.classList.remove('open');
                }
            });
        });

        // Checkout Button (WhatsApp)
        document.getElementById('checkout-btn').onclick = () => {
            if(cart.length === 0) return;
            const phone = appData.settings.contact_phone || ''; 
            const itemsList = cart.map(i => `- ${i.name}`).join('%0A');
            const total = document.getElementById('cart-total').innerText;
            const text = `Hola! Me interesa alquilar el siguiente equipo:%0A${itemsList}%0A%0AValor estimado: ${total}%0A%0AQuedo atento a la disponibilidad.`;
            window.open(`https://wa.me/${phone.replace(/\D/g,'')}?text=${text}`, '_blank');
        };

        // --- INICIO ---
        initApp();

    </script>
</body>
</html>




