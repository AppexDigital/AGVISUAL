<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Versi칩n actualizada a 12.4 -->
    <title>Ad치n G칩mez | Fot칩grafo Profesional (v12.4)</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/1a1a1a/FDFDFD?text=AG">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (ACTUALIZADO) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg-main: #FDFDFD;
            --text-dark: #1a1a1a;
            --text-light: #f8f9fa;
            --accent: #3a3a3a;
        }
        html { 
            scroll-behavior: smooth; 
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-dark);
            overflow-x: hidden;
        }
        /* TIPOGRAF칈A DE T칈TULOS ACTUALIZADA */
        h1, h2, h3, h4, .font-display { 
            font-family: 'Cormorant Garamond', serif; 
            line-height: 1.4; 
        }
        
        /* --- Arquitectura de Transici칩n (Crossfade) --- */
        .page-container { 
            display: none; 
            opacity: 0; 
            transition: opacity 0.5s ease-in-out;
        }
        .page-active { 
            display: block; 
            opacity: 1;
        }
        .page-exiting {
            display: block;
            opacity: 0;
        }
        
        /* --- Animaci칩n de carga de im치genes (Fade-in) --- */
        .reveal {
            opacity: 0;
            transition: opacity 1.2s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .reveal.visible {
            opacity: 1;
        }
        
        /* --- Indicador de carga --- */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-main);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .loader-circle {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* --- Header Din치mico Mejorado --- */
        #header {
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            padding-top: 1.5rem; 
            padding-bottom: 1.5rem;
            background-color: transparent;
        }
        #header.header-scrolled, #header.header-dark {
            padding-top: 0.5rem; 
            padding-bottom: 0.5rem;
        }
        #header.header-scrolled {
            background-color: rgba(253, 253, 253, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        #header.header-dark {
            background-color: #52525b; /* bg-zinc-700 */
            box-shadow: none;
        }
        #header.header-dark .nav-link-text, #header.header-dark #mobile-menu-button .icon-bar, #header.header-dark .social-icon, #header.header-dark #cart-button {
            color: white;
        }
         #header.header-dark .nav-link-underline {
            background-color: white;
        }
         #header.header-dark .logo-dark {
            display: none;
        }
        #header.header-dark .logo-light {
            display: block;
        }
        #header:not(.header-dark) .logo-light {
            display: none;
        }
        #header:not(.header-dark) .logo-dark {
            display: block;
        }
        
        /* --- Men칰 M칩vil Mejorado --- */
        #mobile-menu {
            background-color: rgba(253, 253, 253, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transform: translateX(100%);
            transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1);
        }
        #mobile-menu.open {
            transform: translateX(0);
        }
        .mobile-nav-link {
            font-family: 'Cormorant Garamond', serif;
            color: var(--text-dark);
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            position: relative;
        }
        .mobile-nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent);
            transition: width 0.4s ease;
        }
        .mobile-nav-link:hover::after, .mobile-nav-link.nav-active::after {
            width: 100%;
        }
        #mobile-menu-button .icon-bar {
            transition: all 0.3s ease-in-out;
        }
        #mobile-menu-button.open .icon-bar:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        #mobile-menu-button.open .icon-bar:nth-child(2) { opacity: 0; }
        #mobile-menu-button.open .icon-bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
        
        /* --- Estilo para el enlace de navegaci칩n activo --- */
        .nav-link.nav-active > .nav-link-underline {
            width: 100%;
        }

        /* --- Galer칤a Mejorada --- */
        .gallery-item { 
            cursor: pointer; 
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: relative;
            overflow: hidden;
        }
        .gallery-item:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        .gallery-item img {
            transition: transform 0.8s ease;
        }
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        .gallery-item .overlay { 
            opacity: 0; 
            transition: opacity 0.5s ease; 
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 80%);
        }
        .gallery-item:hover .overlay { 
            opacity: 1; 
        }
        .gallery-item .overlay p {
            transform: translateY(20px);
            transition: transform 0.5s ease;
        }
        .gallery-item:hover .overlay p {
            transform: translateY(0);
        }
        
        /* --- Lightbox Mejorado --- */
        #lightbox { 
            background-color: rgba(10, 10, 10, 0.95); 
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: opacity 0.4s ease-in-out;
        }
        #lightbox-image { 
            transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1); 
            transform: scale(0.9);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
        }
        #lightbox.visible #lightbox-image { 
            transform: scale(1); 
        }

        #lightbox.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        #lightbox-close {
            transition: all 0.3s ease;
        }
        #lightbox-close:hover {
            transform: rotate(90deg);
            color: #ff5252;
        }
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 101;
        }
        .lightbox-nav:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-50%) scale(1.1);
        }
        #lightbox-prev { left: 20px; }
        #lightbox-next { right: 20px; }
        
        /* --- Contacto y Mapa --- */
        .contact-icon-link { 
            background-color: #f3f4f6; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        .contact-icon-link::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background-color: var(--accent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            z-index: -1;
        }
        .contact-icon-link:hover::before {
            width: 300px;
            height: 300px;
        }
        .contact-icon-link:hover { 
            color: white; 
            transform: scale(1.1);
        }
        #google-map { 
            filter: grayscale(100%) contrast(90%) brightness(110%); 
            transition: filter 0.5s ease;
        }
        #google-map:hover { 
            filter: grayscale(0%);
        }
        
        /* --- Logos de Marcas --- */
        .client-logo {
            filter: grayscale(100%);
            opacity: 0.6;
            transition: all 0.4s ease;
        }
        .client-logo:hover {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.05);
        }
        
        /* --- Botones y Enlaces Mejorados --- */
        .btn-primary {
            position: relative;
            overflow: hidden;
            z-index: 1;
            transition: all 0.3s ease;
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
            z-index: -1;
        }
        .btn-primary:hover::before {
            left: 100%;
        }
        
        /* --- Animaci칩n de aparici칩n de texto --- */
        .text-reveal {
            position: relative;
            overflow: hidden;
        }
        .text-reveal::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-main);
            transform: translateX(0);
            transition: transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .text-reveal.revealed::after {
            transform: translateX(101%);
        }
        
        /* --- Efecto parallax suave --- */
        .parallax {
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* --- Mejoras de accesibilidad --- */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        /* --- Animaci칩n de carga de im치genes con placeholder --- */
        .img-container {
            position: relative;
            overflow: hidden;
            background-color: #f3f4f6;
        }

        /* --- Estilos para la secci칩n de Alquiler (Redise침o) --- */
        .rental-category-btn {
            padding: 0.5rem 1.5rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0; /* Cambio a esquinas cuadradas */
            transition: all 0.3s ease;
            font-weight: 500;
            white-space: nowrap; /* Evita que el texto se parta */
            flex-shrink: 0; 
        }
        .rental-category-btn.active, .rental-category-btn:hover {
            background-color: var(--text-dark);
            color: white;
            border-color: var(--text-dark);
        }
        .rental-card {
            background-color: white;
            border: 1px solid #e5e7eb; /* gray-200 */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            transform: translateY(20px);
            display: flex;
            flex-direction: column;
        }
         .rental-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .rental-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .carousel-container {
            overflow: hidden;
            position: relative;
        }
        .carousel-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .carousel-item {
            min-width: 100%;
        }
        .carousel-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0,0,0,0.4);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .carousel-container:hover .carousel-button {
            opacity: 1;
        }
        .carousel-button:hover {
            background-color: rgba(0,0,0,0.7);
        }
        .carousel-button.prev { left: 10px; }
        .carousel-button.next { right: 10px; }
        
        /* --- Estilos para la nueva secci칩n de Servicios (Reemplazo) --- */
        .service-grid-item {
            background-color: white;
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0; /* Cambio de rounded-lg a esquinas cuadradas */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }
        .service-grid-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            border-color: var(--accent);
        }
        .service-icon-wrapper {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f3f4f6; /* gray-100 */
            margin-bottom: 1.5rem;
            transition: all 0.4s ease;
        }
        .service-grid-item:hover .service-icon-wrapper {
            background-color: var(--accent);
            transform: rotate(15deg) scale(1.1);
        }
        .service-icon {
            font-size: 2rem;
            color: var(--accent);
            transition: color 0.4s ease;
        }
        .service-grid-item:hover .service-icon {
            color: white;
        }
        .service-grid-item h3 {
            margin-bottom: 0.5rem;
            transition: color 0.4s ease;
        }

        /* --- NUEVOS ESTILOS PARA EL MODAL DEL CALENDARIO --- */
        .calendar-modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            pointer-events: none;
        }
        .calendar-modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .calendar-modal-content {
            background-color: white;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .calendar-modal-overlay.visible .calendar-modal-content {
            transform: scale(1);
            opacity: 1;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .calendar-nav-btn {
            background: none;
            border: 1px solid #d1d5db;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .calendar-nav-btn:hover {
            background-color: var(--text-dark);
            color: white;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }
        .calendar-day, .calendar-day-name {
            display: flex;
            justify-content: center;
            align-items: center;
            aspect-ratio: 1 / 1;
            text-align: center;
        }
        .calendar-day-name {
            font-weight: bold;
            font-size: 0.75rem;
            color: #6b7280;
        }
        .calendar-day {
            border: none;
            background-color: transparent;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .calendar-day:not(.disabled):hover {
            background-color: #f3f4f6;
        }
        .calendar-day.disabled {
            color: #d1d5db;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        .calendar-day.selected, .calendar-day.in-range {
            background-color: var(--text-dark);
            color: white;
        }
        .booking-summary {
            background-color: #f9fafb;
            padding: 1rem;
            margin-top: 1rem;
        }

        /* --- NUEVOS ESTILOS PARA EL CARRITO DE COMPRAS --- */
        #cart-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 60;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        #cart-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #cart-drawer {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 450px;
            height: 100%;
            background-color: white;
            z-index: 70;
            transform: translateX(100%);
            transition: transform 0.6s cubic-bezier(0.76, 0, 0.24, 1);
            display: flex;
            flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.1);
        }
        #cart-drawer.visible {
            transform: translateX(0);
        }
        .cart-button { /* Clase com칰n para ambos botones de carrito */
            position: relative;
        }
        .cart-item-count { /* Clase com칰n para ambos contadores */
            position: absolute;
            top: -5px;
            right: -10px;
            background-color: var(--text-dark);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            transform: scale(0);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #cart-item-count { /* Escritorio */
            width: 20px;
            height: 20px;
            font-size: 12px;
        }
        #mobile-cart-item-count { /* M칩vil */
            width: 24px;
            height: 24px;
            font-size: 14px;
            top: -8px;
            right: -12px;
        }
        .cart-item-count.visible {
            transform: scale(1);
        }
        .cart-item-remove-btn {
            color: #9ca3af;
            transition: color 0.2s;
        }
        .cart-item-remove-btn:hover {
            color: #ef4444;
        }
        #cart-empty-state {
            display: none; /* Oculto por defecto */
        }
        
        /* --- NUEVOS ESTILOS PARA EL MODAL DE CHECKOUT --- */
        #checkout-modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            z-index: 110;
            opacity: 0;
            transition: opacity 0.4s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            pointer-events: none;
        }
        #checkout-modal-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #checkout-modal-content {
            background-color: white;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s ease;
        }
        #checkout-modal-overlay.visible #checkout-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .checkout-step {
            display: none;
        }
        .checkout-step.active {
            display: block;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--text-dark);
            box-shadow: 0 0 0 2px rgba(26,26,26,0.2);
        }
        .checkout-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
        }


        /* --- ESTILOS PARA CONTENIDO DEL EDITOR (CENTRO DE MANDO) --- */
        .rich-text-content h1, .rich-text-content h2, .rich-text-content h3 { font-family: 'Cormorant Garamond', serif; font-weight: 700; margin-top: 1.5em; margin-bottom: 0.5em; line-height: 1.2; }
        .rich-text-content h1 { font-size: 2.25rem; }
        .rich-text-content h2 { font-size: 1.875rem; }
        .rich-text-content h3 { font-size: 1.5rem; }
        .rich-text-content p { margin-bottom: 1em; line-height: 1.8; }
        .rich-text-content ul { list-style-type: disc; padding-left: 0; margin-bottom: 1em; list-style-position: inside; }
        .rich-text-content ol { list-style-type: decimal; padding-left: 0; margin-bottom: 1em; list-style-position: inside; }
        .rich-text-content li { margin-bottom: 0.5em; }
        .rich-text-content strong, .rich-text-content b { font-weight: 700; color: #000; }
        .rich-text-content em, .rich-text-content i { font-style: italic; }
        .rich-text-content u { text-decoration: underline; }
        .rich-text-content blockquote { border-left: 4px solid #ccc; padding-left: 1em; font-style: italic; color: #555; margin-left: 0; margin-right: 0; }
        .rich-text-content img { max-width: 100%; height: auto; border-radius: 4px; margin: 1em 0; }
        /* Clases de alineaci칩n est치ndar que suelen usar los editores */
        .rich-text-content .ql-align-center, .rich-text-content[style*="text-align: center"] { text-align: center; }
        .rich-text-content .ql-align-right, .rich-text-content[style*="text-align: right"] { text-align: right; }
        .rich-text-content .ql-align-justify, .rich-text-content[style*="text-align: justify"] { text-align: justify; }

        
    </style>
</head>
<body class="antialiased">
    <!-- Indicador de carga -->
    <div class="loader" id="page-loader">
        <div class="flex flex-col items-center w-3/4 max-w-xs md:max-w-md">
            <img src="https://placehold.co/200x64/ffffff/ffffff?text=..." alt="" class="w-full h-auto mb-8 logo-dark transition-opacity duration-300">
            <img src="https://placehold.co/200x64/ffffff/ffffff?text=..." alt="" class="w-full h-auto mb-8 logo-light" style="display: none;">
            <div class="loader-circle"></div>
        </div>
    </div>
    
    <!-- ===== HEADER ===== -->
    <header id="header" class="fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="#" data-target="portfolio" class="nav-link relative group">
                <img src="https://placehold.co/350x144/ffffff/ffffff?text=AG" alt="" class="w-40 lg:w-[250px] h-auto transition-all duration-300 group-hover:scale-105 logo-dark">
                <img src="https://placehold.co/350x144/ffffff/ffffff?text=AG" alt="" class="w-40 lg:w-[250px] h-auto transition-all duration-300 group-hover:scale-105 logo-light" style="display: none;">
            </a>

            <div class="flex items-center">
                <nav class="hidden lg:flex items-center space-x-8 text-sm uppercase tracking-widest">
                    <a href="#" data-target="portfolio" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Portafolio</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="projects" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Proyectos</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="services" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Servicios</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="rental" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Alquiler</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="about" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Qui칠n Soy</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="#" data-target="contact" class="nav-link hover:text-gray-500 transition-colors relative group">
                        <span class="nav-link-text">Contacto</span>
                        <span class="nav-link-underline absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </nav>

                <div class="hidden lg:flex items-center space-x-4 ml-8">
                    <a href="#" aria-label="WhatsApp" class="social-icon text-gray-700 hover:text-black transition-colors"><i class="fab fa-whatsapp fa-lg"></i></a>
                    <a href="#" aria-label="Instagram" class="social-icon text-gray-700 hover:text-black transition-colors"><i class="fab fa-instagram fa-lg"></i></a>
                    <a href="#" aria-label="YouTube" class="social-icon text-gray-700 hover:text-black transition-colors"><i class="fab fa-youtube fa-lg"></i></a>
                    <button id="cart-button" aria-label="Ver carrito de compras" class="cart-button social-icon text-gray-700 hover:text-black transition-colors ml-2">
                        <i class="fas fa-shopping-bag fa-lg"></i>
                        <span id="cart-item-count" class="cart-item-count">0</span>
                    </button>
                </div>

                <button id="mobile-menu-button" class="lg:hidden z-50 w-8 h-6 flex flex-col justify-between ml-6" aria-label="Men칰 m칩vil" aria-expanded="false">
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                    <span class="block w-full h-0.5 bg-black icon-bar"></span>
                </button>
            </div>
        </div>
    </header>
    <!-- Men칰 M칩vil Overlay (Redise침ado) -->
    <div id="mobile-menu" class="fixed top-0 right-0 w-full h-full z-40 lg:hidden flex flex-col" aria-hidden="true">
        <nav class="flex flex-col justify-center items-center h-full space-y-8 text-3xl flex-grow">
            <a href="#" data-target="portfolio" class="nav-link mobile-nav-link uppercase">Portafolio</a>
            <a href="#" data-target="projects" class="nav-link mobile-nav-link uppercase">Proyectos</a>
            <a href="#" data-target="services" class="nav-link mobile-nav-link uppercase">Servicios</a>
            <a href="#" data-target="rental" class="nav-link mobile-nav-link uppercase">Alquiler</a>
            <a href="#" data-target="about" class="nav-link mobile-nav-link uppercase">Qui칠n Soy</a>
            <a href="#" data-target="contact" class="nav-link mobile-nav-link uppercase">Contacto</a>
        </nav>
        <div class="flex justify-center items-center space-x-8 pb-12">
            <a href="#" aria-label="WhatsApp" class="text-gray-700 hover:text-black transition-colors"><i class="fab fa-whatsapp fa-2x"></i></a>
            <a href="#" aria-label="Instagram" class="text-gray-700 hover:text-black transition-colors"><i class="fab fa-instagram fa-2x"></i></a>
            <a href="#" aria-label="YouTube" class="text-gray-700 hover:text-black transition-colors"><i class="fab fa-youtube fa-2x"></i></a>
            <button id="mobile-cart-button" aria-label="Ver carrito de compras" class="cart-button text-gray-700 hover:text-black transition-colors">
                <i class="fas fa-shopping-bag fa-2x"></i>
                <span id="mobile-cart-item-count" class="cart-item-count">0</span>
            </button>
        </div>
    </div>
    <main id="main-content">
        <!-- ===== PORTFOLIO PAGE ===== -->
        <section id="portfolio" class="page-container pt-28 md:pt-36 pb-0" aria-label="Portafolio">
            <div class="container mx-auto px-4 sm:px-6">
                <!-- El contenedor de la galer칤a ahora es el elemento principal -->
                <div class="reveal">
                    <div id="portfolio-gallery" class="columns-2 sm:columns-3 lg:columns-4 gap-6 space-y-6">
                        <!-- Las ~200 im치genes se insertan aqu칤 desde JS -->
                    </div>
                </div>
            </div>

            <div class="bg-zinc-700 text-white py-20 mt-24 reveal">
                <div class="container mx-auto px-6">
                    <div id="videos-container" class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                        </div>
                </div>
            </div>

            <div class="bg-gray-100 py-20 reveal">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                         <h2 class="text-4xl font-display text-gray-800 text-reveal">Confianza y Colaboraci칩n</h2>
                    </div>
                    <div id="client-logos-container" class="flex justify-center items-center flex-wrap gap-x-12 gap-y-8 max-w-4xl mx-auto min-h-[100px]">
                        </div>
                </div>
            </div>
            
            <div class="bg-gray-100 pt-12 pb-24 reveal">
                <div class="container mx-auto px-6 text-center">
                     <div class="text-center mb-12">
                        <h2 class="text-4xl font-display text-gray-800 text-reveal py-2">쯃isto para el Siguiente Paso?</h2>
                        <p class="text-lg text-gray-600 mt-2 text-reveal">Explora mis proyectos o cont치ctame para empezar a crear.</p>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                        <a href="#" data-target="projects" class="nav-link btn-primary inline-block bg-black text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-gray-800 transition-transform hover:scale-105 w-full sm:w-auto">Explorar Proyectos</a>
                        <a href="#" data-target="contact" class="nav-link btn-primary inline-block bg-zinc-700 text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-zinc-800 transition-transform hover:scale-105 w-full sm:w-auto">Contactar Ahora</a>
                    </div>
                </div>
            </div>
        </section>
        <!-- ===== PROJECTS PAGE ===== -->
        <section id="projects" class="page-container pt-28 md:pt-36 pb-20 md:pb-24 bg-gray-50" aria-label="Proyectos">
            <div class="container mx-auto px-4 md:px-12">
                <div id="projects-container" class="space-y-20">
                    <!-- Los 7 proyectos se insertan aqu칤 desde JS -->
                </div>
                <div class="text-center mt-24 reveal">
                     <h3 class="text-3xl font-display text-gray-800 text-reveal">쯃isto para crear tu propia historia?</h3>
                    <a href="#" data-target="services" class="nav-link btn-primary mt-8 inline-block bg-black text-white font-bold py-4 px-10 rounded-full text-lg hover:bg-gray-800 transition-transform hover:scale-105">Descubre mis Servicios</a>
                </div>
            </div>
        </section>
        <!-- ===== SERVICES PAGE (REDESIGNED) ===== -->
        <section id="services" class="page-container pt-28 md:pt-36 pb-20 md:pb-24" aria-label="Servicios">
            <div class="container mx-auto px-6">
                <div id="services-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto reveal">
                    <!-- Los servicios se insertan aqu칤 desde JS -->
                </div>
            </div>
        </section>
        <!-- ===== RENTAL PAGE (REDESIGNED) ===== -->
        <section id="rental" class="page-container pt-28 md:pt-36 pb-20 md:pb-24 bg-white" aria-label="Alquiler de Equipo">
            <div class="container mx-auto px-6">
                <div id="rental-filters-wrapper" class="reveal mb-12">
                    <div id="rental-filters" class="flex justify-center flex-wrap gap-4">
                        <!-- Filtros de categor칤a se insertan aqu칤 -->
                    </div>
                </div>
                <div id="rental-grid-categorized" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Las tarjetas de alquiler se insertan aqu칤 -->
                </div>
            </div>
        </section>
        <!-- ===== ABOUT ME PAGE (REDESIGNED) ===== -->
        <section id="about" class="page-container pt-24 md:pt-32 pb-20 md:pb-24 bg-gray-50" aria-label="Sobre m칤">
            <div class="container mx-auto px-6">
                <div class="max-w-4xl mx-auto">
                    <div class="text-center reveal">
                        <div class="relative inline-block">
                            <img src="https://placehold.co/288x288/cccccc/999999?text=Cargando..." alt="" class="shadow-xl w-72 h-72 mx-auto mb-8 object-cover transition-opacity duration-500">
                            <div class="absolute inset-0 border-4 border-white border-opacity-30 animate-ping"></div>
                        </div>
                        <p id="about-intro-phrase" class="text-xl text-gray-700 leading-relaxed max-w-2xl mx-auto italic text-reveal mt-8">"No hago fotos para vivir, vivo para hacer fotos. Mi c치mara no es una herramienta, es una extensi칩n de mi curiosidad por el mundo y las historias que la gente tiene que contar."</p>
                    </div>
                    <div class="prose max-w-none lg:prose-lg mx-auto mt-16 text-gray-600 leading-relaxed space-y-8 reveal text-justify">
                        <h3 class="text-3xl font-display text-black !mb-4 text-reveal">Mi Filosof칤a</h3>
                        <div id="about-bio" class="text-reveal space-y-4">
                            <p>Hola, soy Ad치n G칩mez. Desde que tom칠...</p>
                        </div>
                        
                        <h3 class="text-3xl font-display text-black !mt-16 !mb-4 text-reveal">Mi Proceso Creativo</h3>
                        <div id="about-process" class="text-reveal space-y-4">
                            <p>Cada proyecto es un viaje colaborativo...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ===== CONTACT PAGE (REDESIGNED) ===== -->
        <section id="contact" class="page-container pt-28 md:pt-36" aria-label="Contacto">
             <div class="container mx-auto px-6 pb-20 md:pb-24">
                <div class="max-w-3xl mx-auto grid grid-cols-2 md:grid-cols-3 gap-6 text-center reveal">
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-instagram fa-3x mb-3"></i>
                        <span class="font-bold">Instagram</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-whatsapp fa-3x mb-3"></i>
                        <span class="font-bold">WhatsApp</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fas fa-envelope fa-3x mb-3"></i>
                        <span class="font-bold">Email</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-facebook-f fa-3x mb-3"></i>
                        <span class="font-bold">Facebook</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fab fa-youtube fa-3x mb-3"></i>
                        <span class="font-bold">Youtube</span>
                    </a>
                    <a href="#" class="contact-icon-link p-8 flex flex-col items-center justify-center">
                        <i class="fas fa-phone fa-3x mb-3"></i>
                        <span class="font-bold">Tel칠fono</span>
                    </a>
                </div>
            </div>
            <div class="container mx-auto px-6 text-center mb-12 reveal">
                <h2 class="text-4xl font-display text-gray-800 text-reveal">Mi Estudio</h2>
                <p class="text-lg text-gray-600 mt-2 text-reveal">Ubicado en el coraz칩n de Coronado, listo para dar vida a tu proyecto.</p>
             </div>
            <div class="reveal">
                <iframe id="google-map" src="https://www.google.com/maps/embed?pb=!1m18!m12!1m3!1d31431.83101261831!2d-84.0101680513672!3d10.023880900000004!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8fa0f3c43dd70743%3A0x18258b381d58552a!2sV%C3%A1squez%20de%20Coronado!5e0!3m2!1ses-419!2scr!4v1722547858413!5m2!1ses-419!2scr" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </section>
        <!-- PROJECT DETAIL PAGES CONTAINER -->
        <div id="project-detail-pages"></div>
        <!-- RENTAL DETAIL PAGES CONTAINER -->
        <div id="rental-detail-pages"></div>
        <!-- SERVICE DETAIL PAGES CONTAINER -->
        <div id="service-detail-pages"></div>
    </main>
    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 z-[100] flex items-center justify-center hidden opacity-0" role="dialog" aria-modal="true" aria-label="Vista ampliada de imagen">
        <button id="lightbox-close" class="absolute top-6 right-6 text-white text-5xl font-light hover:opacity-75 transition-opacity" aria-label="Cerrar vista ampliada">칑</button>
        <button id="lightbox-prev" class="lightbox-nav" aria-label="Imagen anterior">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button id="lightbox-next" class="lightbox-nav" aria-label="Imagen siguiente">
            <i class="fas fa-chevron-right"></i>
        </button>
        <div class="text-white text-center absolute bottom-6 left-0 right-0">
            <p id="lightbox-caption" class="text-lg"></p>
        </div>
        <img id="lightbox-image" src="" alt="Vista ampliada" class="max-w-[90vw] max-h-[85vh] shadow-2xl">
    </div>

    <!-- Contenedor del Modal del Calendario (se a침ade al final del body) -->
    <div id="calendar-modal-container"></div>
    
    <!-- NUEVA ESTRUCTURA DEL CARRITO -->
    <div id="cart-overlay"></div>
    <aside id="cart-drawer" aria-labelledby="cart-heading">
        <div class="p-6 border-b flex justify-between items-center">
            <h2 id="cart-heading" class="text-2xl font-display">Tu Carrito de Alquiler</h2>
            <button id="cart-close-btn" class="text-2xl text-gray-500 hover:text-black">&times;</button>
        </div>
        <div id="cart-items-container" class="flex-grow overflow-y-auto p-6">
            <!-- Los art칤culos del carrito se renderizar치n aqu칤 -->
            <div id="cart-empty-state" class="text-center p-8 flex flex-col items-center justify-center h-full">
                <i class="fas fa-camera-retro text-5xl text-gray-300 mb-6"></i>
                <h3 class="font-display text-2xl mb-2">Tu carrito est치 vac칤o</h3>
                <p class="text-gray-500 mb-8 max-w-xs">Parece que a칰n no has a침adido equipo. 춰Explora nuestro cat치logo!</p>
                <a href="#" data-target="rental" class="nav-link btn-primary inline-block bg-black text-white font-bold py-3 px-8 rounded-full hover:bg-gray-800">
                    Explorar Equipo
                </a>
            </div>
        </div>
        <div class="p-6 border-t bg-gray-50">
            <div class="flex justify-between items-center font-bold text-lg mb-4">
                <span>Subtotal:</span>
                <span id="cart-subtotal">$0.00</span>
            </div>
            <button id="checkout-btn" class="w-full bg-black text-white py-4 font-bold hover:bg-gray-800 transition-colors disabled:bg-gray-300">Finalizar Reserva</button>
        </div>
    </aside>
    
    <!-- NUEVA ESTRUCTURA PARA EL MODAL DE CHECKOUT -->
    <div id="checkout-modal-container"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
        
            // =================================================================
            // 1. VARIABLES GLOBALES Y MEMORIA
            // =================================================================
            let globalData = {
                portfolio: [],
                videos: [],
                logos: [],
                allProjectImages: [], 
                projects: [],         
                services: [],         
                rentals: { items: [], categories: [], dates: [] } 
            };
            let rentalDataGlobal = {}; 
            let cart = [];
            
            // Lightbox vars
            let lightboxImages = [];
            let currentLbIndex = 0;
    
            // =================================================================
            // 2. SELECTORES DEL DOM (DEFINIDOS PRIMERO - VITAL)
            // =================================================================
            const header = document.getElementById('header');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const allNavLinks = document.querySelectorAll('.nav-link');
            const pageLoader = document.getElementById('page-loader');
            
            // Lightbox Elements
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxCaption = document.getElementById('lightbox-caption');
            const lightboxClose = document.getElementById('lightbox-close');
            const lightboxPrev = document.getElementById('lightbox-prev');
            const lightboxNext = document.getElementById('lightbox-next');
            
            // Carrito Elements
            const cartButton = document.getElementById('cart-button');
            const mobileCartButton = document.getElementById('mobile-cart-button');
            const cartItemCount = document.getElementById('cart-item-count');
            const mobileCartItemCount = document.getElementById('mobile-cart-item-count');
            const cartOverlay = document.getElementById('cart-overlay');
            const cartDrawer = document.getElementById('cart-drawer');
            const cartCloseBtn = document.getElementById('cart-close-btn');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartEmptyState = document.getElementById('cart-empty-state');
            const cartSubtotalEl = document.getElementById('cart-subtotal');
            const checkoutBtn = document.getElementById('checkout-btn');
    
            // =================================================================
            // 3. API FETCH (CONEXI칍N SEGURA)
            // =================================================================
            const fetchSectionData = async (section) => {
                try {
                    // console.log(`游니 Descargando: ${section}...`); 
                    const res = await fetch(`/.netlify/functions/get-website-data?section=${section}`);
                    if (!res.ok) throw new Error('Error API');
                    return await res.json();
                } catch (e) {
                    console.warn(`Esperando datos para ${section}...`);
                    return null;
                }
            };

            // --- HELPER: EXPANDIR RANGOS DE FECHAS ---
            // Toma una fecha de inicio y fin, y devuelve una lista de todos los d칤as intermedios.
            const getDatesInRange = (startDate, endDate) => {
                const date = new Date(startDate + 'T00:00:00');
                const end = new Date(endDate + 'T00:00:00');
                const dates = [];
                while (date <= end) {
                    dates.push(new Date(date).toISOString().split('T')[0]);
                    date.setDate(date.getDate() + 1);
                }
                return dates;
            };
            
    
            // =================================================================
            // 4. FUNCIONES DE INTERFAZ (UI)
            // =================================================================
            const handleScrollHeader = () => {
                const isServicePage = !!document.querySelector('.page-active[id^="service-detail-"]');
                if (window.scrollY > 50) {
                    header.classList.add('header-scrolled'); header.classList.remove('header-dark'); 
                } else { 
                    header.classList.remove('header-scrolled');
                    if (isServicePage) header.classList.add('header-dark');
                    else header.classList.remove('header-dark');
                }
            };
    
            const toggleMobileMenu = (forceState) => {
                const isOpen = typeof forceState === 'boolean' ? forceState : !mobileMenu.classList.contains('open');
                
                mobileMenu.classList.toggle('open', isOpen);
                mobileMenuButton.classList.toggle('open', isOpen);
                mobileMenuButton.setAttribute('aria-expanded', isOpen);
    
                // RESTAURADO: Bucle que hace aparecer los textos uno por uno
                const links = mobileMenu.querySelectorAll('.mobile-nav-link');
                links.forEach((link, index) => {
                    if (isOpen) {
                        // Entrada: Retraso escalonado
                        setTimeout(() => {
                            link.style.opacity = '1';
                            link.style.transform = 'translateY(0)';
                        }, 150 + (index * 50));
                    } else {
                        // Salida: Reset inmediato
                        link.style.opacity = '0';
                        link.style.transform = 'translateY(30px)';
                    }
                });
            };
    
            const toggleCart = (show) => {
                if (show) {
                    cartOverlay.classList.add('visible');
                    cartDrawer.classList.add('visible');
                } else {
                    cartOverlay.classList.remove('visible');
                    cartDrawer.classList.remove('visible');
                }
            };
    
            const updateCartIcon = () => {
                const count = cart.length;
                if(cartItemCount) { cartItemCount.textContent = count; cartItemCount.classList.toggle('visible', count > 0); }
                if(mobileCartItemCount) { mobileCartItemCount.textContent = count; mobileCartItemCount.classList.toggle('visible', count > 0); }
            };
    
            const observeElements = (container) => {
                if(!container) return;
                const revealObserver = new IntersectionObserver((entries, obs) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                            obs.unobserve(entry.target);
                            entry.target.querySelectorAll('.text-reveal').forEach(el => setTimeout(() => el.classList.add('revealed'), 200));
                        }
                    });
                }, { threshold: 0.1 });
                container.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));
            };
    
            // --- Lightbox Logic ---
            const openLightbox = (src, caption, imagesArr, index) => {
                lightboxImages = imagesArr; currentLbIndex = index;
                lightboxImage.src = src; 
                if(lightboxCaption) lightboxCaption.textContent = caption;
                
                const hasMultiple = imagesArr.length > 1;
                if(lightboxPrev) lightboxPrev.style.display = hasMultiple ? 'flex' : 'none';
                if(lightboxNext) lightboxNext.style.display = hasMultiple ? 'flex' : 'none';
                
                lightbox.classList.remove('hidden');
                setTimeout(() => lightbox.classList.add('visible'), 10);
            };
    
            const navigateLightbox = (dir) => {
                if(lightboxImages.length < 2) return;
                currentLbIndex = (dir === 'next') 
                    ? (currentLbIndex + 1) % lightboxImages.length 
                    : (currentLbIndex - 1 + lightboxImages.length) % lightboxImages.length;
                
                lightboxImage.style.opacity = '0';
                setTimeout(() => {
                    lightboxImage.src = lightboxImages[currentLbIndex].src;
                    if(lightboxCaption) lightboxCaption.textContent = lightboxImages[currentLbIndex].title;
                    lightboxImage.style.opacity = '1';
                }, 200);
            };
    
            const closeLightbox = () => {
                lightbox.classList.remove('visible');
                setTimeout(() => { lightbox.classList.add('hidden'); lightboxImage.src = ''; }, 300);
            };
    
            // =================================================================
            // 5. RENDERIZADORES (PINTAR HTML)
            // =================================================================
            
            const renderCart = () => {
                if(!cartItemsContainer) return;
                const items = cartItemsContainer.querySelectorAll('.cart-item');
                items.forEach(item => item.remove());
    
                if (cart.length === 0) {
                    if(cartEmptyState) cartEmptyState.style.display = 'flex';
                    if(checkoutBtn) checkoutBtn.disabled = true;
                } else {
                    if(cartEmptyState) cartEmptyState.style.display = 'none';
                    if(checkoutBtn) checkoutBtn.disabled = false;
                    cart.forEach(item => {
                        const el = document.createElement('div');
                        el.className = 'cart-item flex items-start space-x-4 py-4 border-b';
                        el.innerHTML = `
                            <img src="${item.image}" class="w-20 h-20 object-cover">
                            <div class="flex-grow">
                                <h4 class="font-bold">${item.name}</h4>
                                <p class="text-sm text-gray-500">${new Date(item.startDate+'T00:00:00').toLocaleDateString()} - ${new Date(item.endDate+'T00:00:00').toLocaleDateString()}</p>
                                <p class="text-sm text-gray-500">${item.totalDays} d칤as</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">$${(item.price * item.totalDays).toFixed(2)}</p>
                                <button class="cart-item-remove-btn text-sm mt-2" data-cart-id="${item.cartId}"><i class="fas fa-trash-alt mr-1"></i> Eliminar</button>
                            </div>`;
                        cartItemsContainer.appendChild(el);
                    });
                }
                const total = cart.reduce((t, i) => t + (i.price * i.totalDays), 0);
                if(cartSubtotalEl) cartSubtotalEl.textContent = `$${total.toFixed(2)}`;
            };
    
            const addToCart = (item, startDate, endDate) => {
                const totalDays = Math.ceil(Math.abs(new Date(endDate) - new Date(startDate)) / (86400000)) + 1;
                const cartId = `${item.id}-${startDate}`; 
                
                if (cart.some(cartItem => cartItem.cartId === cartId)) {
                    alert('Este art칤culo ya est치 en tu carrito para estas fechas.');
                    return;
                }
    
                // CORRECCI칍N: Extraemos expl칤citamente .imageUrl del primer objeto del array
                const firstImageObj = (item.images && item.images.length > 0) ? item.images[0] : null;
                const thumbUrl = firstImageObj ? firstImageObj.imageUrl : 'https://placehold.co/100?text=Sin+Foto';
    
                cart.push({ 
                    ...item, 
                    cartId: cartId, 
                    startDate: startDate, 
                    endDate: endDate, 
                    totalDays: totalDays, 
                    image: thumbUrl // Ahora s칤 es un string (URL), no un objeto
                });

            renderCart(); 
            updateCartIcon(); 
            toggleCart(true);
        };;
    
            const renderPortfolio = () => {
                const gallery = document.getElementById('portfolio-gallery');
                if(!gallery) return;
                if (globalData.portfolio.length === 0) { gallery.innerHTML = '<p class="text-center col-span-full text-gray-400 py-10">Cargando portafolio...</p>'; return; }
                gallery.innerHTML = globalData.portfolio.map(item => `
                    <div class="gallery-item break-inside-avoid overflow-hidden relative img-container mb-6">
                        <img src="${item.imageUrl}" alt="${item.caption || 'Foto'}" loading="lazy" class="w-full h-auto object-cover hover:scale-105 transition-transform duration-700">
                        <div class="overlay absolute inset-0 flex items-end p-4 bg-gradient-to-t from-black/60 to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-lg font-bold translate-y-4 transition-transform duration-300">${item.caption || ''}</p>
                        </div>
                    </div>`).join('');
            };
    
            const renderVideos = (list) => {
                const container = document.getElementById('videos-container');
                if(!container) return;
                if (!list || list.length === 0) { container.parentElement.parentElement.style.display = 'none'; return; }
                container.innerHTML = list.map(v => {
                    let src = v.embedUrl || "";
                    if (src.includes('watch?v=')) src = src.replace('watch?v=', 'embed/');
                    else if (src.includes('youtu.be/')) src = src.replace('youtu.be/', 'www.youtube.com/embed/');
                    return `<div class="w-full aspect-video overflow-hidden shadow-lg gallery-item group bg-black rounded-none border border-gray-800 relative"><iframe src="${src}" title="${v.title}" class="w-full h-full object-cover" allowfullscreen></iframe></div>`;
                }).join('');
            };
    
            const renderClientLogos = (list) => {
                const container = document.getElementById('client-logos-container');
                if(!container) return;
                if (!list || list.length === 0) { container.innerHTML = ''; return; }
                container.innerHTML = list.map(l => `<img src="${l.logoUrl}" alt="Cliente" class="client-logo h-24 md:h-32 w-auto object-contain transition-all duration-300 grayscale hover:grayscale-0 opacity-70 hover:opacity-100 hover:scale-110">`).join('');
            };
    
            const renderProjects = () => {
                const container = document.getElementById('projects-container');
                if(!container) return;
                container.style.display = 'block';
                
                if (globalData.projects.length === 0) { container.innerHTML = '<div class="text-center py-20"><div class="loader-circle mx-auto mb-4"></div><p class="text-gray-400">Cargando proyectos...</p></div>'; return; }
                container.innerHTML = globalData.projects.map((p, i) => `
                    <div class="grid grid-cols-1 md:grid-cols-2 items-center reveal gap-8 md:gap-12">
                        <div class="p-4 md:p-8 ${i % 2 === 0 ? 'md:text-right' : 'md:order-last md:text-left'}">
                            <h3 class="text-3xl md:text-4xl font-display mb-4 text-reveal">${p.title}</h3>
                            <p class="text-gray-600 leading-relaxed mb-6 text-reveal line-clamp-3">${p.description}</p>
                            <a href="#" data-target="project-detail-${p.id}" class="nav-link text-black font-bold uppercase tracking-widest text-sm group inline-block border-b-2 border-black pb-1 hover:text-gray-600 hover:border-gray-600 transition-all">Ver Galer칤a Completa</a>
                        </div>
                        <div class="overflow-hidden gallery-item img-container h-64 md:h-96 shadow-lg"><img src="${p.coverImageUrl || 'https://placehold.co/600'}" alt="${p.title}" class="w-full h-full object-cover"></div>
                    </div>`).join('');

                    observeElements(container);
            };
    
            const renderServicesGrid = () => {
                const container = document.getElementById('services-grid');
                if(!container) return;
                if (globalData.services.length === 0) { container.innerHTML = '<div class="col-span-full text-center py-10 text-gray-400">Cargando servicios...</div>'; return; }
                container.innerHTML = globalData.services.map(s => `
                    <a href="#" data-target="service-detail-${s.id}" class="nav-link service-grid-item items-center justify-center text-center py-12">
                        <div class="service-icon-wrapper"><i class="${s.iconClass || 'fas fa-camera'} service-icon"></i></div>
                        <h3 class="text-2xl font-display text-gray-900">${s.title}</h3>
                    </a>`).join('');
            };
    
            const renderRentalPage = () => {
                const filtersContainer = document.getElementById('rental-filters');
                const gridContainer = document.getElementById('rental-grid-categorized');
                if (!filtersContainer || !gridContainer) return;
                if (globalData.rentals.categories.length === 0) { gridContainer.innerHTML = '<p class="text-center col-span-full text-gray-400">Cargando equipos...</p>'; return; }
    
                const cats = globalData.rentals.categories;
                filtersContainer.innerHTML = `<button class="rental-category-btn active" data-category="Todo">Todo</button>` + 
                    cats.map(c => `<button class="rental-category-btn" data-category="${c.id}">${c.name}</button>`).join('');
    
                const renderItems = (catId) => {
                    let items = globalData.rentals.items;
                    if(catId !== 'Todo') items = items.filter(i => i.categoryId === catId);
                    
                    gridContainer.innerHTML = items.map(item => {
                        const imgs = item.images || [];
                        return `
                        <div class="rental-card reveal">
                             <div class="carousel-container aspect-w-4 aspect-h-3">
                                <div class="carousel-track flex" data-current-index="0">${imgs.length ? imgs.map(img => `<div class="carousel-item flex-shrink-0 w-full"><img src="${img.imageUrl}" alt="${item.name}" class="w-full h-full object-cover"></div>`).join('') : '<div class="w-full h-full bg-gray-200"></div>'}</div>
                                ${imgs.length > 1 ? '<button class="carousel-button prev rental-carousel-button" data-direction="-1"><i class="fas fa-chevron-left"></i></button><button class="carousel-button next rental-carousel-button" data-direction="1"><i class="fas fa-chevron-right"></i></button>' : ''}
                            </div>
                            <div class="p-6 flex flex-col flex-grow">
                                <div class="flex justify-between items-baseline"><h3 class="font-display text-2xl">${item.name}</h3><p class="font-bold text-xl">$${item.pricePerDay}<span class="text-sm font-normal">/d칤a</span></p></div>
                                <p class="text-gray-600 text-sm my-4 flex-grow line-clamp-3">${item.description}</p>
                                <a href="#" data-target="rental-detail-${item.id}" class="nav-link text-sm font-bold text-black uppercase tracking-wider group mt-auto">Ver Detalles <span class="block max-w-0 group-hover:max-w-full transition-all duration-500 h-0.5 bg-black"></span></a>
                            </div>
                        </div>`;
                    }).join('');
                    observeElements(gridContainer);
                };
                
                // Listeners locales
                filtersContainer.onclick = (e) => { 
                    if (e.target.matches('.rental-category-btn')) { 
                        filtersContainer.querySelector('.active').classList.remove('active'); e.target.classList.add('active'); renderItems(e.target.dataset.category); 
                    }
                };
                gridContainer.onclick = (e) => { 
                    const btn = e.target.closest('.rental-carousel-button');
                    if(btn) { 
                        e.preventDefault(); e.stopPropagation(); 
                        const track = btn.closest('.carousel-container').querySelector('.carousel-track');
                        const slides = Array.from(track.children);
                        let idx = parseInt(track.dataset.currentIndex || 0);
                        idx = (idx + parseInt(btn.dataset.direction) + slides.length) % slides.length;
                        track.style.transform = `translateX(-${idx * 100}%)`;
                        track.dataset.currentIndex = idx;
                    }
                };
                renderItems('Todo');
            };
    
            const renderProjectDetail = (targetId) => {
                const realId = targetId.substring(15);
                const project = globalData.projects.find(p => String(p.id) === realId);
                if (!project) return;
                
                const container = document.getElementById('project-detail-pages');
                container.innerHTML = `
                    <section id="${targetId}" class="page-container pt-32 md:pt-40 pb-20 md:pb-24 bg-white">
                        <div class="container mx-auto px-6"><div class="max-w-6xl mx-auto">
                            <a href="#" data-target="projects" class="nav-link text-gray-500 hover:text-black transition-colors mb-8 inline-flex items-center gap-2"><i class="fas fa-arrow-left"></i> Volver a Proyectos</a>
                            <div class="text-center mb-16 reveal"><h2 class="text-4xl md:text-6xl font-display text-reveal mb-4">${project.title}</h2><p class="text-lg text-gray-600 mt-4 max-w-3xl mx-auto text-reveal text-center">${project.description}</p></div>
                            <div class="columns-1 sm:columns-2 lg:columns-3 gap-6 space-y-6 reveal">
                                ${(project.images||[]).map(img => `
                                    <div class="gallery-item break-inside-avoid overflow-hidden relative img-container mb-6 group">
                                        <img src="${img.imageUrl}" loading="lazy" class="w-full h-auto object-cover shadow-sm transition-transform duration-500 group-hover:scale-105">
                                        ${img.caption ? `<div class="absolute bottom-0 left-0 w-full p-2 bg-black/50 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">${img.caption}</div>` : ''}
                                    </div>`).join('')}
                            </div>
                        </div></div>
                    </section>`;
                
                // IMPORTANTE: Eliminamos la l칤nea 'navigateTo(targetId);' que causaba el bucle.
                // Solo necesitamos activar la p치gina manualmente si no est치 activa.
                const page = document.getElementById(targetId);
                if(page && !page.classList.contains('page-active')) {
                    document.querySelectorAll('.page-active').forEach(p => { p.classList.remove('page-active'); p.style.display='none'; });
                    page.style.display='block';
                    setTimeout(()=>page.classList.add('page-active'), 10);
                    window.scrollTo(0,0);
                }
            };
    
            const renderServiceDetail = (targetId) => {
                const realId = targetId.substring(15);
                const service = globalData.services.find(s => String(s.id) === realId);
                if (!service) return;
                
                const container = document.getElementById('service-detail-pages');
                container.innerHTML = `
                    <section id="${targetId}" class="page-container">
                         <div class="h-auto md:h-[60vh] bg-zinc-700 flex items-center justify-center text-white pt-28 md:pt-36 pb-16">
                            <div class="text-center reveal"><h1 class="text-5xl md:text-7xl font-display text-reveal py-2">${service.title}</h1></div>
                        </div>
                        <div class="container mx-auto px-6 py-20 md:py-24">
                            <div class="max-w-4xl mx-auto">
                                <a href="#" data-target="services" class="nav-link text-gray-500 hover:text-black transition-colors mb-12 inline-block"><i class="fas fa-arrow-left mr-2"></i> Volver a Servicios</a>
                                
                                <div class="reveal mt-6 mb-6">
                                    <div class="rich-text-content text-xl text-gray-700 leading-relaxed text-reveal">
                                        ${service.introText || ''}
                                    </div>
                                </div>
    
                                <div class="space-y-6">
                                    ${(service.contentBlocks||[]).map(b => `
                                        <div class="reveal">
                                            <h3 class="text-3xl font-display text-black mb-2 text-reveal">${b.blockTitle}</h3>
                                            <div class="rich-text-content text-gray-600 text-lg leading-relaxed text-reveal">
                                                ${b.blockContentHtml}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
    
                                ${(service.images||[]).length ? `<div class="mt-12 reveal"><h3 class="text-3xl font-display text-black mb-8 text-center text-reveal">Galer칤a</h3><div class="columns-1 md:columns-2 gap-8 space-y-8">${service.images.map(img=>`<div class="gallery-item break-inside-avoid overflow-hidden relative img-container shadow-lg"><img src="${img.imageUrl}" class="w-full h-auto object-cover hover:scale-105 transition-transform duration-700"></div>`).join('')}</div></div>` : ''}
                                
                                <div class="text-center mt-12 reveal border-t pt-12">
                                    <h3 class="text-4xl font-display text-gray-800 text-reveal mb-4">쯀nteresado?</h3>
                                    <p class="text-gray-500 mb-8">Cu칠ntame sobre tu proyecto y hagamos magia.</p>
                                    <a href="#" data-target="contact" class="nav-link btn-primary inline-block bg-black text-white font-bold py-4 px-12 rounded-full text-lg hover:bg-gray-800 transition-all transform hover:-translate-y-1 shadow-lg">Cont치ctame</a>
                                </div>
                            </div>
                        </div>
                    </section>`;
                
                const page = document.getElementById(targetId);
                if(page) {
                    document.querySelectorAll('.page-active').forEach(p => { p.classList.remove('page-active'); p.style.display='none'; });
                    page.style.display='block';
                    setTimeout(()=>page.classList.add('page-active'), 10);
                    window.scrollTo(0,0);
                    observeElements(page);
                }
            };
    
            const renderRentalDetail = (targetId) => {
                const itemId = targetId.substring(14);
                let item;
                for(const cat in rentalDataGlobal) { item = rentalDataGlobal[cat].find(i=>String(i.id)===itemId); if(item) break; }
                if(!item) return;
                
                const trackHTML = item.images.map(img=>`<div class="carousel-item"><img src="${img.imageUrl}" class="w-full h-full object-cover"></div>`).join('');
                
                document.getElementById('rental-detail-pages').innerHTML = `
                    <section id="${targetId}" class="page-container pt-32 md:pt-40 pb-20 md:pb-24 bg-white">
                        <div class="container mx-auto px-6"><div class="max-w-6xl mx-auto">
                            <a href="#" data-target="rental" class="nav-link text-gray-500 hover:text-black transition-colors mb-8 inline-block"><i class="fas fa-arrow-left mr-2"></i> Volver al Cat치logo</a>
                            <div class="grid grid-cols-1 lg:grid-cols-5 gap-12">
                                <div class="lg:col-span-3"><div class="carousel-container sticky top-28"><div class="carousel-track">${trackHTML}</div><button class="carousel-button prev"><i class="fas fa-chevron-left"></i></button><button class="carousel-button next"><i class="fas fa-chevron-right"></i></button></div></div>
                                <div class="lg:col-span-2 reveal">
                                    <h2 class="text-4xl md:text-5xl font-display mb-2 text-reveal">${item.name}</h2>
                                    <p class="text-3xl font-bold mb-6 text-reveal">$${item.price}<span class="text-lg font-normal">/d칤a</span></p>
                                    <p class="text-gray-600 text-justify text-reveal mb-8">${item.description}</p>
                                    <button id="calendar-btn-${item.id}" class="btn-primary w-full text-center inline-block bg-black text-white font-bold py-4 px-8 rounded-full text-lg hover:bg-gray-800 border border-gray-300">
                                        <i class="fas fa-calendar-alt mr-2"></i> Consultar Disponibilidad
                                    </button>
                                </div>
                            </div>
                        </div></div>
                    </section>`;
                
                const section = document.getElementById(targetId);
                // Pasamos item.bookedDates que ya viene filtrado desde loadSection
                section.querySelector(`#calendar-btn-${item.id}`).onclick = () => showCalendarModal(item, item.bookedDates || []);
                
                const track = section.querySelector('.carousel-track');
                let idx = 0;
                section.querySelector('.next').onclick = () => { idx=(idx+1)%item.images.length; track.style.transform=`translateX(${-100*idx}%)`; };
                section.querySelector('.prev').onclick = () => { idx=(idx-1+item.images.length)%item.images.length; track.style.transform=`translateX(${-100*idx}%)`; };
                
                const page = document.getElementById(targetId);
                if(page) {
                    document.querySelectorAll('.page-active').forEach(p => { p.classList.remove('page-active'); p.style.display='none'; });
                    page.style.display='block';
                    setTimeout(()=>page.classList.add('page-active'), 10);
                    window.scrollTo(0,0);
                }
            };
    
            // =================================================================
            // 6. ORQUESTACI칍N DE DATOS (LOGICA MAESTRA)
            // =================================================================
            const loadSection = async (sectionName) => {
                if (sectionName === 'projects' && globalData.projects.length > 0) return;
                if (sectionName === 'services' && globalData.services.length > 0) return;
                if (sectionName === 'rental' && globalData.rentals.items.length > 0) return;
    
                const apiParam = sectionName === 'rental' ? 'rentals' : sectionName; 
                const data = await fetchSectionData(apiParam);
                if (!data) return;
    
                // --- FILTRO DE SEGURIDAD EXACTO ---
                // La regla es simple: Solo se muestra si el status es "active".
                const isVisible = (item) => {
                    // Obtenemos el valor de la columna 'status', lo pasamos a min칰sculas y quitamos espacios.
                    const status = String(item.status || '').toLowerCase().trim();
                    // Solo devolvemos 'true' si el estado es exactamente 'active'.
                    return status === 'active';
                };
    
                if (sectionName === 'projects') {
                    globalData.projects = (data.projects || [])
                        .filter(isVisible) // Aplica el filtro: solo "active"
                        .map(p => {
                            const pImages = globalData.allProjectImages.filter(img => img.projectId === p.id);
                            const cover = pImages.find(i => String(i.isCover).toLowerCase() === 'si') || pImages[0];
                            return { ...p, coverImageUrl: cover?.imageUrl, images: pImages };
                        });
                    renderProjects();
                } 
                else if (sectionName === 'services') {
                    globalData.services = (data.services || [])
                        .filter(isVisible) // Aplica el filtro: solo "active"
                        .map(s => s);
                    renderServicesGrid();
                } 
                else if (sectionName === 'rental') {
                    // Filtramos equipos: solo "active"
                    const visibleItems = (data.rentalItems || []).filter(isVisible);
                    
                    globalData.rentals.items = visibleItems;
                    globalData.rentals.categories = data.rentalCategories || [];
                    globalData.rentals.dates = data.blockedDates || [];
                    
                    rentalDataGlobal = {}; 
                    data.rentalCategories.forEach(cat => {
                        rentalDataGlobal[cat.name] = visibleItems
                            .filter(i => i.categoryId === cat.id)
                            .map(i => ({
                                ...i, 
                                price: parseFloat(i.pricePerDay), 
                                images: i.images || [],
                                // Calendario corregido: usa getDatesInRange para bloquear todos los d칤as
                                bookedDates: data.blockedDates
                                    .filter(b => b.itemId === i.id)
                                    .flatMap(b => getDatesInRange(b.startDate, b.endDate))
                            }));
                    });
                    renderRentalPage();
                }
            };
    
            const navigateTo = (targetId) => {
                // A. CARGA INTELIGENTE
                if (['projects', 'services', 'rental'].includes(targetId)) loadSection(targetId);
                
                // B. MANEJO DE DETALLES PROFUNDOS (Espera a tener datos)
                if (targetId.startsWith('service-detail-')) {
                    if (globalData.services.length === 0) loadSection('services').then(() => renderServiceDetail(targetId));
                    else renderServiceDetail(targetId);
                }
                else if (targetId.startsWith('rental-detail-')) {
                    if (globalData.rentals.items.length === 0) loadSection('rental').then(() => renderRentalDetail(targetId));
                    else renderRentalDetail(targetId);
                }
                else if (targetId.startsWith('project-detail-')) {
                    if (globalData.projects.length === 0) loadSection('projects').then(() => renderProjectDetail(targetId));
                    else renderProjectDetail(targetId);
                }
    
                // C. TRANSICI칍N VISUAL
                const currentPage = document.querySelector('.page-active');
                const targetPage = document.getElementById(targetId);
                if (!targetPage || currentPage === targetPage) return;
    
                if (currentPage) { currentPage.classList.add('page-exiting'); currentPage.classList.remove('page-active'); }
                targetPage.style.display = 'block';
                setTimeout(() => { targetPage.classList.add('page-active'); handleScrollHeader(); }, 10);
                if (currentPage) setTimeout(() => { currentPage.classList.remove('page-exiting'); currentPage.style.display = 'none'; }, 500);
    
                // D. MENU
                let active = targetId;
                if(targetId.startsWith('project-detail-')) active='projects';
                else if(targetId.startsWith('rental-detail-')) active='rental';
                else if(targetId.startsWith('service-detail-')) active='services';
                allNavLinks.forEach(l => { l.classList.remove('nav-active'); if(l.dataset.target===active) l.classList.add('nav-active'); });
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                observeElements(targetPage);
            };
    
            const initialize = async () => {
                const apiData = await fetchSectionData('home');
                if (apiData) {
                    const imgs = apiData.sysImages || {};
                    const ident = apiData.identity || {};
                    const about = apiData.about || {};
                    
                    if(imgs.logo_black) document.querySelectorAll('.logo-dark').forEach(e=>e.src=imgs.logo_black);
                    if(imgs.logo_white) document.querySelectorAll('.logo-light').forEach(e=>e.src=imgs.logo_white);
                    if(imgs.favicon) document.querySelector("link[rel*='icon']").href=imgs.favicon;
                    
                    // Inserci칩n de textos About
                    if(about.intro_phrase) { const el=document.getElementById('about-intro-phrase'); if(el) el.textContent=`"${about.intro_phrase}"`; }
                    if(about.bio) { const el=document.getElementById('about-bio'); if(el) el.innerHTML=about.bio; }
                    if(about.process) { const el=document.getElementById('about-process'); if(el) el.innerHTML=about.process; }
                    if(about.profile_image) { const el=document.querySelector('#about img'); if(el) el.src=about.profile_image; }
    
                    const updateLink = (aria, url) => { if(!url) return; document.querySelectorAll(`a[aria-label="${aria}"]`).forEach(a => { a.href = url; a.target = "_blank"; }); };
                    updateLink('Instagram', ident.social_instagram); updateLink('Facebook', ident.social_facebook); updateLink('YouTube', ident.social_youtube);
                    updateLink('WhatsApp', ident.social_whatsapp ? `https://wa.me/${ident.social_whatsapp.replace(/[^0-9]/g, '')}` : null);
                    
                    // MAPA (Sanitizado)
                    if (ident.social_maps) { 
                        const map = document.getElementById('google-map');
                        let mapUrl = ident.social_maps;
                        if(map && mapUrl.includes('embed')) map.src = mapUrl; 
                        else if(map) map.style.display = 'none'; // Ocultar si no es embed v치lido
                    }
    
                    globalData.portfolio = apiData.portfolioGallery || [];
                    globalData.videos = apiData.videos || [];
                    globalData.logos = apiData.clientLogos || [];
                    globalData.allProjectImages = apiData.allProjectImages || [];
                }
                renderPortfolio(); renderVideos(globalData.videos); renderClientLogos(globalData.logos); renderCart(); updateCartIcon();
                setTimeout(() => pageLoader.classList.add('hidden'), 1500);
                
                if(window.location.hash) {
                    const target = window.location.hash.substring(1);
                    navigateTo(target);
                } else {
                    const initial = document.getElementById('portfolio');
                    if(initial) { initial.classList.add('page-active'); observeElements(initial); document.querySelectorAll('.nav-link[data-target="portfolio"]').forEach(l => l.classList.add('nav-active')); }
                }
            };
    
            // =================================================================
            // 7. MODALES (CALENDARIO Y CHECKOUT)
            // =================================================================
            const showCheckoutModal = () => {
                const container = document.getElementById('checkout-modal-container');
                const total = cart.reduce((t,i)=>t+(i.price*i.totalDays),0);
                container.innerHTML = `
                <div id="checkout-modal-overlay" class="checkout-modal-overlay"><div id="checkout-modal-content" class="checkout-modal-content">
                    <div class="p-6 border-b flex justify-between items-center"><h2 class="text-2xl font-display">Reserva</h2><button id="close-co" class="text-2xl">칑</button></div>
                    <div id="step-1" class="checkout-step active"><div class="p-6"><form id="co-form" class="space-y-4"><div><label class="block text-sm">Nombre</label><input type="text" required class="form-input mt-1"></div><div><label class="block text-sm">Email</label><input type="email" required class="form-input mt-1"></div><div><label class="block text-sm">Tel칠fono</label><input type="tel" required class="form-input mt-1"></div></form></div><div class="p-6 bg-gray-50 flex justify-end"><button id="btn-next-1" class="bg-black text-white py-3 px-6 font-bold">Siguiente</button></div></div>
                    <div id="step-2" class="checkout-step"><div class="p-6"><h3>Resumen</h3>${cart.map(i=>`<div class="flex justify-between py-2 border-b"><span>${i.name}</span><span>$${(i.price*i.totalDays).toFixed(2)}</span></div>`).join('')}<div class="font-bold text-xl mt-4 text-right">Total: $${total.toFixed(2)}</div></div><div class="p-6 bg-gray-50 flex justify-between"><button id="btn-back-2" class="bg-gray-200 py-3 px-6">Atr치s</button><button id="btn-pay" class="bg-black text-white py-3 px-6 font-bold">Confirmar</button></div></div>
                    <div id="step-3" class="checkout-step"><div class="p-8 text-center"><div class="text-green-600 text-4xl mb-4"><i class="fas fa-check-circle"></i></div><h3>춰Listo!</h3><p>Reserva: ADG-${Math.floor(Math.random()*9000)}</p><button id="btn-finish" class="mt-4 bg-black text-white py-2 px-6">Cerrar</button></div></div>
                </div></div>`;
                
                const overlay = document.getElementById('checkout-modal-overlay');
                const step1 = document.getElementById('step-1'); const step2 = document.getElementById('step-2'); const step3 = document.getElementById('step-3');
                
                setTimeout(()=>overlay.classList.add('visible'),10);
                const close = () => { overlay.classList.remove('visible'); setTimeout(()=>container.innerHTML='',300); };
                document.getElementById('close-co').onclick = close;
                document.getElementById('btn-next-1').onclick = () => { if(document.getElementById('co-form').checkValidity()) { step1.classList.remove('active'); step2.classList.add('active'); } else document.getElementById('co-form').reportValidity(); };
                document.getElementById('btn-back-2').onclick = () => { step2.classList.remove('active'); step1.classList.add('active'); };
                document.getElementById('btn-pay').onclick = () => { step2.classList.remove('active'); step3.classList.add('active'); cart=[]; renderCart(); updateCartIcon(); };
                document.getElementById('btn-finish').onclick = close;
            };
    
            const showCalendarModal = (item, bookedDates) => {
                const modalContainer = document.getElementById('calendar-modal-container');
                // HTML ID칄NTICO AL EST츼TICO
                modalContainer.innerHTML = `
                    <div id="calendar-modal-overlay" class="calendar-modal-overlay">
                        <div class="calendar-modal-content">
                            <div class="calendar-header">
                                <button id="calendar-prev" class="calendar-nav-btn"><i class="fas fa-chevron-left"></i></button>
                                <h3 id="calendar-month-year" class="font-display text-2xl"></h3>
                                <button id="calendar-next" class="calendar-nav-btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-grid">
                                <div class="calendar-day-name">D</div><div class="calendar-day-name">L</div><div class="calendar-day-name">M</div>
                                <div class="calendar-day-name">M</div><div class="calendar-day-name">J</div><div class="calendar-day-name">V</div>
                                <div class="calendar-day-name">S</div>
                            </div>
                            <div id="calendar-days" class="calendar-grid"></div>
                            
                            <div class="booking-summary">
                                <div class="flex justify-between items-center text-sm"><span>Desde:</span><span id="summary-start-date">--/--/----</span></div>
                                <div class="flex justify-between items-center text-sm"><span>Hasta:</span><span id="summary-end-date">--/--/----</span></div>
                                <div class="flex justify-between items-center text-sm border-t mt-2 pt-2"><span>Total D칤as:</span><span id="summary-total-days">0</span></div>
                                <div class="flex justify-between items-center text-xl font-bold mt-2"><span>Total a Pagar:</span><span id="summary-total-price">$0</span></div>
                            </div>
                            
                            <button id="add-to-cart-btn" class="w-full mt-4 bg-black text-white py-3 font-bold disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>Agregar al Carrito</button>
                        </div>
                    </div>
                `;
                
                const overlay = document.getElementById('calendar-modal-overlay');
                const monthYearEl = document.getElementById('calendar-month-year');
                const daysContainer = document.getElementById('calendar-days');
                const summaryStartDate = document.getElementById('summary-start-date');
                const summaryEndDate = document.getElementById('summary-end-date');
                const summaryTotalDays = document.getElementById('summary-total-days');
                const summaryTotalPrice = document.getElementById('summary-total-price');
                const addToCartBtn = document.getElementById('add-to-cart-btn');
                
                const close = () => {
                    overlay.classList.remove('visible');
                    setTimeout(() => modalContainer.innerHTML = '', 300);
                };
    
                setTimeout(() => overlay.classList.add('visible'), 10);
    
                let currentDate = new Date();
                currentDate.setDate(1);
                let selectedStartDate = null;
                let selectedEndDate = null;
    
                const renderMonth = () => {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();
                    const today = new Date(); today.setHours(0,0,0,0);
                    
                    // Capitalizar mes
                    let monthName = new Intl.DateTimeFormat('es-ES', { month: 'long' }).format(currentDate);
                    monthName = monthName.charAt(0).toUpperCase() + monthName.slice(1);
                    monthYearEl.textContent = `${monthName} ${year}`;
                    
                    daysContainer.innerHTML = '';
                    const firstDayOfMonth = new Date(year, month, 1).getDay();
                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    
                    for (let i = 0; i < firstDayOfMonth; i++) daysContainer.innerHTML += `<div></div>`;
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayEl = document.createElement('button');
                        dayEl.textContent = day;
                        dayEl.classList.add('calendar-day');
                        
                        // Construir fecha local sin problemas de zona horaria
                        const dayDate = new Date(year, month, day); 
                        const dateString = dayDate.toLocaleDateString('en-CA'); // YYYY-MM-DD local
                        
                        // Bloqueo: si es pasado O si est치 en la lista de bookedDates
                        if (dayDate < today || bookedDates.includes(dateString)) {
                            dayEl.classList.add('disabled');
                        } else {
                            dayEl.dataset.date = dateString;
                        }
                        
                        // Estilos de selecci칩n
                        if (selectedStartDate && dateString === selectedStartDate) dayEl.classList.add('selected');
                        if (selectedEndDate && dateString === selectedEndDate) dayEl.classList.add('selected');
                        if (selectedStartDate && selectedEndDate && dateString > selectedStartDate && dateString < selectedEndDate) dayEl.classList.add('in-range');
                        
                        daysContainer.appendChild(dayEl);
                    }
                };
                
                const updateSummary = () => {
                    addToCartBtn.disabled = !(selectedStartDate && selectedEndDate);
                    if (selectedStartDate && selectedEndDate) {
                        // Formato visual para el usuario
                        const startObj = new Date(selectedStartDate + 'T00:00:00');
                        const endObj = new Date(selectedEndDate + 'T00:00:00');
                        
                        summaryStartDate.textContent = startObj.toLocaleDateString('es-ES');
                        summaryEndDate.textContent = endObj.toLocaleDateString('es-ES');
                        
                        const diffDays = Math.ceil((endObj - startObj) / (1000 * 60 * 60 * 24)) + 1;
                        summaryTotalDays.textContent = diffDays;
                        summaryTotalPrice.textContent = `$${(diffDays * item.price).toFixed(2)}`;
                    } else if (selectedStartDate) {
                        const startObj = new Date(selectedStartDate + 'T00:00:00');
                        summaryStartDate.textContent = startObj.toLocaleDateString('es-ES');
                        summaryEndDate.textContent = '--/--/----';
                        summaryTotalDays.textContent = '1';
                        summaryTotalPrice.textContent = `$${item.price.toFixed(2)}`;
                    } else {
                         summaryStartDate.textContent = '--/--/----'; summaryEndDate.textContent = '--/--/----';
                         summaryTotalDays.textContent = '0'; summaryTotalPrice.textContent = '$0';
                    }
                };
                
                daysContainer.addEventListener('click', (e) => {
                    if (e.target.matches('.calendar-day') && !e.target.classList.contains('disabled')) {
                        const clickedDateStr = e.target.dataset.date;
                        
                        if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                            // Nuevo inicio
                            selectedStartDate = clickedDateStr; selectedEndDate = null;
                        } else if (clickedDateStr < selectedStartDate) {
                            // Clic antes del inicio -> Nuevo inicio
                            selectedStartDate = clickedDateStr;
                        } else {
                            // Selecci칩n de final
                            // Verificar si hay d칤as bloqueados en medio
                            let validRange = true;
                            let tempDate = new Date(selectedStartDate + 'T00:00:00');
                            const endDateObj = new Date(clickedDateStr + 'T00:00:00');
                            
                            while(tempDate <= endDateObj) {
                                const tempStr = tempDate.toLocaleDateString('en-CA');
                                if(bookedDates.includes(tempStr)) {
                                    validRange = false; break;
                                }
                                tempDate.setDate(tempDate.getDate() + 1);
                            }
                            
                            if(!validRange) {
                                alert("El rango incluye d칤as no disponibles.");
                                selectedStartDate = null; selectedEndDate = null;
                            } else {
                                selectedEndDate = clickedDateStr;
                            }
                        }
                        renderMonth(); updateSummary();
                    }
                });
                
                addToCartBtn.addEventListener('click', () => {
                    if (selectedStartDate && selectedEndDate) {
                        addToCart(item, selectedStartDate, selectedEndDate);
                        close();
                    }
                });
    
                document.getElementById('calendar-prev').onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); renderMonth(); };
                document.getElementById('calendar-next').onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); renderMonth(); };
                overlay.addEventListener('click', e => { if(e.target === overlay) close(); });
                
                renderMonth();
            };
    
            // =================================================================
            // 8. LISTENERS GLOBALES (Event Delegation)
            // =================================================================
            document.addEventListener('click', function(e) {
                // A. Navegaci칩n Men칰
                const navLink = e.target.closest('.nav-link');
                if (navLink) { 
                    e.preventDefault(); 
                    if(cartDrawer.classList.contains('visible')) toggleCart(false); 
                    if(mobileMenu.classList.contains('open')) toggleMobileMenu(false); 
                    navigateTo(navLink.dataset.target); 
                    return;
                }
                
                // B. Lightbox
                // B. Lightbox
                // Simplificamos la detecci칩n: si es img dentro de gallery-item, abre lightbox
                const galleryItem = e.target.closest('.gallery-item');
                if(galleryItem && !galleryItem.closest('.rental-card') && !e.target.closest('iframe')) {
                    const img = galleryItem.querySelector('img');
                    // IMPORTANTE: Detectamos si el click fue DIRECTAMENTE en la imagen o en el overlay
                    if(img && (e.target === img || e.target.closest('.overlay'))) {
                        // Recolectar todas las imagenes de la pagina actual para navegar
                        const activePage = document.querySelector('.page-active');
                        if(activePage) {
                            const allItems = Array.from(activePage.querySelectorAll('.gallery-item img'));
                            const imgs = allItems.map(i=>({
                                src: i.src, 
                                title: i.closest('.gallery-item').querySelector('.overlay p')?.textContent || i.alt || ''
                            }));
                            const idx = allItems.indexOf(img); 
                            if(idx !== -1) openLightbox(img.src, imgs[idx].title, imgs, idx);
                        }
                    }
                }
                
                // C. Carrito Eliminar
                if (e.target.closest('.cart-item-remove-btn')) {
                    const id = e.target.closest('.cart-item-remove-btn').dataset.cartId;
                    cart = cart.filter(i => i.cartId !== id);
                    renderCart(); updateCartIcon();
                }
            });
    
            // Listeners Fijos
            if(mobileMenuButton) mobileMenuButton.onclick = () => toggleMobileMenu();
            if(cartButton) cartButton.onclick = () => toggleCart(true);
            if(mobileCartButton) mobileCartButton.onclick = () => { toggleCart(true); toggleMobileMenu(false); };
            if(cartCloseBtn) cartCloseBtn.onclick = () => toggleCart(false);
            if(cartOverlay) cartOverlay.onclick = () => toggleCart(false);
            if(checkoutBtn) checkoutBtn.onclick = () => { if(cart.length>0){ toggleCart(false); setTimeout(showCheckoutModal,500); }};
            
            if(lightboxClose) lightboxClose.onclick = closeLightbox;
            if(lightboxPrev) lightboxPrev.onclick = () => navigateLightbox('prev');
            if(lightboxNext) lightboxNext.onclick = () => navigateLightbox('next');
            if(lightbox) lightbox.onclick = (e) => { if(e.target===lightbox) closeLightbox(); };
            
            document.onkeydown = (e) => {
                if (lightbox.classList.contains('visible')) {
                    if(e.key==='Escape') closeLightbox();
                    if(e.key==='ArrowLeft') navigateLightbox('prev');
                    if(e.key==='ArrowRight') navigateLightbox('next');
                }
            };
    
            // Scroll
            window.addEventListener('scroll', handleScrollHeader, { passive: true });
    
            // ARRANCAR
            initialize();
        });
    </script>
</body>
</html>
